# å¾®å‰ç«¯æ¦‚è®º

## ğŸ¯ å­¦ä¹ ç›®æ ‡

é€šè¿‡æœ¬æ–‡æ¡£ï¼Œä½ å°†ï¼š
- æ·±åˆ»ç†è§£å¾®å‰ç«¯æ¶æ„çš„æ ¸å¿ƒç†å¿µå’Œä»·å€¼ä¸»å¼ 
- æŒæ¡ä¸»æµå¾®å‰ç«¯å®ç°æ–¹æ¡ˆçš„æŠ€æœ¯åŸç†å’Œé€‚ç”¨åœºæ™¯
- å­¦ä¼šæ ¹æ®ä¸šåŠ¡åœºæ™¯é€‰æ‹©åˆé€‚çš„å¾®å‰ç«¯æŠ€æœ¯æ–¹æ¡ˆ
- äº†è§£å¾®å‰ç«¯æ¶æ„è®¾è®¡çš„æœ€ä½³å®è·µå’Œå¸¸è§é™·é˜±
- å…·å¤‡ä»é›¶æ­å»ºä¼ä¸šçº§å¾®å‰ç«¯ç³»ç»Ÿçš„èƒ½åŠ›

---

## ğŸ“š ç›®å½•

1. [å¾®å‰ç«¯æ¦‚è¿°](#å¾®å‰ç«¯æ¦‚è¿°)
2. [æ ¸å¿ƒæ¦‚å¿µè§£æ](#æ ¸å¿ƒæ¦‚å¿µè§£æ)
3. [å®ç°æ–¹æ¡ˆæ·±åº¦åˆ†æ](#å®ç°æ–¹æ¡ˆæ·±åº¦åˆ†æ)
4. [æŠ€æœ¯æ–¹æ¡ˆå¯¹æ¯”çŸ©é˜µ](#æŠ€æœ¯æ–¹æ¡ˆå¯¹æ¯”çŸ©é˜µ)
5. [å®è·µæ¡ˆä¾‹](#å®è·µæ¡ˆä¾‹)
6. [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)
7. [å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ](#å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ)
8. [æœªæ¥è¶‹åŠ¿](#æœªæ¥è¶‹åŠ¿)
9. [å­¦ä¹ æ€»ç»“](#å­¦ä¹ æ€»ç»“)
10. [å‚è€ƒèµ„æº](#å‚è€ƒèµ„æº)

---

## ğŸ’¡ å¾®å‰ç«¯æ¦‚è¿°

### ä»€ä¹ˆæ˜¯å¾®å‰ç«¯ï¼Ÿ

å¾®å‰ç«¯ï¼ˆMicro Frontendsï¼‰æ˜¯ä¸€ç§å‰ç«¯æ¶æ„æ¨¡å¼ï¼Œå°†**å•ä¸€çš„å•ä½“å‰ç«¯åº”ç”¨**æ‹†åˆ†æˆ**å¤šä¸ªç‹¬ç«‹çš„ã€æ¾è€¦åˆçš„å¾®åº”ç”¨**ï¼Œæ¯ä¸ªå¾®åº”ç”¨è´Ÿè´£ç‰¹å®šçš„ä¸šåŠ¡åŠŸèƒ½ï¼Œå¯ä»¥ç‹¬ç«‹å¼€å‘ã€æµ‹è¯•ã€éƒ¨ç½²å’Œè¿è¡Œã€‚

```
ä¼ ç»Ÿå•ä½“åº”ç”¨:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        Single Frontend App      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚æ¨¡å—Aâ”‚ â”‚æ¨¡å—Bâ”‚ â”‚æ¨¡å—Câ”‚ â”‚æ¨¡å—Dâ”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å¾®å‰ç«¯æ¶æ„:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Shell App (å®¹å™¨)        â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚åº”ç”¨Aâ”‚ â”‚åº”ç”¨Bâ”‚ â”‚åº”ç”¨Câ”‚ â”‚åº”ç”¨Dâ”‚ â”‚
â”‚ â”‚ç‹¬ç«‹ â”‚ â”‚ç‹¬ç«‹ â”‚ â”‚ç‹¬ç«‹ â”‚ â”‚ç‹¬ç«‹ â”‚ â”‚
â”‚ â”‚å¼€å‘ â”‚ â”‚éƒ¨ç½² â”‚ â”‚æŠ€æœ¯ â”‚ â”‚å›¢é˜Ÿ â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä¸ºä»€ä¹ˆéœ€è¦å¾®å‰ç«¯ï¼Ÿ

#### å•ä½“åº”ç”¨é¢ä¸´çš„æŒ‘æˆ˜

```javascript
// å…¸å‹çš„å¤§å‹å•ä½“å‰ç«¯åº”ç”¨ç»“æ„
my-app/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ pages/
â”‚   â”‚   â”œâ”€â”€ user-management/      // ç”¨æˆ·ç®¡ç†æ¨¡å— (å›¢é˜ŸA)
â”‚   â”‚   â”œâ”€â”€ order-system/         // è®¢å•ç³»ç»Ÿ (å›¢é˜ŸB)
â”‚   â”‚   â”œâ”€â”€ inventory/            // åº“å­˜ç®¡ç† (å›¢é˜ŸC)
â”‚   â”‚   â””â”€â”€ analytics/            // æ•°æ®åˆ†æ (å›¢é˜ŸD)
â”‚   â”œâ”€â”€ components/               // å…±äº«ç»„ä»¶ (æ‰€æœ‰å›¢é˜Ÿ)
â”‚   â””â”€â”€ utils/                    // å·¥å…·å‡½æ•° (æ‰€æœ‰å›¢é˜Ÿ)
â””â”€â”€ package.json                  // ç»Ÿä¸€ä¾èµ–ç®¡ç†
```

**é—®é¢˜åˆ†æ**ï¼š

1. **å›¢é˜Ÿåä½œå›°éš¾**
```javascript
// å›¢é˜ŸA æƒ³å‡çº§ React åˆ°æœ€æ–°ç‰ˆæœ¬
"react": "^18.0.0"

// ä½†å›¢é˜ŸB çš„ä»£ç ä¾èµ–è€ç‰ˆæœ¬ç‰¹æ€§
"react": "^16.8.0"  // å†²çªï¼

// ç»“æœï¼šæŠ€æœ¯å€ºåŠ¡ç´¯ç§¯ï¼Œå‡çº§å›°éš¾
```

2. **éƒ¨ç½²é£é™©é«˜**
```bash
# ä»»ä½•ä¸€ä¸ªæ¨¡å—çš„ä¿®æ”¹éƒ½éœ€è¦é‡æ–°æ„å»ºæ•´ä¸ªåº”ç”¨
npm run build  # æ„å»ºæ—¶é—´ï¼š15-30åˆ†é’Ÿ
npm run deploy # éƒ¨ç½²å½±å“ï¼šæ‰€æœ‰åŠŸèƒ½æ¨¡å—
```

3. **æŠ€æœ¯æ ˆç»‘å®š**
```javascript
// æ‰€æœ‰å›¢é˜Ÿè¢«è¿«ä½¿ç”¨ç›¸åŒæŠ€æœ¯æ ˆ
const projectStack = {
  framework: "React",     // æ— æ³•é€‰æ‹© Vue æˆ– Angular
  bundler: "Webpack",     // æ— æ³•ä½¿ç”¨ Vite
  state: "Redux",         // æ— æ³•ä½¿ç”¨ Zustand
  ui: "Ant Design"        // æ— æ³•ä½¿ç”¨å…¶ä»– UI åº“
}
```

#### å¾®å‰ç«¯çš„æ ¸å¿ƒä»·å€¼

1. **æŠ€æœ¯æ ˆæ— å…³æ€§**
```javascript
// ä¸»åº”ç”¨ (Shell)
const shellApp = {
  framework: "React",
  port: 3000
}

// å­åº”ç”¨A - ç”¨æˆ·ç®¡ç†
const userApp = {
  framework: "Vue",     // ä¸åŒæ¡†æ¶
  bundler: "Vite",      // ä¸åŒæ„å»ºå·¥å…·
  port: 3001
}

// å­åº”ç”¨B - è®¢å•ç³»ç»Ÿ
const orderApp = {
  framework: "Angular", // å®Œå…¨ä¸åŒçš„æŠ€æœ¯æ ˆ
  bundler: "Webpack",
  port: 3002
}
```

2. **ç‹¬ç«‹å¼€å‘éƒ¨ç½²**
```bash
# å›¢é˜Ÿå¯ä»¥ç‹¬ç«‹å¼€å‘å’Œéƒ¨ç½²
cd user-management-app
npm run dev    # ç‹¬ç«‹å¼€å‘ç¯å¢ƒ
npm run deploy # ç‹¬ç«‹éƒ¨ç½²ï¼Œä¸å½±å“å…¶ä»–åº”ç”¨

# ä¸»åº”ç”¨è‡ªåŠ¨æ•´åˆæœ€æ–°ç‰ˆæœ¬
```

3. **å¢é‡å‡çº§**
```javascript
// å¯ä»¥é€æ­¥å‡çº§ï¼Œé™ä½é£é™©
const migrationPlan = {
  phase1: "å°†ç”¨æˆ·ç®¡ç†æ¨¡å—ç‹¬ç«‹ä¸ºå¾®åº”ç”¨",
  phase2: "å‡çº§ç”¨æˆ·ç®¡ç†æ¨¡å—åˆ°æ–°æŠ€æœ¯æ ˆ",
  phase3: "é€æ­¥è¿ç§»å…¶ä»–æ¨¡å—",
  phase4: "å®Œå…¨å¾®å‰ç«¯åŒ–"
}
```

---

## ğŸ§  æ ¸å¿ƒæ¦‚å¿µè§£æ

### åº”ç”¨éš”ç¦»

å¾®å‰ç«¯æœ€æ ¸å¿ƒçš„æŠ€æœ¯æŒ‘æˆ˜æ˜¯ç¡®ä¿å„ä¸ªå¾®åº”ç”¨åœ¨åŒä¸€ä¸ªé¡µé¢ä¸­è¿è¡Œæ—¶ä¸ä¼šç›¸äº’å½±å“ã€‚

#### JavaScript éš”ç¦»ï¼ˆJS æ²™ç®±ï¼‰

**é—®é¢˜åœºæ™¯**ï¼š
```javascript
// å¾®åº”ç”¨A
window.globalVar = 'Açš„å…¨å±€å˜é‡'
window.jQuery = jQuery_v2

// å¾®åº”ç”¨B
window.globalVar = 'Bçš„å…¨å±€å˜é‡'  // è¦†ç›–äº†Açš„å˜é‡ï¼
window.jQuery = jQuery_v3         // ç‰ˆæœ¬å†²çªï¼
```

**è§£å†³æ–¹æ¡ˆ1: Proxy æ²™ç®±**
```javascript
class ProxySandbox {
  constructor() {
    this.modifiedPropsMap = new Map()
    this.proxy = new Proxy(window, {
      get: (target, prop) => {
        return target[prop]
      },
      set: (target, prop, value) => {
        this.modifiedPropsMap.set(prop, value)
        target[prop] = value
        return true
      }
    })
  }

  // æ¿€æ´»æ²™ç®±
  active() {
    this.currentUpdatedPropsValueMap = new Map()
    this.modifiedPropsMap.forEach((value, prop) => {
      this.currentUpdatedPropsValueMap.set(prop, window[prop])
      window[prop] = value
    })
  }

  // å¸è½½æ²™ç®±
  inactive() {
    this.modifiedPropsMap.forEach((_, prop) => {
      if (this.currentUpdatedPropsValueMap.has(prop)) {
        window[prop] = this.currentUpdatedPropsValueMap.get(prop)
      } else {
        delete window[prop]
      }
    })
  }
}

// ä½¿ç”¨ç¤ºä¾‹
const sandbox = new ProxySandbox()
sandbox.active()
// å¾®åº”ç”¨åœ¨æ²™ç®±ä¸­è¿è¡Œ
sandbox.inactive() // æ¸…ç†å‰¯ä½œç”¨
```

**è§£å†³æ–¹æ¡ˆ2: å¿«ç…§æ²™ç®±**
```javascript
class SnapshotSandbox {
  constructor() {
    this.windowSnapshot = {}
    this.modifyPropsMap = {}
  }

  active() {
    // ä¿å­˜å½“å‰ window çŠ¶æ€
    for (const prop in window) {
      this.windowSnapshot[prop] = window[prop]
    }

    // æ¢å¤ä¸Šæ¬¡çš„ä¿®æ”¹
    Object.keys(this.modifyPropsMap).forEach(p => {
      window[p] = this.modifyPropsMap[p]
    })
  }

  inactive() {
    // è®°å½•å·®å¼‚
    for (const prop in window) {
      if (window[prop] !== this.windowSnapshot[prop]) {
        this.modifyPropsMap[prop] = window[prop]
        window[prop] = this.windowSnapshot[prop]
      }
    }
  }
}
```

#### æ ·å¼éš”ç¦»

**é—®é¢˜åœºæ™¯**ï¼š
```css
/* å¾®åº”ç”¨Açš„æ ·å¼ */
.header { background: red; }
.button { color: blue; }

/* å¾®åº”ç”¨Bçš„æ ·å¼ */
.header { background: green; }  /* å†²çªï¼è¦†ç›–äº†Açš„æ ·å¼ */
.button { color: white; }       /* å†²çªï¼*/
```

**è§£å†³æ–¹æ¡ˆ1: CSS Modules**
```javascript
// å¾®åº”ç”¨A
import styles from './app.module.css'

function AppA() {
  return (
    <div className={styles.header}>  {/* å®é™…ç±»åï¼š_header_1a2b3c */}
      <button className={styles.button}>ç‚¹å‡»</button>
    </div>
  )
}
```

**è§£å†³æ–¹æ¡ˆ2: åŠ¨æ€ CSS ä½œç”¨åŸŸ**
```javascript
// qiankun çš„æ ·å¼éš”ç¦»å®ç°
function scopedCSS(css, prefix) {
  return css.replace(/([^\r\n,{}]+)(,(?=[^}]*{)|\s*{)/g, (match, selector, splitter) => {
    if (selector.match(/(^(\.|#|@|:))/)) {
      return selector + splitter
    }
    return `${prefix} ${selector}${splitter}`
  })
}

// åŸå§‹æ ·å¼
const originalCSS = `
.header { background: red; }
.button { color: blue; }
`

// å¤„ç†å
const scopedCSS = `
.micro-app-a .header { background: red; }
.micro-app-a .button { color: blue; }
`
```

**è§£å†³æ–¹æ¡ˆ3: Shadow DOM**
```javascript
class MicroAppContainer extends HTMLElement {
  constructor() {
    super()
    // åˆ›å»º Shadow DOMï¼Œå®ç°å®Œå…¨éš”ç¦»
    this.shadow = this.attachShadow({ mode: 'closed' })
  }

  connectedCallback() {
    this.shadow.innerHTML = `
      <style>
        .header { background: red; }  /* å®Œå…¨éš”ç¦»ï¼Œä¸ä¼šå½±å“å¤–éƒ¨ */
      </style>
      <div class="header">å¾®åº”ç”¨å†…å®¹</div>
    `
  }
}

customElements.define('micro-app', MicroAppContainer)
```

### åº”ç”¨é€šä¿¡

å¾®åº”ç”¨ä¹‹é—´éœ€è¦è¿›è¡Œæ•°æ®ä¼ é€’å’ŒçŠ¶æ€åŒæ­¥ã€‚

#### äº‹ä»¶æ€»çº¿é€šä¿¡
```javascript
// äº‹ä»¶æ€»çº¿å®ç°
class EventBus {
  constructor() {
    this.events = {}
  }

  // è®¢é˜…äº‹ä»¶
  on(eventName, callback) {
    if (!this.events[eventName]) {
      this.events[eventName] = []
    }
    this.events[eventName].push(callback)
  }

  // å‘å¸ƒäº‹ä»¶
  emit(eventName, data) {
    if (this.events[eventName]) {
      this.events[eventName].forEach(callback => callback(data))
    }
  }

  // å–æ¶ˆè®¢é˜…
  off(eventName, callback) {
    if (this.events[eventName]) {
      const index = this.events[eventName].indexOf(callback)
      if (index > -1) {
        this.events[eventName].splice(index, 1)
      }
    }
  }
}

// å…¨å±€äº‹ä»¶æ€»çº¿
window.microEventBus = new EventBus()

// å¾®åº”ç”¨A - å‘é€æ¶ˆæ¯
function sendUserInfo() {
  const userInfo = { id: 1, name: 'å¼ ä¸‰' }
  window.microEventBus.emit('userChanged', userInfo)
}

// å¾®åº”ç”¨B - æ¥æ”¶æ¶ˆæ¯
window.microEventBus.on('userChanged', (userInfo) => {
  console.log('æ¥æ”¶åˆ°ç”¨æˆ·ä¿¡æ¯:', userInfo)
  updateUserDisplay(userInfo)
})
```

#### å…¨å±€çŠ¶æ€ç®¡ç†
```javascript
// ç®€å•çš„å…¨å±€çŠ¶æ€ç®¡ç†å™¨
class GlobalStore {
  constructor() {
    this.state = {}
    this.listeners = []
  }

  getState() {
    return this.state
  }

  setState(newState) {
    this.state = { ...this.state, ...newState }
    this.listeners.forEach(listener => listener(this.state))
  }

  subscribe(listener) {
    this.listeners.push(listener)
    return () => {
      const index = this.listeners.indexOf(listener)
      this.listeners.splice(index, 1)
    }
  }
}

// å…¨å±€çŠ¶æ€å®ä¾‹
window.globalStore = new GlobalStore()

// å¾®åº”ç”¨ä½¿ç”¨
// åº”ç”¨A - æ›´æ–°çŠ¶æ€
window.globalStore.setState({
  currentUser: { id: 1, name: 'å¼ ä¸‰' }
})

// åº”ç”¨B - ç›‘å¬çŠ¶æ€å˜åŒ–
const unsubscribe = window.globalStore.subscribe((state) => {
  console.log('çŠ¶æ€æ›´æ–°:', state.currentUser)
})
```

#### åŸºäº Props çš„çˆ¶å­é€šä¿¡
```javascript
// ä¸»åº”ç”¨å‘å­åº”ç”¨ä¼ é€’ props
function renderMicroApp(appName, container, props) {
  // é€šè¿‡çº¦å®šçš„æ–¹å¼ä¼ é€’å±æ€§
  window[`__${appName}_PROPS__`] = props

  // åŠ è½½å­åº”ç”¨
  loadMicroApp(appName, container)
}

// å­åº”ç”¨æ¥æ”¶ props
function getProps() {
  return window[`__${window.__MICRO_APP_NAME__}_PROPS__`] || {}
}

// ä½¿ç”¨ç¤ºä¾‹
const props = getProps()
console.log('ä¸»åº”ç”¨ä¼ é€’çš„ç”¨æˆ·ä¿¡æ¯:', props.userInfo)
```

### è·¯ç”±ç³»ç»Ÿ

#### ä¸»åº”ç”¨è·¯ç”±æ§åˆ¶
```javascript
// åŸºäºè·¯å¾„çš„å¾®åº”ç”¨è·¯ç”±åˆ†å‘
const microApps = [
  {
    name: 'user-management',
    activeRule: '/user',
    entry: 'http://localhost:3001'
  },
  {
    name: 'order-system',
    activeRule: '/order',
    entry: 'http://localhost:3002'
  }
]

// è·¯ç”±ç›‘å¬å’Œåˆ†å‘
function routeHandler() {
  const currentPath = window.location.pathname

  microApps.forEach(app => {
    if (currentPath.startsWith(app.activeRule)) {
      // æ¿€æ´»å¯¹åº”çš„å¾®åº”ç”¨
      activeMicroApp(app)
    } else {
      // å¸è½½ä¸åŒ¹é…çš„å¾®åº”ç”¨
      deactiveMicroApp(app)
    }
  })
}

// ç›‘å¬è·¯ç”±å˜åŒ–
window.addEventListener('popstate', routeHandler)
window.addEventListener('pushstate', routeHandler)
```

#### å­åº”ç”¨è·¯ç”±å¤„ç†
```javascript
// å­åº”ç”¨å†…éƒ¨è·¯ç”±é…ç½®
// React Router ç¤ºä¾‹
import { createBrowserRouter } from 'react-router-dom'

const router = createBrowserRouter([
  {
    path: '/user',           // åŒ¹é…ä¸»åº”ç”¨åˆ†é…çš„åŸºç¡€è·¯å¾„
    children: [
      {
        path: 'list',        // å®Œæ•´è·¯å¾„: /user/list
        element: <UserList />
      },
      {
        path: 'detail/:id',  // å®Œæ•´è·¯å¾„: /user/detail/123
        element: <UserDetail />
      }
    ]
  }
])

// Vue Router ç¤ºä¾‹
const routes = [
  {
    path: '/order',          // åŸºç¡€è·¯å¾„
    children: [
      {
        path: 'list',        // /order/list
        component: OrderList
      },
      {
        path: 'create',      // /order/create
        component: OrderCreate
      }
    ]
  }
]
```

### ç”Ÿå‘½å‘¨æœŸç®¡ç†

å¾®åº”ç”¨éœ€è¦å®ç°æ ‡å‡†çš„ç”Ÿå‘½å‘¨æœŸé’©å­ï¼Œä¾¿äºä¸»åº”ç”¨ç®¡ç†ã€‚

```javascript
// æ ‡å‡†çš„å¾®åº”ç”¨ç”Ÿå‘½å‘¨æœŸ
export async function bootstrap() {
  console.log('å¾®åº”ç”¨å¯åŠ¨')
  // åˆå§‹åŒ–å…¨å±€å˜é‡ã€äº‹ä»¶ç›‘å¬å™¨ç­‰
}

export async function mount(props) {
  console.log('å¾®åº”ç”¨æŒ‚è½½', props)
  // æŒ‚è½½åº”ç”¨åˆ°æŒ‡å®šå®¹å™¨
  ReactDOM.render(<App {...props} />, props.container)
}

export async function unmount(props) {
  console.log('å¾®åº”ç”¨å¸è½½')
  // æ¸…ç†å·¥ä½œï¼šå¸è½½DOMã€ç§»é™¤äº‹ä»¶ç›‘å¬ã€æ¸…ç†å®šæ—¶å™¨ç­‰
  ReactDOM.unmountComponentAtNode(props.container)
}

export async function update(props) {
  console.log('å¾®åº”ç”¨æ›´æ–°', props)
  // å¯é€‰ï¼šå¤„ç† props æ›´æ–°
}
```

---

## ğŸ› ï¸ å®ç°æ–¹æ¡ˆæ·±åº¦åˆ†æ

### iframe æ–¹æ¡ˆ

#### æŠ€æœ¯åŸç†
iframe æ˜¯æœ€ç®€å•ç›´æ¥çš„å¾®å‰ç«¯å®ç°æ–¹æ¡ˆï¼Œé€šè¿‡æµè§ˆå™¨åŸç”Ÿçš„éš”ç¦»æœºåˆ¶å®ç°åº”ç”¨é—´çš„å®Œå…¨éš”ç¦»ã€‚

```html
<!-- ä¸»åº”ç”¨ -->
<!DOCTYPE html>
<html>
<head>
  <title>ä¸»åº”ç”¨</title>
</head>
<body>
  <nav>
    <a href="#" onclick="loadApp('user')">ç”¨æˆ·ç®¡ç†</a>
    <a href="#" onclick="loadApp('order')">è®¢å•ç³»ç»Ÿ</a>
  </nav>

  <!-- å¾®åº”ç”¨å®¹å™¨ -->
  <iframe id="micro-app" src="" frameborder="0"
          style="width: 100%; height: 600px;"></iframe>

  <script>
    function loadApp(appName) {
      const iframe = document.getElementById('micro-app')
      const appUrls = {
        user: 'http://localhost:3001',
        order: 'http://localhost:3002'
      }
      iframe.src = appUrls[appName]
    }
  </script>
</body>
</html>
```

#### é€šä¿¡æœºåˆ¶
```javascript
// ä¸»åº”ç”¨ -> å­åº”ç”¨é€šä¿¡
function sendMessageToChild(data) {
  const iframe = document.getElementById('micro-app')
  iframe.contentWindow.postMessage({
    type: 'FROM_PARENT',
    data: data
  }, '*')
}

// å­åº”ç”¨ç›‘å¬ä¸»åº”ç”¨æ¶ˆæ¯
window.addEventListener('message', (event) => {
  if (event.data.type === 'FROM_PARENT') {
    console.log('æ”¶åˆ°ä¸»åº”ç”¨æ¶ˆæ¯:', event.data.data)
    handleParentMessage(event.data.data)
  }
})

// å­åº”ç”¨ -> ä¸»åº”ç”¨é€šä¿¡
function sendMessageToParent(data) {
  window.parent.postMessage({
    type: 'FROM_CHILD',
    data: data
  }, '*')
}

// ä¸»åº”ç”¨ç›‘å¬å­åº”ç”¨æ¶ˆæ¯
window.addEventListener('message', (event) => {
  if (event.data.type === 'FROM_CHILD') {
    console.log('æ”¶åˆ°å­åº”ç”¨æ¶ˆæ¯:', event.data.data)
    handleChildMessage(event.data.data)
  }
})
```

#### ä¼˜ç¼ºç‚¹åˆ†æ

**âœ… ä¼˜åŠ¿**ï¼š
- **å®Œç¾éš”ç¦»**ï¼šCSSã€JavaScript å®Œå…¨éš”ç¦»ï¼Œæ— å†²çªé£é™©
- **æŠ€æœ¯æ ˆæ— å…³**ï¼šå­åº”ç”¨å¯ä½¿ç”¨ä»»æ„æŠ€æœ¯æ ˆ
- **å®ç°ç®€å•**ï¼šæ— éœ€é¢å¤–æ¡†æ¶ï¼ŒåŸç”Ÿæ”¯æŒ
- **å®‰å…¨æ€§é«˜**ï¼šæµè§ˆå™¨çº§åˆ«çš„å®‰å…¨éš”ç¦»

**âŒ åŠ£åŠ¿**ï¼š
```javascript
// é—®é¢˜1ï¼šURL çŠ¶æ€åŒæ­¥å›°éš¾
// ä¸»åº”ç”¨ URL: https://main.com/user
// iframe URL: https://sub.com/user/list
// ç”¨æˆ·åˆ·æ–°å iframe çŠ¶æ€ä¸¢å¤±

// é—®é¢˜2ï¼šå¼¹çª—è¢«é™åˆ¶åœ¨ iframe å†…
function showModal() {
  // æ¨¡æ€æ¡†åªèƒ½åœ¨ iframe èŒƒå›´å†…æ˜¾ç¤º
  // æ— æ³•è¦†ç›–æ•´ä¸ªä¸»åº”ç”¨é¡µé¢
}

// é—®é¢˜3ï¼šå“åº”å¼å¸ƒå±€å›°éš¾
// iframe é«˜åº¦éœ€è¦æ‰‹åŠ¨è®¡ç®—å’Œè°ƒæ•´
function adjustIframeHeight() {
  const iframe = document.getElementById('micro-app')
  // éœ€è¦å­åº”ç”¨ä¸»åŠ¨é€šçŸ¥é«˜åº¦å˜åŒ–
  iframe.style.height = calculatedHeight + 'px'
}
```

### Web Components æ–¹æ¡ˆ

#### æŠ€æœ¯åŸç†
åŸºäº Web Components æ ‡å‡†ï¼ˆCustom Elements + Shadow DOM + HTML Templatesï¼‰å®ç°å¾®å‰ç«¯ã€‚

```javascript
// å®šä¹‰å¾®åº”ç”¨ç»„ä»¶
class UserManagementApp extends HTMLElement {
  constructor() {
    super()
    this.shadow = this.attachShadow({ mode: 'open' })
  }

  connectedCallback() {
    // ç»„ä»¶è¢«æ’å…¥ DOM æ—¶è°ƒç”¨
    this.render()
    this.loadApp()
  }

  disconnectedCallback() {
    // ç»„ä»¶è¢«ç§»é™¤æ—¶è°ƒç”¨
    this.cleanup()
  }

  attributeChangedCallback(name, oldValue, newValue) {
    // å±æ€§å˜åŒ–æ—¶è°ƒç”¨
    if (name === 'user-id') {
      this.updateUser(newValue)
    }
  }

  static get observedAttributes() {
    return ['user-id', 'theme']
  }

  render() {
    this.shadow.innerHTML = `
      <style>
        :host {
          display: block;
          width: 100%;
          height: 100%;
        }
        .container {
          padding: 20px;
          background: var(--bg-color, #fff);
        }
      </style>
      <div class="container">
        <div id="app-root"></div>
      </div>
    `
  }

  async loadApp() {
    // åŠ¨æ€åŠ è½½å­åº”ç”¨ä»£ç 
    const { mount } = await import('http://localhost:3001/app.js')
    const container = this.shadow.getElementById('app-root')

    mount({
      container,
      props: {
        userId: this.getAttribute('user-id'),
        theme: this.getAttribute('theme')
      }
    })
  }

  cleanup() {
    // æ¸…ç†å·¥ä½œ
    const { unmount } = require('./user-app')
    unmount()
  }
}

// æ³¨å†Œè‡ªå®šä¹‰å…ƒç´ 
customElements.define('user-management-app', UserManagementApp)
```

#### ä½¿ç”¨ç¤ºä¾‹
```html
<!-- ä¸»åº”ç”¨ä¸­ä½¿ç”¨å¾®åº”ç”¨ -->
<div class="app-layout">
  <nav>
    <button onclick="showUserApp()">ç”¨æˆ·ç®¡ç†</button>
    <button onclick="showOrderApp()">è®¢å•ç³»ç»Ÿ</button>
  </nav>

  <main>
    <!-- åŠ¨æ€æ’å…¥å¾®åº”ç”¨ -->
    <user-management-app
      user-id="123"
      theme="dark"
      style="display: none;">
    </user-management-app>

    <order-system-app
      style="display: none;">
    </order-system-app>
  </main>
</div>

<script>
  function showUserApp() {
    // æ˜¾ç¤ºç”¨æˆ·ç®¡ç†åº”ç”¨
    document.querySelector('user-management-app').style.display = 'block'
    document.querySelector('order-system-app').style.display = 'none'
  }

  function showOrderApp() {
    // æ˜¾ç¤ºè®¢å•ç³»ç»Ÿåº”ç”¨
    document.querySelector('user-management-app').style.display = 'none'
    document.querySelector('order-system-app').style.display = 'block'
  }
</script>
```

#### é«˜çº§ç‰¹æ€§
```javascript
// æ”¯æŒå±æ€§å’Œäº‹ä»¶çš„å¾®åº”ç”¨ç»„ä»¶
class AdvancedMicroApp extends HTMLElement {
  constructor() {
    super()
    this.shadow = this.attachShadow({ mode: 'open' })
  }

  // å¯¹å¤–æš´éœ²æ–¹æ³•
  refresh() {
    this.loadData()
  }

  updateData(data) {
    this.appInstance.setState(data)
  }

  // å‘é€è‡ªå®šä¹‰äº‹ä»¶
  handleUserAction(action) {
    this.dispatchEvent(new CustomEvent('user-action', {
      detail: { action, timestamp: Date.now() },
      bubbles: true
    }))
  }
}

// ä¸»åº”ç”¨ç›‘å¬å¾®åº”ç”¨äº‹ä»¶
document.addEventListener('user-action', (event) => {
  console.log('ç”¨æˆ·æ“ä½œ:', event.detail)
  // å¯ä»¥é€šçŸ¥å…¶ä»–å¾®åº”ç”¨æˆ–æ›´æ–°å…¨å±€çŠ¶æ€
})
```

### Module Federation (Webpack 5)

#### æŠ€æœ¯åŸç†
Module Federation æ˜¯ Webpack 5 çš„é©å‘½æ€§ç‰¹æ€§ï¼Œå…è®¸åº”ç”¨é—´åŠ¨æ€å…±äº«ä»£ç å’Œä¾èµ–ã€‚

```javascript
// ä¸»åº”ç”¨ webpack é…ç½®
const ModuleFederationPlugin = require('@module-federation/webpack')

module.exports = {
  mode: 'development',
  devServer: {
    port: 3000
  },
  plugins: [
    new ModuleFederationPlugin({
      name: 'shell',
      remotes: {
        // å®šä¹‰è¿œç¨‹åº”ç”¨
        userApp: 'userApp@http://localhost:3001/remoteEntry.js',
        orderApp: 'orderApp@http://localhost:3002/remoteEntry.js'
      },
      shared: {
        // å…±äº«ä¾èµ–
        react: { singleton: true },
        'react-dom': { singleton: true }
      }
    })
  ]
}

// å­åº”ç”¨ webpack é…ç½®
module.exports = {
  mode: 'development',
  devServer: {
    port: 3001
  },
  plugins: [
    new ModuleFederationPlugin({
      name: 'userApp',
      filename: 'remoteEntry.js',
      exposes: {
        // æš´éœ²ç»„ä»¶æˆ–æ¨¡å—
        './App': './src/App',
        './UserList': './src/components/UserList',
        './utils': './src/utils'
      },
      shared: {
        react: { singleton: true },
        'react-dom': { singleton: true }
      }
    })
  ]
}
```

#### åŠ¨æ€å¯¼å…¥ä½¿ç”¨
```javascript
// ä¸»åº”ç”¨ä¸­åŠ¨æ€å¯¼å…¥å¾®åº”ç”¨
import React, { Suspense, lazy } from 'react'

// æ‡’åŠ è½½è¿œç¨‹ç»„ä»¶
const UserApp = lazy(() => import('userApp/App'))
const OrderApp = lazy(() => import('orderApp/App'))
const UserList = lazy(() => import('userApp/UserList'))

function ShellApp() {
  return (
    <Router>
      <nav>
        <Link to="/user">ç”¨æˆ·ç®¡ç†</Link>
        <Link to="/order">è®¢å•ç³»ç»Ÿ</Link>
      </nav>

      <Routes>
        <Route
          path="/user/*"
          element={
            <Suspense fallback={<div>åŠ è½½ä¸­...</div>}>
              <UserApp />
            </Suspense>
          }
        />
        <Route
          path="/order/*"
          element={
            <Suspense fallback={<div>åŠ è½½ä¸­...</div>}>
              <OrderApp />
            </Suspense>
          }
        />
        <Route
          path="/dashboard"
          element={
            <Suspense fallback={<div>åŠ è½½ä¸­...</div>}>
              <UserList maxCount={5} />
            </Suspense>
          }
        />
      </Routes>
    </Router>
  )
}
```

#### é«˜çº§é…ç½®
```javascript
// åŠ¨æ€è¿œç¨‹é…ç½®
const ModuleFederationPlugin = require('@module-federation/webpack')

module.exports = {
  plugins: [
    new ModuleFederationPlugin({
      name: 'shell',
      remotes: {
        // æ”¯æŒåŠ¨æ€é…ç½®è¿œç¨‹åœ°å€
        userApp: `promise new Promise(resolve => {
          const remoteUrl = window.getMicroAppUrl('userApp')
          resolve(remoteUrl)
        })`,
      },
      shared: {
        react: {
          singleton: true,
          requiredVersion: '^18.0.0'
        },
        // è‡ªå®šä¹‰å…±äº«åº“
        '@company/design-system': {
          singleton: true
        }
      }
    })
  ]
}

// è¿è¡Œæ—¶åŠ¨æ€åŠ è½½
async function loadMicroApp(appName) {
  try {
    const containerUrl = await getMicroAppUrl(appName)

    // åŠ¨æ€åˆ›å»º script æ ‡ç­¾åŠ è½½è¿œç¨‹åº”ç”¨
    await loadRemoteEntry(containerUrl)

    // å¯¼å…¥è¿œç¨‹æ¨¡å—
    const remoteApp = await import(`${appName}/App`)
    return remoteApp.default
  } catch (error) {
    console.error(`åŠ è½½å¾®åº”ç”¨ ${appName} å¤±è´¥:`, error)
    return null
  }
}
```

### Single-SPA æ–¹æ¡ˆ

#### æŠ€æœ¯åŸç†
Single-SPA æ˜¯ä¸€ä¸ªå¾®å‰ç«¯æ¡†æ¶ï¼Œé€šè¿‡ç”Ÿå‘½å‘¨æœŸç®¡ç†å®ç°å¤šåº”ç”¨åè°ƒè¿è¡Œã€‚

```javascript
// ä¸»åº”ç”¨é…ç½®
import { registerApplication, start } from 'single-spa'

// æ³¨å†Œå¾®åº”ç”¨
registerApplication({
  name: 'user-management',
  app: () => import('./microfrontends/user-management/main.js'),
  activeWhen: '/user',
  customProps: {
    theme: 'dark',
    apiBaseUrl: 'https://api.example.com'
  }
})

registerApplication({
  name: 'order-system',
  app: () => import('./microfrontends/order-system/main.js'),
  activeWhen: ['/order', '/orders'],
  customProps: {
    enableAnalytics: true
  }
})

// å¯åŠ¨ single-spa
start({
  urlRerouteOnly: true  // åªåœ¨ URL å˜åŒ–æ—¶é‡æ–°è·¯ç”±
})
```

#### å¾®åº”ç”¨é€‚é…
```javascript
// å¾®åº”ç”¨å…¥å£æ–‡ä»¶ (React åº”ç”¨)
import React from 'react'
import ReactDOM from 'react-dom'
import singleSpaReact from 'single-spa-react'
import App from './App'

// ç”Ÿå‘½å‘¨æœŸé€‚é…å™¨
const lifecycles = singleSpaReact({
  React,
  ReactDOM,
  rootComponent: App,
  errorBoundary(err, info, props) {
    // é”™è¯¯è¾¹ç•Œå¤„ç†
    return <div>åº”ç”¨å‡ºé”™äº†: {err.message}</div>
  }
})

// å¯¼å‡ºæ ‡å‡†ç”Ÿå‘½å‘¨æœŸæ–¹æ³•
export const { bootstrap, mount, unmount } = lifecycles

// å¯é€‰çš„ update ç”Ÿå‘½å‘¨æœŸ
export function update(props) {
  return Promise.resolve()
}
```

#### Vue åº”ç”¨é€‚é…
```javascript
// Vue å¾®åº”ç”¨é€‚é…
import Vue from 'vue'
import singleSpaVue from 'single-spa-vue'
import App from './App.vue'

const vueLifecycles = singleSpaVue({
  Vue,
  appOptions: {
    render: h => h(App),
    router,  // Vue Router å®ä¾‹
    store    // Vuex Store å®ä¾‹
  }
})

export const { bootstrap, mount, unmount } = vueLifecycles
```

#### åº”ç”¨é—´é€šä¿¡
```javascript
// ä½¿ç”¨ single-spa çš„è‡ªå®šä¹‰äº‹ä»¶ç³»ç»Ÿ
import { navigateToUrl } from 'single-spa'

// åº”ç”¨A - å‘é€æ¶ˆæ¯
function notifyOtherApps(data) {
  window.dispatchEvent(new CustomEvent('user-updated', {
    detail: data
  }))
}

// åº”ç”¨B - ç›‘å¬æ¶ˆæ¯
window.addEventListener('user-updated', (event) => {
  console.log('ç”¨æˆ·ä¿¡æ¯æ›´æ–°:', event.detail)
  updateLocalUserData(event.detail)
})

// ç¼–ç¨‹å¼å¯¼èˆª
function goToOrderPage(orderId) {
  navigateToUrl(`/order/detail/${orderId}`)
}
```

### qiankun æ–¹æ¡ˆ

#### æŠ€æœ¯åŸç†
qiankun æ˜¯åŸºäº single-spa çš„ä¼ä¸šçº§å¾®å‰ç«¯è§£å†³æ–¹æ¡ˆï¼Œæä¾›äº†æ›´å®Œå–„çš„æ²™ç®±éš”ç¦»å’Œé€šä¿¡æœºåˆ¶ã€‚

```javascript
// ä¸»åº”ç”¨é…ç½®
import { registerMicroApps, start } from 'qiankun'

// æ³¨å†Œå¾®åº”ç”¨
registerMicroApps([
  {
    name: 'user-management',
    entry: '//localhost:3001',
    container: '#user-container',
    activeRule: '/user',
    props: {
      routerBase: '/user',
      getGlobalState: () => globalStore.getState()
    }
  },
  {
    name: 'order-system',
    entry: '//localhost:3002',
    container: '#order-container',
    activeRule: '/order'
  }
], {
  // å…¨å±€é…ç½®
  beforeLoad: [
    app => {
      console.log('before load', app.name)
    }
  ],
  beforeMount: [
    app => {
      console.log('before mount', app.name)
    }
  ],
  afterUnmount: [
    app => {
      console.log('after unmount', app.name)
    }
  ]
})

// å¯åŠ¨ qiankun
start({
  sandbox: {
    strictStyleIsolation: true,  // ä¸¥æ ¼æ ·å¼éš”ç¦»
    experimentalStyleIsolation: true  // å®éªŒæ€§æ ·å¼éš”ç¦»
  },
  prefetch: 'all'  // é¢„åŠ è½½æ‰€æœ‰å¾®åº”ç”¨
})
```

#### å…¨å±€çŠ¶æ€ç®¡ç†
```javascript
// ä¸»åº”ç”¨ - åˆå§‹åŒ–å…¨å±€çŠ¶æ€
import { initGlobalState } from 'qiankun'

const actions = initGlobalState({
  user: { id: 1, name: 'å¼ ä¸‰' },
  theme: 'light'
})

// ç›‘å¬å…¨å±€çŠ¶æ€å˜åŒ–
actions.onGlobalStateChange((value, prev) => {
  console.log('[ä¸»åº”ç”¨] å…¨å±€çŠ¶æ€å˜åŒ–:', value, prev)
})

// è®¾ç½®å…¨å±€çŠ¶æ€
actions.setGlobalState({
  user: { id: 2, name: 'æå››' }
})

// å¾®åº”ç”¨ - ä½¿ç”¨å…¨å±€çŠ¶æ€
export async function mount(props) {
  const { onGlobalStateChange, setGlobalState } = props

  // ç›‘å¬å…¨å±€çŠ¶æ€å˜åŒ–
  onGlobalStateChange?.((value, prev) => {
    console.log('[å¾®åº”ç”¨] å…¨å±€çŠ¶æ€å˜åŒ–:', value, prev)
    updateComponentState(value)
  }, true)  // true è¡¨ç¤ºç«‹å³æ‰§è¡Œä¸€æ¬¡å›è°ƒ

  // æ›´æ–°å…¨å±€çŠ¶æ€
  setGlobalState?.({
    theme: 'dark'
  })

  // æ¸²æŸ“åº”ç”¨
  render(props)
}
```

#### å¾®åº”ç”¨ç”Ÿå‘½å‘¨æœŸ
```javascript
// å¾®åº”ç”¨å®Œæ•´ç”Ÿå‘½å‘¨æœŸå®ç°
let instance = null

export async function bootstrap() {
  console.log('å¾®åº”ç”¨å¯åŠ¨')
  // å¯ä»¥åœ¨è¿™é‡Œåšä¸€äº›å…¨å±€åˆå§‹åŒ–
}

export async function mount(props) {
  console.log('å¾®åº”ç”¨æŒ‚è½½:', props)

  const { container, routerBase } = props

  // React åº”ç”¨æŒ‚è½½
  instance = ReactDOM.render(
    <App
      routerBase={routerBase}
      globalProps={props}
    />,
    container ? container.querySelector('#root') : document.getElementById('root')
  )
}

export async function unmount(props) {
  console.log('å¾®åº”ç”¨å¸è½½')

  const { container } = props

  // å¸è½½ React åº”ç”¨
  ReactDOM.unmountComponentAtNode(
    container ? container.querySelector('#root') : document.getElementById('root')
  )

  instance = null
}

// å¯é€‰ - åº”ç”¨æ›´æ–°æ—¶è§¦å‘
export async function update(props) {
  console.log('å¾®åº”ç”¨æ›´æ–°:', props)
}
```

---

## ğŸ“Š æŠ€æœ¯æ–¹æ¡ˆå¯¹æ¯”çŸ©é˜µ

### ç»¼åˆå¯¹æ¯”è¡¨

| ç‰¹æ€§ | iframe | Web Components | Module Federation | Single-SPA | qiankun | Micro App |
|------|--------|----------------|-------------------|------------|---------|-----------|
| **æŠ€æœ¯æ ˆæ— å…³** | âœ… å®Œå…¨æ”¯æŒ | âœ… å®Œå…¨æ”¯æŒ | âŒ é™ Webpack | âœ… å®Œå…¨æ”¯æŒ | âœ… å®Œå…¨æ”¯æŒ | âœ… å®Œå…¨æ”¯æŒ |
| **æ ·å¼éš”ç¦»** | âœ… å®Œç¾éš”ç¦» | âœ… Shadow DOM | âŒ éœ€æ‰‹åŠ¨å¤„ç† | âŒ éœ€æ‰‹åŠ¨å¤„ç† | âœ… è‡ªåŠ¨éš”ç¦» | âœ… è‡ªåŠ¨éš”ç¦» |
| **JS éš”ç¦»** | âœ… å®Œç¾éš”ç¦» | âœ… ä½œç”¨åŸŸéš”ç¦» | âŒ å…¨å±€æ±¡æŸ“ | âŒ å…¨å±€æ±¡æŸ“ | âœ… æ²™ç®±éš”ç¦» | âœ… æ²™ç®±éš”ç¦» |
| **é€šä¿¡æœºåˆ¶** | âš ï¸ postMessage | âš ï¸ äº‹ä»¶/å±æ€§ | âœ… å…±äº«çŠ¶æ€ | âš ï¸ äº‹ä»¶æ€»çº¿ | âœ… å…¨å±€çŠ¶æ€ | âœ… å…¨å±€çŠ¶æ€ |
| **SEO å‹å¥½** | âŒ æœç´¢ä¸åˆ° | âœ… åŸç”Ÿæ”¯æŒ | âœ… åŸç”Ÿæ”¯æŒ | âœ… åŸç”Ÿæ”¯æŒ | âœ… åŸç”Ÿæ”¯æŒ | âœ… åŸç”Ÿæ”¯æŒ |
| **é¦–å±æ€§èƒ½** | âŒ æ…¢ | âœ… å¥½ | âœ… å¾ˆå¥½ | âœ… å¥½ | âœ… å¥½ | âœ… å¥½ |
| **å¼€å‘ä½“éªŒ** | âš ï¸ ä¸€èˆ¬ | âš ï¸ ä¸€èˆ¬ | âœ… å¾ˆå¥½ | âœ… å¥½ | âœ… å¾ˆå¥½ | âœ… å¾ˆå¥½ |
| **å­¦ä¹ æˆæœ¬** | âœ… å¾ˆä½ | âš ï¸ ä¸­ç­‰ | âš ï¸ ä¸­ç­‰ | âš ï¸ ä¸­ç­‰ | âœ… ä½ | âœ… ä½ |
| **ç”Ÿæ€æˆç†Ÿåº¦** | âœ… åŸç”Ÿ | âš ï¸ å‘å±•ä¸­ | âœ… æˆç†Ÿ | âœ… æˆç†Ÿ | âœ… æˆç†Ÿ | âš ï¸ æ–°å…´ |

### è¯¦ç»†åˆ†æ

#### éš”ç¦»èƒ½åŠ›å¯¹æ¯”
```javascript
// éš”ç¦»ç¨‹åº¦æ’åï¼ˆå¼º â†’ å¼±ï¼‰
const isolationRanking = [
  {
    solution: 'iframe',
    level: 'å®Œç¾éš”ç¦»',
    detail: 'æµè§ˆå™¨åŸç”Ÿéš”ç¦»ï¼ŒCSS/JS/DOM å®Œå…¨ç‹¬ç«‹'
  },
  {
    solution: 'Web Components',
    level: 'å¼ºéš”ç¦»',
    detail: 'Shadow DOM éš”ç¦»æ ·å¼ï¼Œä½œç”¨åŸŸéš”ç¦» JS'
  },
  {
    solution: 'qiankun',
    level: 'è‰¯å¥½éš”ç¦»',
    detail: 'Proxy æ²™ç®± + æ ·å¼éš”ç¦»ï¼Œæ‰‹åŠ¨æ¸…ç†å‰¯ä½œç”¨'
  },
  {
    solution: 'Single-SPA',
    level: 'åŸºç¡€éš”ç¦»',
    detail: 'ä¾èµ–ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼Œéœ€æ‰‹åŠ¨å¤„ç†å†²çª'
  },
  {
    solution: 'Module Federation',
    level: 'æ— éš”ç¦»',
    detail: 'å…±äº«è¿è¡Œæ—¶ï¼Œéœ€æ‰‹åŠ¨å¤„ç†æ ·å¼å’Œå…¨å±€å˜é‡å†²çª'
  }
]
```

#### æ€§èƒ½å¯¹æ¯”
```javascript
// åŸºäºçœŸå®é¡¹ç›®æµ‹è¯•æ•°æ®
const performanceComparison = {
  'iframe': {
    firstLoad: '3.2s',
    subsequentLoad: '1.8s',
    memoryUsage: 'é«˜',
    bundleSize: 'ä¸é€‚ç”¨'
  },
  'qiankun': {
    firstLoad: '2.1s',
    subsequentLoad: '0.8s',
    memoryUsage: 'ä¸­',
    bundleSize: '+15KB'
  },
  'ModuleFederation': {
    firstLoad: '1.8s',
    subsequentLoad: '0.3s',
    memoryUsage: 'ä½',
    bundleSize: 'ä¼˜åŒ–åæ›´å°'
  },
  'SingleSPA': {
    firstLoad: '2.0s',
    subsequentLoad: '0.5s',
    memoryUsage: 'ä¸­',
    bundleSize: '+8KB'
  }
}
```

### é€‰å‹å†³ç­–æ ‘

```
é¡¹ç›®éœ€æ±‚åˆ†æ
â”‚
â”œâ”€â”€ éœ€è¦å®Œç¾éš”ç¦»ï¼Ÿ
â”‚   â”œâ”€â”€ æ˜¯ â†’ iframe æˆ– Web Components
â”‚   â”‚   â”œâ”€â”€ åœ¨æ„ SEOï¼Ÿ
â”‚   â”‚   â”‚   â”œâ”€â”€ æ˜¯ â†’ Web Components
â”‚   â”‚   â”‚   â””â”€â”€ å¦ â†’ iframe
â”‚   â”‚   â””â”€â”€ éœ€è¦æ€§èƒ½ä¼˜åŒ–ï¼Ÿ
â”‚   â”‚       â”œâ”€â”€ æ˜¯ â†’ Web Components
â”‚   â”‚       â””â”€â”€ å¦ â†’ iframe
â”‚   â”‚
â”‚   â””â”€â”€ å¦ â†’ ç»§ç»­åˆ†æ
â”‚       â”‚
â”‚       â”œâ”€â”€ æŠ€æœ¯æ ˆç»Ÿä¸€ï¼ˆReact/Vueï¼‰ï¼Ÿ
â”‚       â”‚   â”œâ”€â”€ æ˜¯ â†’ Module Federation
â”‚       â”‚   â””â”€â”€ å¦ â†’ qiankun æˆ– Single-SPA
â”‚       â”‚
â”‚       â”œâ”€â”€ éœ€è¦ä¼ä¸šçº§ç‰¹æ€§ï¼Ÿ
â”‚       â”‚   â”œâ”€â”€ æ˜¯ â†’ qiankun
â”‚       â”‚   â””â”€â”€ å¦ â†’ Single-SPA
â”‚       â”‚
â”‚       â””â”€â”€ å›¢é˜ŸæŠ€æœ¯æ°´å¹³ï¼Ÿ
â”‚           â”œâ”€â”€ é«˜ â†’ è‡ªç ”æ–¹æ¡ˆ
â”‚           â””â”€â”€ ä¸­ç­‰ â†’ qiankun
```

---

## ğŸ’¼ å®è·µæ¡ˆä¾‹

### æ¡ˆä¾‹1ï¼šåŸºäº qiankun çš„åå°ç®¡ç†ç³»ç»Ÿ

#### é¡¹ç›®èƒŒæ™¯
æŸç”µå•†å…¬å¸çš„åå°ç®¡ç†ç³»ç»Ÿï¼ŒåŒ…å«ç”¨æˆ·ç®¡ç†ã€å•†å“ç®¡ç†ã€è®¢å•ç®¡ç†ã€æ•°æ®åˆ†æç­‰æ¨¡å—ï¼Œç”±4ä¸ªä¸åŒå›¢é˜Ÿç»´æŠ¤ã€‚

#### æ¶æ„è®¾è®¡
```javascript
// ä¸»åº”ç”¨é…ç½® (Shell App)
// main-app/src/index.js
import { registerMicroApps, start, setDefaultMountApp } from 'qiankun'

const microApps = [
  {
    name: 'user-management',
    entry: process.env.NODE_ENV === 'development'
      ? '//localhost:3001'
      : '//admin.company.com/user',
    container: '#subapp-container',
    activeRule: '/user',
    props: {
      routerBase: '/user',
      theme: 'ant-design'
    }
  },
  {
    name: 'product-management',
    entry: process.env.NODE_ENV === 'development'
      ? '//localhost:3002'
      : '//admin.company.com/product',
    container: '#subapp-container',
    activeRule: '/product'
  },
  {
    name: 'order-management',
    entry: '//localhost:3003',
    container: '#subapp-container',
    activeRule: '/order'
  },
  {
    name: 'analytics',
    entry: '//localhost:3004',
    container: '#subapp-container',
    activeRule: '/analytics'
  }
]

// æ³¨å†Œå¾®åº”ç”¨
registerMicroApps(microApps, {
  beforeLoad: [
    app => {
      console.log('[ç”Ÿå‘½å‘¨æœŸ] before load %c%s', 'color: green;', app.name)
      // åŠ è½½å‰æ˜¾ç¤º loading
      showLoading()
    }
  ],
  beforeMount: [
    app => {
      console.log('[ç”Ÿå‘½å‘¨æœŸ] before mount %c%s', 'color: green;', app.name)
    }
  ],
  afterMount: [
    app => {
      console.log('[ç”Ÿå‘½å‘¨æœŸ] after mount %c%s', 'color: green;', app.name)
      // æŒ‚è½½åéšè— loading
      hideLoading()
    }
  ],
  beforeUnmount: [
    app => {
      console.log('[ç”Ÿå‘½å‘¨æœŸ] before unmount %c%s', 'color: green;', app.name)
    }
  ],
  afterUnmount: [
    app => {
      console.log('[ç”Ÿå‘½å‘¨æœŸ] after unmount %c%s', 'color: green;', app.name)
    }
  ]
})

// è®¾ç½®é»˜è®¤è¿›å…¥çš„å­åº”ç”¨
setDefaultMountApp('/user')

// å¯åŠ¨ qiankun
start()
```

#### ä¸»åº”ç”¨å¸ƒå±€
```jsx
// main-app/src/App.jsx
import React, { useState } from 'react'
import { Layout, Menu, Avatar, Dropdown, Spin } from 'antd'
import { UserOutlined, ShopOutlined, FileTextOutlined, BarChartOutlined } from '@ant-design/icons'

const { Header, Sider, Content } = Layout

function App() {
  const [loading, setLoading] = useState(false)

  // å…¨å±€ loading æ§åˆ¶
  window.showLoading = () => setLoading(true)
  window.hideLoading = () => setLoading(false)

  const menuItems = [
    {
      key: '/user',
      icon: <UserOutlined />,
      label: 'ç”¨æˆ·ç®¡ç†'
    },
    {
      key: '/product',
      icon: <ShopOutlined />,
      label: 'å•†å“ç®¡ç†'
    },
    {
      key: '/order',
      icon: <FileTextOutlined />,
      label: 'è®¢å•ç®¡ç†'
    },
    {
      key: '/analytics',
      icon: <BarChartOutlined />,
      label: 'æ•°æ®åˆ†æ'
    }
  ]

  const handleMenuClick = ({ key }) => {
    // ä½¿ç”¨ history API è¿›è¡Œè·¯ç”±è·³è½¬
    window.history.pushState(null, '', key)
  }

  return (
    <Layout style={{ minHeight: '100vh' }}>
      <Header style={{ background: '#fff', boxShadow: '0 2px 8px rgba(0,0,0,0.1)' }}>
        <div style={{ float: 'right' }}>
          <Dropdown
            menu={{
              items: [
                { key: 'profile', label: 'ä¸ªäººè®¾ç½®' },
                { key: 'logout', label: 'é€€å‡ºç™»å½•' }
              ]
            }}
          >
            <Avatar icon={<UserOutlined />} />
          </Dropdown>
        </div>
        <h2 style={{ color: '#1890ff', margin: 0 }}>ç”µå•†åå°ç®¡ç†ç³»ç»Ÿ</h2>
      </Header>

      <Layout>
        <Sider width={200} style={{ background: '#fff' }}>
          <Menu
            mode="inline"
            items={menuItems}
            onClick={handleMenuClick}
            style={{ height: '100%', borderRight: 0 }}
          />
        </Sider>

        <Content style={{ padding: '24px', background: '#f0f2f5' }}>
          <Spin spinning={loading} tip="åŠ è½½ä¸­...">
            {/* å¾®åº”ç”¨å®¹å™¨ */}
            <div id="subapp-container" style={{ minHeight: '400px' }} />
          </Spin>
        </Content>
      </Layout>
    </Layout>
  )
}

export default App
```

#### å¾®åº”ç”¨é€‚é… (ç”¨æˆ·ç®¡ç†æ¨¡å—)
```javascript
// user-management/src/index.js
import React from 'react'
import ReactDOM from 'react-dom'
import App from './App'
import { ConfigProvider } from 'antd'
import zhCN from 'antd/lib/locale/zh_CN'

let root = null

function render(props = {}) {
  const { container, routerBase } = props

  root = ReactDOM.render(
    <ConfigProvider locale={zhCN}>
      <App routerBase={routerBase} />
    </ConfigProvider>,
    container ? container.querySelector('#root') : document.querySelector('#root')
  )
}

// ç‹¬ç«‹è¿è¡Œæ—¶
if (!window.__POWERED_BY_QIANKUN__) {
  render()
}

// å¾®å‰ç«¯ç”Ÿå‘½å‘¨æœŸ
export async function bootstrap() {
  console.log('[react18] react app bootstraped')
}

export async function mount(props) {
  console.log('[react18] props from main framework', props)
  render(props)
}

export async function unmount(props) {
  const { container } = props
  ReactDOM.unmountComponentAtNode(
    container ? container.querySelector('#root') : document.querySelector('#root')
  )
  root = null
}
```

#### éƒ¨ç½²é…ç½®
```javascript
// user-management/webpack.config.js
const { ModuleFederationPlugin } = require('@module-federation/webpack')

module.exports = {
  entry: './src/index',
  mode: 'development',
  devServer: {
    port: 3001,
    headers: {
      'Access-Control-Allow-Origin': '*',
      'Access-Control-Allow-Methods': 'GET, POST, PUT, DELETE, PATCH, OPTIONS',
      'Access-Control-Allow-Headers': 'X-Requested-With, content-type, Authorization'
    }
  },
  output: {
    publicPath: 'auto',
    // ç¡®ä¿èµ„æºè·¯å¾„æ­£ç¡®
    library: `user-management-[name]`,
    libraryTarget: 'umd',
    jsonpFunction: `webpackJsonp_user_management`
  }
}
```

#### æ•ˆæœæ€»ç»“
- **å¼€å‘æ•ˆç‡æå‡ 40%**ï¼šå„å›¢é˜Ÿç‹¬ç«‹å¼€å‘ï¼Œå‡å°‘æ²Ÿé€šæˆæœ¬
- **éƒ¨ç½²é£é™©é™ä½ 70%**ï¼šå•ä¸ªæ¨¡å—éƒ¨ç½²ä¸å½±å“å…¶ä»–åŠŸèƒ½
- **æŠ€æœ¯æ ˆå‡çº§**ï¼šç”¨æˆ·ç®¡ç†æ¨¡å—ç‡å…ˆå‡çº§åˆ° React 18ï¼Œå…¶ä»–æ¨¡å—é€æ­¥è·Ÿè¿›

### æ¡ˆä¾‹2ï¼šModule Federation å¤šå›¢é˜Ÿåä½œ

#### é¡¹ç›®èƒŒæ™¯
æŸ SaaS å¹³å°ï¼ŒåŒ…å«ä»ªè¡¨ç›˜ã€æŠ¥è¡¨ç³»ç»Ÿã€è®¾ç½®ä¸­å¿ƒç­‰ï¼Œå¤šä¸ªå›¢é˜Ÿä½¿ç”¨ç›¸åŒæŠ€æœ¯æ ˆ (React)ã€‚

#### æ¶æ„è®¾è®¡
```javascript
// ä¸»åº”ç”¨ webpack é…ç½®
const ModuleFederationPlugin = require('@module-federation/webpack')

module.exports = {
  mode: 'development',
  devServer: {
    port: 3000
  },
  plugins: [
    new ModuleFederationPlugin({
      name: 'host',
      remotes: {
        dashboard: 'dashboard@http://localhost:3001/remoteEntry.js',
        reports: 'reports@http://localhost:3002/remoteEntry.js',
        settings: 'settings@http://localhost:3003/remoteEntry.js'
      },
      shared: {
        react: { singleton: true, eager: true, requiredVersion: '^18.0.0' },
        'react-dom': { singleton: true, eager: true, requiredVersion: '^18.0.0' },
        'react-router-dom': { singleton: true },
        'antd': { singleton: true },
        '@company/design-system': { singleton: true }
      }
    })
  ]
}

// å­åº”ç”¨ webpack é…ç½® (dashboard)
module.exports = {
  mode: 'development',
  devServer: {
    port: 3001
  },
  plugins: [
    new ModuleFederationPlugin({
      name: 'dashboard',
      filename: 'remoteEntry.js',
      exposes: {
        './App': './src/App',
        './ChartWidget': './src/components/ChartWidget',
        './DataTable': './src/components/DataTable'
      },
      shared: {
        react: { singleton: true, requiredVersion: '^18.0.0' },
        'react-dom': { singleton: true, requiredVersion: '^18.0.0' },
        'antd': { singleton: true }
      }
    })
  ]
}
```

#### ç»„ä»¶çº§å¤ç”¨
```jsx
// ä¸»åº”ç”¨ä¸­ä½¿ç”¨å­åº”ç”¨çš„ç»„ä»¶
import React, { Suspense } from 'react'

// æ‡’åŠ è½½è¿œç¨‹ç»„ä»¶
const DashboardApp = React.lazy(() => import('dashboard/App'))
const ChartWidget = React.lazy(() => import('dashboard/ChartWidget'))
const ReportsApp = React.lazy(() => import('reports/App'))

function HomePage() {
  return (
    <div className="homepage">
      <h1>é¦–é¡µæ¦‚è§ˆ</h1>

      {/* ä½¿ç”¨ä»ªè¡¨ç›˜åº”ç”¨çš„å›¾è¡¨ç»„ä»¶ */}
      <div className="widgets-row">
        <Suspense fallback={<div>Loading chart...</div>}>
          <ChartWidget
            type="line"
            data={salesData}
            title="é”€å”®è¶‹åŠ¿"
          />
        </Suspense>

        <Suspense fallback={<div>Loading chart...</div>}>
          <ChartWidget
            type="pie"
            data={userDistribution}
            title="ç”¨æˆ·åˆ†å¸ƒ"
          />
        </Suspense>
      </div>

      {/* å®Œæ•´çš„ä»ªè¡¨ç›˜åº”ç”¨ */}
      <Suspense fallback={<div>Loading dashboard...</div>}>
        <DashboardApp />
      </Suspense>
    </div>
  )
}
```

#### å…±äº«ä¾èµ–ä¼˜åŒ–
```javascript
// åŠ¨æ€ä¾èµ–å…±äº«
const ModuleFederationPlugin = require('@module-federation/webpack')

const deps = require('./package.json').dependencies

module.exports = {
  plugins: [
    new ModuleFederationPlugin({
      shared: {
        ...deps,
        react: {
          singleton: true,
          requiredVersion: deps.react
        },
        'react-dom': {
          singleton: true,
          requiredVersion: deps['react-dom']
        },
        // è‡ªå®šä¹‰å…±äº«ç­–ç•¥
        'lodash': {
          singleton: false,  // å…è®¸å¤šç‰ˆæœ¬
          requiredVersion: false
        },
        // å…¬å¸å†…éƒ¨ç»„ä»¶åº“
        '@company/ui-components': {
          singleton: true,
          strictVersion: true  // ä¸¥æ ¼ç‰ˆæœ¬åŒ¹é…
        }
      }
    })
  ]
}
```

### æ¡ˆä¾‹3ï¼šiframe é—ç•™ç³»ç»Ÿé›†æˆ

#### é¡¹ç›®èƒŒæ™¯
æŸé‡‘èå…¬å¸éœ€è¦å°†å¤šä¸ªè€æ—§ç³»ç»Ÿï¼ˆJSPã€PHPã€.NETï¼‰é›†æˆåˆ°æ–°çš„Reactä¸»åº”ç”¨ä¸­ã€‚

#### æŠ€æœ¯æ–¹æ¡ˆ
```jsx
// ä¸»åº”ç”¨ - iframe ç®¡ç†å™¨
import React, { useState, useEffect, useRef } from 'react'
import { Spin, message } from 'antd'

function IframeContainer({ src, title, onMessage }) {
  const iframeRef = useRef(null)
  const [loading, setLoading] = useState(true)
  const [height, setHeight] = useState(600)

  useEffect(() => {
    // ç›‘å¬æ¥è‡ª iframe çš„æ¶ˆæ¯
    const handleMessage = (event) => {
      const { type, data } = event.data

      switch (type) {
        case 'IFRAME_LOADED':
          setLoading(false)
          break
        case 'RESIZE_IFRAME':
          setHeight(data.height)
          break
        case 'NAVIGATION':
          // åŒæ­¥è·¯ç”±çŠ¶æ€
          window.history.pushState(null, '', data.url)
          break
        case 'ERROR':
          message.error(`${title} å‘ç”Ÿé”™è¯¯: ${data.message}`)
          break
        default:
          onMessage?.(event.data)
      }
    }

    window.addEventListener('message', handleMessage)
    return () => window.removeEventListener('message', handleMessage)
  }, [title, onMessage])

  // å‘ iframe å‘é€æ¶ˆæ¯
  const postMessageToIframe = (message) => {
    if (iframeRef.current?.contentWindow) {
      iframeRef.current.contentWindow.postMessage(message, '*')
    }
  }

  // æš´éœ²æ–¹æ³•ä¾›çˆ¶ç»„ä»¶è°ƒç”¨
  useEffect(() => {
    if (window.iframeController) {
      window.iframeController[title] = {
        postMessage: postMessageToIframe,
        reload: () => {
          setLoading(true)
          iframeRef.current.src = iframeRef.current.src
        }
      }
    }
  }, [title])

  return (
    <div style={{ position: 'relative', width: '100%' }}>
      {loading && (
        <div style={{
          position: 'absolute',
          top: '50%',
          left: '50%',
          transform: 'translate(-50%, -50%)',
          zIndex: 1000
        }}>
          <Spin size="large" tip={`æ­£åœ¨åŠ è½½${title}...`} />
        </div>
      )}

      <iframe
        ref={iframeRef}
        src={src}
        title={title}
        frameBorder="0"
        width="100%"
        height={height}
        style={{
          border: 'none',
          visibility: loading ? 'hidden' : 'visible'
        }}
        sandbox="allow-scripts allow-same-origin allow-forms allow-popups"
      />
    </div>
  )
}

// ä½¿ç”¨ç¤ºä¾‹
function LegacySystemsPage() {
  const [activeSystem, setActiveSystem] = useState('crm')

  const systems = {
    crm: {
      title: 'CRMç³»ç»Ÿ',
      src: 'https://legacy-crm.company.com'
    },
    finance: {
      title: 'è´¢åŠ¡ç³»ç»Ÿ',
      src: 'https://legacy-finance.company.com'
    },
    hr: {
      title: 'HRç³»ç»Ÿ',
      src: 'https://legacy-hr.company.com'
    }
  }

  const handleSystemMessage = (data) => {
    console.log('æ”¶åˆ°ç³»ç»Ÿæ¶ˆæ¯:', data)
    // å¤„ç†æ¥è‡ªé—ç•™ç³»ç»Ÿçš„æ¶ˆæ¯
  }

  return (
    <div>
      <div className="system-tabs">
        {Object.entries(systems).map(([key, system]) => (
          <button
            key={key}
            onClick={() => setActiveSystem(key)}
            className={activeSystem === key ? 'active' : ''}
          >
            {system.title}
          </button>
        ))}
      </div>

      <IframeContainer
        src={systems[activeSystem].src}
        title={systems[activeSystem].title}
        onMessage={handleSystemMessage}
      />
    </div>
  )
}
```

#### é—ç•™ç³»ç»Ÿé€‚é…è„šæœ¬
```javascript
// æ³¨å…¥åˆ°é—ç•™ç³»ç»Ÿçš„é€‚é…è„šæœ¬
(function() {
  'use strict'

  // å‘ä¸»åº”ç”¨æŠ¥å‘ŠåŠ è½½å®Œæˆ
  function reportLoaded() {
    window.parent.postMessage({
      type: 'IFRAME_LOADED',
      timestamp: Date.now()
    }, '*')
  }

  // åŠ¨æ€è°ƒæ•´é«˜åº¦
  function reportHeight() {
    const height = Math.max(
      document.body.scrollHeight,
      document.body.offsetHeight,
      document.documentElement.clientHeight,
      document.documentElement.scrollHeight,
      document.documentElement.offsetHeight
    )

    window.parent.postMessage({
      type: 'RESIZE_IFRAME',
      data: { height }
    }, '*')
  }

  // æ‹¦æˆªå¯¼èˆªäº‹ä»¶
  function interceptNavigation() {
    const originalPushState = history.pushState
    const originalReplaceState = history.replaceState

    history.pushState = function() {
      originalPushState.apply(history, arguments)
      window.parent.postMessage({
        type: 'NAVIGATION',
        data: { url: location.pathname + location.search }
      }, '*')
    }

    window.addEventListener('popstate', () => {
      window.parent.postMessage({
        type: 'NAVIGATION',
        data: { url: location.pathname + location.search }
      }, '*')
    })
  }

  // é”™è¯¯å¤„ç†
  window.addEventListener('error', (error) => {
    window.parent.postMessage({
      type: 'ERROR',
      data: {
        message: error.message,
        filename: error.filename,
        lineno: error.lineno
      }
    }, '*')
  })

  // ç›‘å¬æ¥è‡ªä¸»åº”ç”¨çš„æ¶ˆæ¯
  window.addEventListener('message', (event) => {
    const { type, data } = event.data

    switch (type) {
      case 'UPDATE_USER_INFO':
        // æ›´æ–°å½“å‰ç”¨æˆ·ä¿¡æ¯
        updateCurrentUser(data.userInfo)
        break
      case 'THEME_CHANGE':
        // åˆ‡æ¢ä¸»é¢˜
        applyTheme(data.theme)
        break
    }
  })

  // é¡µé¢åŠ è½½å®Œæˆåæ‰§è¡Œ
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', () => {
      reportLoaded()
      reportHeight()
      interceptNavigation()
    })
  } else {
    reportLoaded()
    reportHeight()
    interceptNavigation()
  }

  // ç›‘å¬å†…å®¹å˜åŒ–ï¼ŒåŠ¨æ€è°ƒæ•´é«˜åº¦
  const observer = new MutationObserver(reportHeight)
  observer.observe(document.body, {
    childList: true,
    subtree: true,
    attributes: true
  })
})()
```

---

## âœ¨ æœ€ä½³å®è·µ

### æ¶æ„è®¾è®¡åŸåˆ™

#### 1. å•ä¸€èŒè´£åŸåˆ™
æ¯ä¸ªå¾®åº”ç”¨åº”è¯¥åªè´Ÿè´£ä¸€ä¸ªæ˜ç¡®çš„ä¸šåŠ¡é¢†åŸŸï¼Œé¿å…åŠŸèƒ½äº¤å‰é‡å ã€‚

```javascript
// âœ… è‰¯å¥½çš„åº”ç”¨æ‹†åˆ†
const microApps = {
  userManagement: {
    responsibilities: ['ç”¨æˆ·CRUD', 'æƒé™ç®¡ç†', 'ç”¨æˆ·è®¤è¯'],
    boundaries: 'ç”¨æˆ·ç”Ÿå‘½å‘¨æœŸç®¡ç†'
  },
  orderSystem: {
    responsibilities: ['è®¢å•åˆ›å»º', 'æ”¯ä»˜æµç¨‹', 'è®¢å•çŠ¶æ€'],
    boundaries: 'è®¢å•ä¸šåŠ¡å®Œæ•´æµç¨‹'
  },
  inventory: {
    responsibilities: ['åº“å­˜æŸ¥è¯¢', 'åº“å­˜æ›´æ–°', 'é¢„è­¦ç®¡ç†'],
    boundaries: 'åº“å­˜æ•°æ®ç®¡ç†'
  }
}

// âŒ é¿å…çš„åº”ç”¨è®¾è®¡
const badDesign = {
  adminApp: {
    responsibilities: ['ç”¨æˆ·ç®¡ç†', 'è®¢å•ç®¡ç†', 'åº“å­˜ç®¡ç†', 'æŠ¥è¡¨ç³»ç»Ÿ'],
    problem: 'èŒè´£è¿‡å¤šï¼Œè¿åå•ä¸€èŒè´£åŸåˆ™'
  }
}
```

#### 2. æœ€å°åŒ–åº”ç”¨é—´ä¾èµ–
è®¾è®¡æ¾è€¦åˆçš„å¾®åº”ç”¨æ¶æ„ï¼Œå‡å°‘åº”ç”¨é—´çš„ç›´æ¥ä¾èµ–ã€‚

```javascript
// âœ… é€šè¿‡äº‹ä»¶è§£è€¦
// ç”¨æˆ·åº”ç”¨
function updateUserInfo(userInfo) {
  // æ›´æ–°ç”¨æˆ·ä¿¡æ¯
  updateUser(userInfo)

  // å‘å¸ƒäº‹ä»¶ï¼Œä¸ç›´æ¥è°ƒç”¨å…¶ä»–åº”ç”¨
  eventBus.emit('user:updated', userInfo)
}

// è®¢å•åº”ç”¨
eventBus.on('user:updated', (userInfo) => {
  // æ›´æ–°è®¢å•ä¸­çš„ç”¨æˆ·ä¿¡æ¯
  updateOrderUserInfo(userInfo)
})

// âŒ é¿å…ç›´æ¥è°ƒç”¨
function updateUserInfoBad(userInfo) {
  updateUser(userInfo)
  // ç›´æ¥è°ƒç”¨å…¶ä»–åº”ç”¨çš„æ–¹æ³•ï¼Œé€ æˆå¼ºè€¦åˆ
  window.orderApp.updateUserInfo(userInfo)
  window.inventoryApp.refreshUserData(userInfo)
}
```

#### 3. ç»Ÿä¸€çš„æŠ€æœ¯æ ‡å‡†
åˆ¶å®šå›¢é˜Ÿå…±åŒéµå®ˆçš„æŠ€æœ¯è§„èŒƒå’Œæ ‡å‡†ã€‚

```javascript
// æŠ€æœ¯æ ‡å‡†é…ç½®
const technicalStandards = {
  // ç”Ÿå‘½å‘¨æœŸæ ‡å‡†
  lifecycle: {
    bootstrap: 'async function bootstrap()',
    mount: 'async function mount(props)',
    unmount: 'async function unmount(props)',
    update: 'async function update(props)' // å¯é€‰
  },

  // é€šä¿¡åè®®æ ‡å‡†
  communication: {
    eventNaming: 'domain:action', // å¦‚ user:updated, order:created
    messageFormat: {
      type: 'string',
      data: 'object',
      timestamp: 'number',
      source: 'string'
    }
  },

  // é”™è¯¯å¤„ç†æ ‡å‡†
  errorHandling: {
    global: 'window.microAppErrorHandler',
    local: 'try-catch with fallback UI',
    reporting: 'window.errorReporter.report(error)'
  },

  // æ ·å¼è§„èŒƒ
  styling: {
    prefix: 'micro-app-[name]-',
    cssModules: true,
    globalStyles: 'limited to theme variables'
  }
}
```

### åº”ç”¨æ‹†åˆ†ç­–ç•¥

#### æŒ‰ä¸šåŠ¡åŸŸæ‹†åˆ†ï¼ˆæ¨èï¼‰
```javascript
// ç”µå•†ç³»ç»Ÿçš„ä¸šåŠ¡åŸŸæ‹†åˆ†
const businessDomains = {
  user: {
    name: 'ç”¨æˆ·åŸŸ',
    features: ['æ³¨å†Œç™»å½•', 'ä¸ªäººä¿¡æ¯', 'æƒé™ç®¡ç†'],
    team: 'ç”¨æˆ·ä¸­å¿ƒå›¢é˜Ÿ',
    techStack: 'React + TypeScript'
  },

  product: {
    name: 'å•†å“åŸŸ',
    features: ['å•†å“å±•ç¤º', 'åˆ†ç±»ç®¡ç†', 'åº“å­˜ç®¡ç†'],
    team: 'å•†å“å›¢é˜Ÿ',
    techStack: 'Vue + JavaScript'
  },

  order: {
    name: 'è®¢å•åŸŸ',
    features: ['è´­ç‰©è½¦', 'ä¸‹å•æµç¨‹', 'æ”¯ä»˜å¤„ç†'],
    team: 'äº¤æ˜“å›¢é˜Ÿ',
    techStack: 'React + TypeScript'
  },

  analytics: {
    name: 'æ•°æ®åŸŸ',
    features: ['æŠ¥è¡¨å±•ç¤º', 'æ•°æ®åˆ†æ', 'å¯¼å‡ºåŠŸèƒ½'],
    team: 'æ•°æ®å›¢é˜Ÿ',
    techStack: 'Angular + TypeScript'
  }
}
```

#### æŒ‰æŠ€æœ¯ç‰¹æ€§æ‹†åˆ†
```javascript
// ç‰¹æ®Šåœºæ™¯ä¸‹çš„æŠ€æœ¯ç‰¹æ€§æ‹†åˆ†
const technicalSplit = {
  realTimeMonitoring: {
    reason: 'éœ€è¦ WebSocket é•¿è¿æ¥',
    techStack: 'Vue + Socket.io',
    isolation: 'ç‹¬ç«‹è¿›ç¨‹ï¼Œé¿å…å½±å“ä¸»åº”ç”¨æ€§èƒ½'
  },

  heavyComputation: {
    reason: 'å¤§é‡è®¡ç®—ä»»åŠ¡',
    techStack: 'React + Web Workers',
    isolation: 'ç‹¬ç«‹çº¿ç¨‹ï¼Œä¸é˜»å¡ UI'
  },

  legacyIntegration: {
    reason: 'é›†æˆé—ç•™ç³»ç»Ÿ',
    techStack: 'iframe + é€‚é…å±‚',
    isolation: 'å®Œå…¨éš”ç¦»ï¼Œé™ä½é£é™©'
  }
}
```

### æ€§èƒ½ä¼˜åŒ–æ–¹æ¡ˆ

#### 1. é¢„åŠ è½½ç­–ç•¥
```javascript
// qiankun é¢„åŠ è½½é…ç½®
import { start } from 'qiankun'

start({
  prefetch: 'all', // é¢„åŠ è½½æ‰€æœ‰å¾®åº”ç”¨

  // è‡ªå®šä¹‰é¢„åŠ è½½ç­–ç•¥
  getTemplate(tpl) {
    // ç§»é™¤ä¸å¿…è¦çš„èµ„æº
    return tpl.replace(/<script.*?src=".*?analytics\.js".*?><\/script>/g, '')
  },

  // èµ„æºåŠ è½½å¤±è´¥é‡è¯•
  fetch(url, ...args) {
    return fetch(url, ...args).catch(err => {
      console.error(`èµ„æºåŠ è½½å¤±è´¥: ${url}`, err)
      // é‡è¯•é€»è¾‘
      return fetch(url, ...args)
    })
  }
})

// Module Federation é¢„åŠ è½½
const MicroAppLoader = {
  async preloadApps(appNames) {
    const loadPromises = appNames.map(async (name) => {
      try {
        await import(`${name}/App`)
        console.log(`${name} é¢„åŠ è½½æˆåŠŸ`)
      } catch (error) {
        console.warn(`${name} é¢„åŠ è½½å¤±è´¥:`, error)
      }
    })

    await Promise.allSettled(loadPromises)
  }
}

// åœ¨ç”¨æˆ·å¯èƒ½è®¿é—®çš„è·¯ç”±å‰é¢„åŠ è½½
router.beforeEach(async (to) => {
  if (to.path.startsWith('/user')) {
    MicroAppLoader.preloadApps(['userApp'])
  }
})
```

#### 2. ä»£ç åˆ†å‰²ä¼˜åŒ–
```javascript
// ä¸»åº”ç”¨ä»£ç åˆ†å‰²
import { lazy, Suspense } from 'react'

// è·¯ç”±çº§åˆ«çš„æ‡’åŠ è½½
const UserApp = lazy(() =>
  import('userApp/App').catch(() =>
    // é™çº§æ–¹æ¡ˆ
    import('./fallback/UserFallback')
  )
)

// ç»„ä»¶çº§åˆ«çš„æ‡’åŠ è½½
const LazyChart = lazy(() =>
  import('dashboard/ChartWidget').then(module => ({
    default: module.ChartWidget
  }))
)

function App() {
  return (
    <Router>
      <Routes>
        <Route
          path="/user/*"
          element={
            <Suspense fallback={<AppSkeleton />}>
              <ErrorBoundary fallback={<ErrorFallback />}>
                <UserApp />
              </ErrorBoundary>
            </Suspense>
          }
        />
      </Routes>
    </Router>
  )
}
```

#### 3. ç¼“å­˜ç­–ç•¥
```javascript
// å¾®åº”ç”¨èµ„æºç¼“å­˜
class MicroAppCache {
  constructor() {
    this.cache = new Map()
    this.maxAge = 5 * 60 * 1000 // 5åˆ†é’Ÿ
  }

  async getApp(name, loader) {
    const cached = this.cache.get(name)

    if (cached && Date.now() - cached.timestamp < this.maxAge) {
      return cached.app
    }

    const app = await loader()
    this.cache.set(name, {
      app,
      timestamp: Date.now()
    })

    return app
  }

  invalidate(name) {
    this.cache.delete(name)
  }

  clear() {
    this.cache.clear()
  }
}

// å…¨å±€çŠ¶æ€ç¼“å­˜
class GlobalStateCache {
  constructor() {
    this.cache = new Map()
    this.subscribers = new Map()
  }

  subscribe(key, callback) {
    if (!this.subscribers.has(key)) {
      this.subscribers.set(key, [])
    }
    this.subscribers.get(key).push(callback)
  }

  set(key, value) {
    this.cache.set(key, value)

    // é€šçŸ¥è®¢é˜…è€…
    const callbacks = this.subscribers.get(key) || []
    callbacks.forEach(callback => callback(value))
  }

  get(key) {
    return this.cache.get(key)
  }
}
```

### å…¬å…±ä¾èµ–å¤„ç†

#### 1. ä¾èµ–å…±äº«ç­–ç•¥
```javascript
// webpack.config.js - ä¸»åº”ç”¨
const ModuleFederationPlugin = require('@module-federation/webpack')

module.exports = {
  plugins: [
    new ModuleFederationPlugin({
      name: 'shell',
      shared: {
        // æ ¸å¿ƒåº“ - å¼ºåˆ¶å•ä¾‹
        react: {
          singleton: true,
          eager: true,
          requiredVersion: '^18.0.0'
        },
        'react-dom': {
          singleton: true,
          eager: true,
          requiredVersion: '^18.0.0'
        },

        // UI åº“ - ç‰ˆæœ¬å…¼å®¹
        'antd': {
          singleton: true,
          requiredVersion: '^5.0.0',
          // å…è®¸ç‰ˆæœ¬å·®å¼‚
          strictVersion: false
        },

        // å·¥å…·åº“ - å…è®¸å¤šç‰ˆæœ¬
        'lodash': {
          singleton: false,
          requiredVersion: false
        },

        // å…¬å¸å†…éƒ¨åº“ - ä¸¥æ ¼ç‰ˆæœ¬æ§åˆ¶
        '@company/design-system': {
          singleton: true,
          strictVersion: true,
          requiredVersion: '~2.1.0'
        }
      }
    })
  ]
}
```

#### 2. å…¬å…±ç»„ä»¶åº“è®¾è®¡
```javascript
// å…¬å…±ç»„ä»¶åº“ç»“æ„
// @company/micro-components
export const MicroComponents = {
  // åŸºç¡€ç»„ä»¶
  Layout: {
    Header: lazy(() => import('./Layout/Header')),
    Sidebar: lazy(() => import('./Layout/Sidebar')),
    Footer: lazy(() => import('./Layout/Footer'))
  },

  // ä¸šåŠ¡ç»„ä»¶
  UserAvatar: lazy(() => import('./User/Avatar')),
  NotificationCenter: lazy(() => import('./Notification/Center')),

  // å·¥å…·ç»„ä»¶
  ErrorBoundary: lazy(() => import('./Utils/ErrorBoundary')),
  Loading: lazy(() => import('./Utils/Loading'))
}

// ä¸»é¢˜æä¾›è€…
export const ThemeProvider = ({ children, theme }) => {
  useEffect(() => {
    // æ³¨å…¥ CSS å˜é‡
    Object.entries(theme).forEach(([key, value]) => {
      document.documentElement.style.setProperty(`--${key}`, value)
    })
  }, [theme])

  return children
}

// ä½¿ç”¨ç¤ºä¾‹
// å¾®åº”ç”¨ä¸­ä½¿ç”¨å…¬å…±ç»„ä»¶
import { MicroComponents, ThemeProvider } from '@company/micro-components'

function UserApp() {
  return (
    <ThemeProvider theme={currentTheme}>
      <MicroComponents.Layout.Header />
      <div className="user-content">
        {/* åº”ç”¨å†…å®¹ */}
      </div>
    </ThemeProvider>
  )
}
```

---

## âš ï¸ å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ

### æ ·å¼å†²çªå¤„ç†

#### é—®é¢˜åœºæ™¯
```css
/* ä¸»åº”ç”¨æ ·å¼ */
.header {
  background: #1890ff;
  height: 60px;
}

.button {
  border-radius: 4px;
  padding: 8px 16px;
}

/* å¾®åº”ç”¨Aæ ·å¼ */
.header {
  background: #52c41a; /* å†²çªï¼è¦†ç›–ä¸»åº”ç”¨æ ·å¼ */
  height: 80px;
}

.button {
  border-radius: 8px; /* å†²çªï¼å½±å“å…¨å±€æŒ‰é’®æ ·å¼ */
}
```

#### è§£å†³æ–¹æ¡ˆ

**æ–¹æ¡ˆ1: CSS-in-JS**
```javascript
// ä½¿ç”¨ styled-components
import styled from 'styled-components'

const Header = styled.header`
  background: #52c41a;
  height: 80px;
  /* æ ·å¼å®Œå…¨éš”ç¦» */
`

const Button = styled.button`
  border-radius: 8px;
  padding: 8px 16px;
  background: ${props => props.primary ? '#1890ff' : '#fff'};
`

function UserApp() {
  return (
    <div>
      <Header>ç”¨æˆ·ç®¡ç†</Header>
      <Button primary>ä¿å­˜</Button>
    </div>
  )
}
```

**æ–¹æ¡ˆ2: CSS Modules + PostCSS**
```javascript
// webpack.config.js
module.exports = {
  module: {
    rules: [
      {
        test: /\.module\.css$/,
        use: [
          'style-loader',
          {
            loader: 'css-loader',
            options: {
              modules: {
                localIdentName: '[name]__[local]--[hash:base64:5]'
              }
            }
          },
          'postcss-loader'
        ]
      }
    ]
  }
}

// postcss.config.js
module.exports = {
  plugins: [
    require('postcss-prefixwrap')('.micro-app-user') // è‡ªåŠ¨æ·»åŠ å‰ç¼€
  ]
}

// UserApp.module.css
.header {
  background: #52c41a;
  height: 80px;
}

// ç¼–è¯‘å
.micro-app-user .UserApp__header--2x3k9 {
  background: #52c41a;
  height: 80px;
}
```

**æ–¹æ¡ˆ3: è¿è¡Œæ—¶æ ·å¼éš”ç¦»**
```javascript
// qiankun æ ·å¼éš”ç¦»é…ç½®
import { start } from 'qiankun'

start({
  sandbox: {
    strictStyleIsolation: true, // ä¸¥æ ¼æ ·å¼éš”ç¦»
    // æˆ–ä½¿ç”¨å®éªŒæ€§æ ·å¼éš”ç¦»
    experimentalStyleIsolation: true
  }
})

// è‡ªå®šä¹‰æ ·å¼éš”ç¦»
class StyleIsolation {
  constructor(prefix) {
    this.prefix = prefix
    this.originalStyles = []
  }

  activate() {
    // è®°å½•å½“å‰æ ·å¼
    this.originalStyles = Array.from(document.styleSheets)
  }

  addPrefix(cssText) {
    return cssText.replace(/([^{}]+){/g, (match, selector) => {
      if (selector.includes(this.prefix)) {
        return match
      }
      return `${this.prefix} ${selector} {`
    })
  }

  deactivate() {
    // æ¢å¤åŸå§‹æ ·å¼
    document.styleSheets.forEach((sheet, index) => {
      if (index >= this.originalStyles.length) {
        sheet.disabled = true
      }
    })
  }
}
```

### å…¨å±€çŠ¶æ€ç®¡ç†

#### é—®é¢˜åœºæ™¯
```javascript
// å¤šä¸ªå¾®åº”ç”¨éœ€è¦å…±äº«ç”¨æˆ·ä¿¡æ¯
// åº”ç”¨A
const userA = getCurrentUser() // å¯èƒ½è¿‡æœŸæˆ–ä¸ä¸€è‡´

// åº”ç”¨B
const userB = getCurrentUser() // å¯èƒ½ä¸åº”ç”¨Aä¸åŒæ­¥

// åº”ç”¨C
updateUser(newUserInfo) // å…¶ä»–åº”ç”¨ä¸çŸ¥é“æ›´æ–°
```

#### è§£å†³æ–¹æ¡ˆ

**æ–¹æ¡ˆ1: äº‹ä»¶é©±åŠ¨çŠ¶æ€åŒæ­¥**
```javascript
// å…¨å±€çŠ¶æ€ç®¡ç†å™¨
class GlobalStateManager {
  constructor() {
    this.state = {
      user: null,
      theme: 'light',
      permissions: []
    }
    this.listeners = new Map()
  }

  // è·å–çŠ¶æ€
  getState(key) {
    return key ? this.state[key] : this.state
  }

  // è®¾ç½®çŠ¶æ€
  setState(key, value) {
    const oldValue = this.state[key]
    this.state[key] = value

    // é€šçŸ¥æ‰€æœ‰ç›‘å¬è€…
    this.notifyListeners(key, value, oldValue)

    // æŒä¹…åŒ–åˆ° localStorage
    this.persist(key, value)
  }

  // è®¢é˜…çŠ¶æ€å˜åŒ–
  subscribe(key, callback) {
    if (!this.listeners.has(key)) {
      this.listeners.set(key, [])
    }
    this.listeners.get(key).push(callback)

    // è¿”å›å–æ¶ˆè®¢é˜…å‡½æ•°
    return () => {
      const callbacks = this.listeners.get(key)
      const index = callbacks.indexOf(callback)
      if (index > -1) {
        callbacks.splice(index, 1)
      }
    }
  }

  notifyListeners(key, newValue, oldValue) {
    const callbacks = this.listeners.get(key) || []
    callbacks.forEach(callback => {
      try {
        callback(newValue, oldValue)
      } catch (error) {
        console.error('çŠ¶æ€ç›‘å¬å›è°ƒé”™è¯¯:', error)
      }
    })
  }

  persist(key, value) {
    try {
      const stateToSave = { ...this.state }
      localStorage.setItem('global-state', JSON.stringify(stateToSave))
    } catch (error) {
      console.warn('çŠ¶æ€æŒä¹…åŒ–å¤±è´¥:', error)
    }
  }

  // ä» localStorage æ¢å¤çŠ¶æ€
  restore() {
    try {
      const saved = localStorage.getItem('global-state')
      if (saved) {
        this.state = { ...this.state, ...JSON.parse(saved) }
      }
    } catch (error) {
      console.warn('çŠ¶æ€æ¢å¤å¤±è´¥:', error)
    }
  }
}

// å…¨å±€å®ä¾‹
window.globalState = new GlobalStateManager()
window.globalState.restore()

// å¾®åº”ç”¨ä½¿ç”¨
// åº”ç”¨A - ç›‘å¬ç”¨æˆ·çŠ¶æ€
const unsubscribe = window.globalState.subscribe('user', (newUser, oldUser) => {
  console.log('ç”¨æˆ·ä¿¡æ¯æ›´æ–°:', newUser)
  updateLocalUserDisplay(newUser)
})

// åº”ç”¨B - æ›´æ–°ç”¨æˆ·çŠ¶æ€
function updateUserInfo(userInfo) {
  window.globalState.setState('user', userInfo)
  // æ‰€æœ‰è®¢é˜…çš„åº”ç”¨ä¼šè‡ªåŠ¨æ”¶åˆ°é€šçŸ¥
}
```

**æ–¹æ¡ˆ2: Redux é£æ ¼çŠ¶æ€ç®¡ç†**
```javascript
// å¾®å‰ç«¯ Redux Store
class MicroFrontendStore {
  constructor() {
    this.state = {
      user: null,
      theme: 'light',
      notifications: []
    }
    this.reducers = new Map()
    this.middlewares = []
    this.subscribers = []
  }

  // æ³¨å†Œ reducer
  registerReducer(domain, reducer) {
    this.reducers.set(domain, reducer)
  }

  // å‘é€ action
  dispatch(action) {
    const newState = { ...this.state }

    // åº”ç”¨æ‰€æœ‰ reducer
    this.reducers.forEach((reducer, domain) => {
      const domainState = newState[domain]
      const newDomainState = reducer(domainState, action)
      if (newDomainState !== domainState) {
        newState[domain] = newDomainState
      }
    })

    // åº”ç”¨ä¸­é—´ä»¶
    this.middlewares.forEach(middleware => {
      middleware(action, this.state, newState)
    })

    // æ›´æ–°çŠ¶æ€
    this.state = newState

    // é€šçŸ¥è®¢é˜…è€…
    this.subscribers.forEach(callback => callback(this.state, action))
  }

  // è®¢é˜…çŠ¶æ€å˜åŒ–
  subscribe(callback) {
    this.subscribers.push(callback)
    return () => {
      const index = this.subscribers.indexOf(callback)
      this.subscribers.splice(index, 1)
    }
  }

  // è·å–çŠ¶æ€
  getState() {
    return this.state
  }
}

// ä½¿ç”¨ç¤ºä¾‹
const store = new MicroFrontendStore()

// ç”¨æˆ·åº”ç”¨æ³¨å†Œ reducer
store.registerReducer('user', (state = null, action) => {
  switch (action.type) {
    case 'USER_LOGIN':
      return action.payload
    case 'USER_LOGOUT':
      return null
    case 'USER_UPDATE':
      return { ...state, ...action.payload }
    default:
      return state
  }
})

// é€šçŸ¥åº”ç”¨æ³¨å†Œ reducer
store.registerReducer('notifications', (state = [], action) => {
  switch (action.type) {
    case 'ADD_NOTIFICATION':
      return [...state, action.payload]
    case 'REMOVE_NOTIFICATION':
      return state.filter(n => n.id !== action.payload.id)
    default:
      return state
  }
})

// å¾®åº”ç”¨ä½¿ç”¨
store.dispatch({
  type: 'USER_LOGIN',
  payload: { id: 1, name: 'å¼ ä¸‰', email: 'zhangsan@example.com' }
})
```

### æ€§èƒ½é—®é¢˜

#### é—®é¢˜1: é‡å¤åŠ è½½ä¾èµ–
```javascript
// é—®é¢˜ï¼šå¤šä¸ªåº”ç”¨éƒ½åŠ è½½äº†ç›¸åŒçš„åº“
// åº”ç”¨A: React (2MB)
// åº”ç”¨B: React (2MB) + Vue (1MB)
// åº”ç”¨C: React (2MB) + Lodash (500KB)
// æ€»è®¡: 7.5MB çš„é‡å¤èµ„æº

// è§£å†³æ–¹æ¡ˆï¼šä¾èµ–å»é‡
const ModuleFederationPlugin = require('@module-federation/webpack')

// ä¸»åº”ç”¨æä¾›å…±äº«ä¾èµ–
module.exports = {
  plugins: [
    new ModuleFederationPlugin({
      name: 'shell',
      exposes: {
        './shared-react': 'react',
        './shared-react-dom': 'react-dom',
        './shared-lodash': 'lodash'
      },
      shared: {
        react: { singleton: true, eager: true },
        'react-dom': { singleton: true, eager: true },
        lodash: { singleton: true, eager: true }
      }
    })
  ]
}

// å¾®åº”ç”¨æ¶ˆè´¹å…±äº«ä¾èµ–
module.exports = {
  plugins: [
    new ModuleFederationPlugin({
      name: 'microApp',
      remotes: {
        shell: 'shell@http://localhost:3000/remoteEntry.js'
      },
      shared: {
        react: { singleton: true },
        'react-dom': { singleton: true },
        lodash: { singleton: true }
      }
    })
  ]
}
```

#### é—®é¢˜2: å†…å­˜æ³„æ¼
```javascript
// å¸¸è§å†…å­˜æ³„æ¼åœºæ™¯
class MemoryLeakDetector {
  constructor() {
    this.eventListeners = new Map()
    this.timers = new Set()
    this.observers = new Set()
  }

  // è·Ÿè¸ªäº‹ä»¶ç›‘å¬å™¨
  addEventListener(element, event, handler) {
    const key = `${element}:${event}`
    if (!this.eventListeners.has(key)) {
      this.eventListeners.set(key, [])
    }
    this.eventListeners.get(key).push(handler)

    element.addEventListener(event, handler)
  }

  // è·Ÿè¸ªå®šæ—¶å™¨
  setTimeout(callback, delay) {
    const id = setTimeout(callback, delay)
    this.timers.add(id)
    return id
  }

  setInterval(callback, delay) {
    const id = setInterval(callback, delay)
    this.timers.add(id)
    return id
  }

  // è·Ÿè¸ªè§‚å¯Ÿè€…
  observe(observer, target, options) {
    observer.observe(target, options)
    this.observers.add(observer)
  }

  // æ¸…ç†æ‰€æœ‰èµ„æº
  cleanup() {
    // ç§»é™¤äº‹ä»¶ç›‘å¬å™¨
    this.eventListeners.forEach((handlers, key) => {
      const [element, event] = key.split(':')
      handlers.forEach(handler => {
        element.removeEventListener(event, handler)
      })
    })
    this.eventListeners.clear()

    // æ¸…ç†å®šæ—¶å™¨
    this.timers.forEach(id => {
      clearTimeout(id)
      clearInterval(id)
    })
    this.timers.clear()

    // æ–­å¼€è§‚å¯Ÿè€…
    this.observers.forEach(observer => {
      observer.disconnect()
    })
    this.observers.clear()
  }
}

// å¾®åº”ç”¨ç”Ÿå‘½å‘¨æœŸä¸­ä½¿ç”¨
let memoryDetector = null

export async function mount(props) {
  memoryDetector = new MemoryLeakDetector()

  // ä½¿ç”¨æ£€æµ‹å™¨ç®¡ç†èµ„æº
  memoryDetector.addEventListener(window, 'resize', handleResize)
  memoryDetector.setTimeout(checkStatus, 5000)

  render(props)
}

export async function unmount(props) {
  // æ¸…ç†æ‰€æœ‰èµ„æºï¼Œé˜²æ­¢å†…å­˜æ³„æ¼
  memoryDetector?.cleanup()
  memoryDetector = null

  ReactDOM.unmountComponentAtNode(props.container)
}
```

### ç‰ˆæœ¬ç®¡ç†

#### é—®é¢˜åœºæ™¯
```javascript
// ä¸»åº”ç”¨è¦æ±‚ React 18
// å¾®åº”ç”¨A ä½¿ç”¨ React 17
// å¾®åº”ç”¨B ä½¿ç”¨ React 18.1
// å¾®åº”ç”¨C ä½¿ç”¨ React 16.8

// ç‰ˆæœ¬å†²çªå¯¼è‡´çš„é—®é¢˜ï¼š
// 1. Hook ç‰ˆæœ¬ä¸å…¼å®¹
// 2. API å·®å¼‚å¯¼è‡´é”™è¯¯
// 3. æ‰“åŒ…ä½“ç§¯å¢å¤§
```

#### è§£å†³æ–¹æ¡ˆ

**æ–¹æ¡ˆ1: ç‰ˆæœ¬å…¼å®¹æ€§æ£€æŸ¥**
```javascript
// ç‰ˆæœ¬å…¼å®¹æ€§æ£€æŸ¥å™¨
class VersionChecker {
  constructor() {
    this.requirements = new Map()
    this.installedVersions = new Map()
  }

  // æ³¨å†Œç‰ˆæœ¬è¦æ±‚
  registerRequirement(package, version, appName) {
    const key = package
    if (!this.requirements.has(key)) {
      this.requirements.set(key, [])
    }
    this.requirements.get(key).push({ version, appName })
  }

  // æ£€æŸ¥ç‰ˆæœ¬å…¼å®¹æ€§
  checkCompatibility() {
    const conflicts = []

    this.requirements.forEach((reqs, package) => {
      const versions = reqs.map(r => r.version)
      const uniqueVersions = [...new Set(versions)]

      if (uniqueVersions.length > 1) {
        // æ£€æŸ¥æ˜¯å¦å…¼å®¹
        const compatible = this.isCompatible(uniqueVersions)
        if (!compatible) {
          conflicts.push({
            package,
            conflicts: reqs
          })
        }
      }
    })

    return conflicts
  }

  isCompatible(versions) {
    // ç®€å•çš„å…¼å®¹æ€§æ£€æŸ¥é€»è¾‘
    const majorVersions = versions.map(v => parseInt(v.split('.')[0]))
    const uniqueMajors = [...new Set(majorVersions)]

    // ä¸»ç‰ˆæœ¬å·ç›¸åŒæ‰å…¼å®¹
    return uniqueMajors.length === 1
  }

  // ç”Ÿæˆå…¼å®¹æ€§æŠ¥å‘Š
  generateReport() {
    const conflicts = this.checkCompatibility()

    if (conflicts.length === 0) {
      console.log('âœ… æ‰€æœ‰ä¾èµ–ç‰ˆæœ¬å…¼å®¹')
      return
    }

    console.warn('âš ï¸ å‘ç°ç‰ˆæœ¬å†²çª:')
    conflicts.forEach(conflict => {
      console.warn(`ğŸ“¦ ${conflict.package}:`)
      conflict.conflicts.forEach(c => {
        console.warn(`  - ${c.appName}: ${c.version}`)
      })
    })
  }
}

// ä½¿ç”¨ç¤ºä¾‹
const versionChecker = new VersionChecker()

// æ³¨å†Œå„åº”ç”¨çš„ä¾èµ–è¦æ±‚
versionChecker.registerRequirement('react', '^18.0.0', 'shell')
versionChecker.registerRequirement('react', '^17.0.0', 'userApp')
versionChecker.registerRequirement('react', '^18.1.0', 'orderApp')

// æ£€æŸ¥å…¼å®¹æ€§
versionChecker.generateReport()
```

**æ–¹æ¡ˆ2: æ¸è¿›å¼å‡çº§ç­–ç•¥**
```javascript
// æ¸è¿›å¼å‡çº§è®¡åˆ’
const upgradePlan = {
  phase1: {
    title: 'å‡†å¤‡é˜¶æ®µ',
    duration: '2å‘¨',
    tasks: [
      'å»ºç«‹ç‰ˆæœ¬å…¼å®¹æ€§åŸºçº¿',
      'åˆ›å»ºæµ‹è¯•ç¯å¢ƒ',
      'åˆ¶å®šå›æ»šç­–ç•¥'
    ]
  },

  phase2: {
    title: 'è¯•ç‚¹å‡çº§',
    duration: '3å‘¨',
    tasks: [
      'é€‰æ‹©é£é™©æœ€ä½çš„å¾®åº”ç”¨è¯•ç‚¹',
      'å‡çº§å¼€å‘ç¯å¢ƒ',
      'è¿›è¡Œå……åˆ†æµ‹è¯•'
    ]
  },

  phase3: {
    title: 'é€æ­¥æ¨å¹¿',
    duration: '6å‘¨',
    tasks: [
      'æ¯å‘¨å‡çº§ä¸€ä¸ªå¾®åº”ç”¨',
      'ç›‘æ§æ€§èƒ½å’Œé”™è¯¯ç‡',
      'æ”¶é›†ç”¨æˆ·åé¦ˆ'
    ]
  },

  phase4: {
    title: 'å…¨é¢å‡çº§',
    duration: '2å‘¨',
    tasks: [
      'å‡çº§å‰©ä½™å¾®åº”ç”¨',
      'æ¸…ç†æ—§ç‰ˆæœ¬ä¾èµ–',
      'ä¼˜åŒ–å…±äº«ä¾èµ–é…ç½®'
    ]
  }
}

// å‡çº§æ£€æŸ¥å™¨
class UpgradeChecker {
  constructor() {
    this.compatibilityMatrix = {
      'react': {
        '16.8': ['16.8', '17.0'],
        '17.0': ['16.8', '17.0', '18.0'],
        '18.0': ['17.0', '18.0']
      }
    }
  }

  canUpgrade(package, fromVersion, toVersion) {
    const matrix = this.compatibilityMatrix[package]
    if (!matrix) return false

    const compatibleVersions = matrix[fromVersion] || []
    return compatibleVersions.includes(toVersion)
  }

  generateUpgradeOrder(apps) {
    // æ ¹æ®ä¾èµ–å…³ç³»ç”Ÿæˆå‡çº§é¡ºåº
    const dependencyGraph = this.buildDependencyGraph(apps)
    return this.topologicalSort(dependencyGraph)
  }

  buildDependencyGraph(apps) {
    // æ„å»ºåº”ç”¨ä¾èµ–å›¾
    const graph = new Map()

    apps.forEach(app => {
      graph.set(app.name, app.dependencies || [])
    })

    return graph
  }

  topologicalSort(graph) {
    // æ‹“æ‰‘æ’åºï¼Œç¡®å®šå‡çº§é¡ºåº
    const visited = new Set()
    const result = []

    function visit(node) {
      if (visited.has(node)) return
      visited.add(node)

      const dependencies = graph.get(node) || []
      dependencies.forEach(dep => visit(dep))

      result.push(node)
    }

    graph.forEach((_, node) => visit(node))
    return result
  }
}
```

---

## ğŸ”® æœªæ¥è¶‹åŠ¿

### å¾®æ¨¡å—åŒ– (Micro Modules)

ä»åº”ç”¨çº§æ‹†åˆ†å‘æ¨¡å—çº§æ‹†åˆ†æ¼”è¿›ï¼Œå®ç°æ›´ç»†ç²’åº¦çš„ä»£ç ç»„ç»‡å’Œå¤ç”¨ã€‚

```javascript
// ä¼ ç»Ÿå¾®å‰ç«¯ï¼šåº”ç”¨çº§æ‹†åˆ†
const microApps = {
  userApp: 'http://localhost:3001',      // æ•´ä¸ªç”¨æˆ·ç®¡ç†åº”ç”¨
  orderApp: 'http://localhost:3002'     // æ•´ä¸ªè®¢å•ç®¡ç†åº”ç”¨
}

// å¾®æ¨¡å—åŒ–ï¼šæ¨¡å—çº§æ‹†åˆ†
const microModules = {
  'user/login': 'http://cdn.company.com/modules/user-login@1.2.0',
  'user/profile': 'http://cdn.company.com/modules/user-profile@2.1.0',
  'order/create': 'http://cdn.company.com/modules/order-create@1.5.0',
  'ui/components': 'http://cdn.company.com/modules/ui-components@3.0.0'
}

// åŠ¨æ€ç»„åˆåº”ç”¨
class MicroModuleLoader {
  async createApp(modules) {
    const loadedModules = await Promise.all(
      modules.map(name => this.loadModule(name))
    )

    return this.composeApp(loadedModules)
  }

  async loadModule(name) {
    // æ”¯æŒç‰ˆæœ¬æ§åˆ¶å’Œç¼“å­˜
    const cached = this.getFromCache(name)
    if (cached) return cached

    const module = await import(microModules[name])
    this.setCache(name, module)
    return module
  }

  composeApp(modules) {
    // æ™ºèƒ½ç»„åˆæ¨¡å—
    return modules.reduce((app, module) => {
      return { ...app, ...module.exports }
    }, {})
  }
}

// ä½¿ç”¨ç¤ºä¾‹
const loader = new MicroModuleLoader()

// åŠ¨æ€æ„å»ºç”¨æˆ·ç®¡ç†é¡µé¢
const userPage = await loader.createApp([
  'user/login',
  'user/profile',
  'ui/components'
])
```

### æ— ç•Œå¾®å‰ç«¯ (Boundaryless Micro Frontends)

æ¶ˆé™¤å¾®åº”ç”¨é—´çš„æŠ€æœ¯è¾¹ç•Œï¼Œå®ç°æ— ç¼é›†æˆå’Œåä½œã€‚

```javascript
// æ— ç•Œåº”ç”¨å®¹å™¨
class BoundarylessContainer {
  constructor() {
    this.sharedRuntime = new SharedRuntime()
    this.stateManager = new GlobalStateManager()
    this.eventBus = new EventBus()
  }

  async loadApp(config) {
    const app = await import(config.entry)

    // æ³¨å…¥å…±äº«è¿è¡Œæ—¶
    app.runtime = this.sharedRuntime
    app.state = this.stateManager
    app.events = this.eventBus

    // æ— ç¼é›†æˆ
    return this.integrateApp(app, config)
  }

  integrateApp(app, config) {
    // è‡ªåŠ¨æ³¨å†Œåº”ç”¨èƒ½åŠ›
    if (app.capabilities) {
      app.capabilities.forEach(capability => {
        this.sharedRuntime.register(capability.name, capability.handler)
      })
    }

    // è‡ªåŠ¨è®¢é˜…ç›¸å…³äº‹ä»¶
    if (app.interests) {
      app.interests.forEach(interest => {
        this.eventBus.subscribe(interest, app.handleEvent)
      })
    }

    return app
  }
}

// è·¨åº”ç”¨èƒ½åŠ›è°ƒç”¨
// åº”ç”¨Aæš´éœ²èƒ½åŠ›
export const capabilities = [
  {
    name: 'user.authenticate',
    handler: (credentials) => authenticate(credentials)
  },
  {
    name: 'user.getProfile',
    handler: (userId) => getUserProfile(userId)
  }
]

// åº”ç”¨Bç›´æ¥è°ƒç”¨
function handleOrderCreate() {
  // æ— éœ€çŸ¥é“ç”¨æˆ·æ¨¡å—çš„å…·ä½“å®ç°
  const user = await runtime.call('user.getProfile', currentUserId)
  createOrder({ user, ...orderData })
}
```

### Module Federation 2.0

ä¸‹ä¸€ä»£æ¨¡å—è”é‚¦ï¼Œæ”¯æŒæ›´çµæ´»çš„æ¨¡å—å…±äº«å’Œè¿è¡Œæ—¶ä¼˜åŒ–ã€‚

```javascript
// Module Federation 2.0 ç‰¹æ€§
const ModuleFederationPlugin = require('@module-federation/enhanced')

module.exports = {
  plugins: [
    new ModuleFederationPlugin({
      name: 'shell',

      // è¿è¡Œæ—¶æ¨¡å—æ˜ å°„
      runtimeModules: {
        mapping: 'dynamic',
        resolver: 'http://registry.company.com/resolve'
      },

      // æ™ºèƒ½ä¾èµ–åˆ†æ
      smartSharing: {
        strategy: 'auto',
        analytics: true,
        optimization: 'aggressive'
      },

      // ç‰ˆæœ¬å…¼å®¹æ€§
      compatibility: {
        autoUpgrade: true,
        fallback: 'graceful',
        versionTolerance: 'minor'
      },

      // æ€§èƒ½ä¼˜åŒ–
      performance: {
        preload: 'intelligent',
        caching: 'distributed',
        compression: 'brotli'
      },

      // é”™è¯¯æ¢å¤
      resilience: {
        circuitBreaker: true,
        retry: { attempts: 3, backoff: 'exponential' },
        fallback: './local-fallback'
      }
    })
  ]
}

// è¿è¡Œæ—¶åŠ¨æ€é…ç½®
class DynamicModuleFederation {
  constructor() {
    this.registry = new ModuleRegistry()
    this.optimizer = new PerformanceOptimizer()
  }

  async resolveModule(name) {
    // æ™ºèƒ½è·¯ç”±é€‰æ‹©
    const candidates = await this.registry.findCandidates(name)
    const optimal = this.optimizer.selectOptimal(candidates)

    // è¿è¡Œæ—¶é€‚é…
    return this.loadWithAdaptation(optimal)
  }

  async loadWithAdaptation(moduleConfig) {
    // è‡ªåŠ¨é€‚é…ä¸åŒç‰ˆæœ¬
    const adapter = this.createAdapter(moduleConfig)
    const module = await import(moduleConfig.url)

    return adapter.adapt(module)
  }
}
```

### Web Components æ ‡å‡†åŒ–

åŸºäºæ ‡å‡†çš„ Web Components æˆä¸ºå¾®å‰ç«¯çš„ä¸»æµå®ç°æ–¹å¼ã€‚

```javascript
// æ ‡å‡†åŒ–å¾®å‰ç«¯ç»„ä»¶
class MicroFrontendElement extends HTMLElement {
  static get observedAttributes() {
    return ['src', 'props', 'lazy']
  }

  constructor() {
    super()
    this.shadow = this.attachShadow({ mode: 'open' })
    this.appInstance = null
  }

  async connectedCallback() {
    if (this.hasAttribute('lazy')) {
      this.setupLazyLoading()
    } else {
      await this.loadApp()
    }
  }

  async loadApp() {
    const src = this.getAttribute('src')
    const props = JSON.parse(this.getAttribute('props') || '{}')

    try {
      // æ ‡å‡†åŒ–åŠ è½½æµç¨‹
      const app = await import(src)
      this.appInstance = await app.mount({
        container: this.shadow,
        props: { ...props, ...this.getSlotContent() }
      })

      // æ ‡å‡†åŒ–é€šä¿¡
      this.setupCommunication()
    } catch (error) {
      this.handleError(error)
    }
  }

  setupCommunication() {
    // æ ‡å‡†åŒ–äº‹ä»¶é€šä¿¡
    this.appInstance?.on?.('*', (event, data) => {
      this.dispatchEvent(new CustomEvent(`app:${event}`, {
        detail: data,
        bubbles: true
      }))
    })

    // ç›‘å¬å¤–éƒ¨äº‹ä»¶
    this.addEventListener('app:message', (event) => {
      this.appInstance?.emit?.(event.detail.type, event.detail.data)
    })
  }

  getSlotContent() {
    // æ”¯æŒ slot å†…å®¹ä¼ é€’
    const slots = {}
    this.querySelectorAll('[slot]').forEach(el => {
      const slotName = el.getAttribute('slot')
      slots[slotName] = el.innerHTML
    })
    return { slots }
  }

  async disconnectedCallback() {
    // æ ‡å‡†åŒ–æ¸…ç†
    if (this.appInstance?.unmount) {
      await this.appInstance.unmount()
    }
  }
}

// æ³¨å†Œç»„ä»¶
customElements.define('micro-app', MicroFrontendElement)

// ä½¿ç”¨æ ‡å‡†åŒ–ç»„ä»¶
```html
<micro-app
  src="./user-management.js"
  props='{"theme": "dark", "userId": "123"}'
  lazy="true">

  <!-- æ”¯æŒ slot å†…å®¹ -->
  <div slot="header">
    <h2>ç”¨æˆ·ç®¡ç†</h2>
  </div>

  <div slot="footer">
    <button>ä¿å­˜</button>
  </div>
</micro-app>
```

### AI è¾…åŠ©å¾®å‰ç«¯å¼€å‘

AI æŠ€æœ¯åœ¨å¾®å‰ç«¯å¼€å‘å’Œè¿ç»´ä¸­çš„åº”ç”¨ã€‚

```javascript
// AI è¾…åŠ©åº”ç”¨æ‹†åˆ†
class AIArchitectAssistant {
  constructor() {
    this.analyzer = new CodeAnalyzer()
    this.recommender = new ArchitectureRecommender()
  }

  async analyzeCodebase(projectPath) {
    // ä»£ç ç»“æ„åˆ†æ
    const structure = await this.analyzer.analyze(projectPath)

    // AI æ¨èæ‹†åˆ†æ–¹æ¡ˆ
    const recommendations = await this.recommender.suggest({
      structure,
      metrics: {
        coupling: this.analyzer.calculateCoupling(structure),
        cohesion: this.analyzer.calculateCohesion(structure),
        complexity: this.analyzer.calculateComplexity(structure)
      }
    })

    return this.generateSplitPlan(recommendations)
  }

  generateSplitPlan(recommendations) {
    return {
      applications: recommendations.suggestedApps.map(app => ({
        name: app.name,
        files: app.files,
        dependencies: app.dependencies,
        rationale: app.reasoning,
        priority: app.migrationPriority
      })),
      sharedModules: recommendations.sharedCode,
      migrationSteps: recommendations.implementationPlan
    }
  }
}

// AI æ€§èƒ½ä¼˜åŒ–
class AIPerformanceOptimizer {
  constructor() {
    this.monitor = new PerformanceMonitor()
    this.optimizer = new SmartOptimizer()
  }

  async optimizeRuntime() {
    // å®æ—¶æ€§èƒ½ç›‘æ§
    const metrics = await this.monitor.collect()

    // AI åˆ†ææ€§èƒ½ç“¶é¢ˆ
    const bottlenecks = await this.analyzer.identifyBottlenecks(metrics)

    // è‡ªåŠ¨ä¼˜åŒ–é…ç½®
    const optimizations = await this.optimizer.generate(bottlenecks)

    // åº”ç”¨ä¼˜åŒ–ç­–ç•¥
    return this.applyOptimizations(optimizations)
  }

  async predictOptimalLoading() {
    // åŸºäºç”¨æˆ·è¡Œä¸ºé¢„æµ‹
    const userPattern = await this.analyzer.analyzeUserBehavior()

    // AI æ¨èé¢„åŠ è½½ç­–ç•¥
    return this.optimizer.recommendPreloading(userPattern)
  }
}

// AI æ™ºèƒ½è·¯ç”±
class AIRoutingManager {
  constructor() {
    this.predictor = new UserBehaviorPredictor()
    this.loadBalancer = new IntelligentLoadBalancer()
  }

  async route(request) {
    // é¢„æµ‹ç”¨æˆ·ä¸‹ä¸€æ­¥æ“ä½œ
    const prediction = await this.predictor.predict(request.user, request.context)

    // æ™ºèƒ½é¢„åŠ è½½
    this.preloadPredictedApps(prediction.likelyApps)

    // é€‰æ‹©æœ€ä¼˜æœåŠ¡å™¨
    const server = await this.loadBalancer.selectOptimal({
      location: request.location,
      load: request.load,
      userProfile: request.user
    })

    return this.routeToServer(server, request)
  }
}
```

### è¾¹ç¼˜è®¡ç®—å¾®å‰ç«¯

å¾®å‰ç«¯ä¸è¾¹ç¼˜è®¡ç®—ç»“åˆï¼Œå®ç°æ›´å¿«çš„åŠ è½½é€Ÿåº¦å’Œæ›´å¥½çš„ç”¨æˆ·ä½“éªŒã€‚

```javascript
// è¾¹ç¼˜å¾®å‰ç«¯é…ç½®
class EdgeMicroFrontend {
  constructor() {
    this.edgeNodes = new EdgeNodeManager()
    this.distributionStrategy = new IntelligentDistribution()
  }

  async deployToEdge(appConfig) {
    // åˆ†æåº”ç”¨ç‰¹å¾
    const analysis = await this.analyzeApp(appConfig)

    // é€‰æ‹©æœ€ä¼˜è¾¹ç¼˜èŠ‚ç‚¹
    const targetNodes = await this.selectEdgeNodes(analysis)

    // åˆ†å¸ƒå¼éƒ¨ç½²
    return this.distributeDeployment(appConfig, targetNodes)
  }

  async selectEdgeNodes(analysis) {
    // åŸºäºåœ°ç†ä½ç½®ã€ç”¨æˆ·åˆ†å¸ƒã€å»¶è¿Ÿç­‰å› ç´ é€‰æ‹©
    return this.edgeNodes.select({
      userDistribution: analysis.userGeo,
      contentSize: analysis.bundleSize,
      updateFrequency: analysis.deployFrequency,
      dependencies: analysis.sharedDeps
    })
  }

  async handleRequest(request) {
    // å°±è¿‘è·¯ç”±
    const nearestNode = this.edgeNodes.findNearest(request.location)

    // ç¼“å­˜ç­–ç•¥
    const cacheStrategy = this.distributionStrategy.getCacheStrategy(request.app)

    // è¾¹ç¼˜æ¸²æŸ“
    if (cacheStrategy.enableEdgeSSR) {
      return this.renderAtEdge(request, nearestNode)
    }

    return this.serveCachedApp(request, nearestNode)
  }
}

// è¾¹ç¼˜ç¼“å­˜ä¼˜åŒ–
class EdgeCacheOptimizer {
  constructor() {
    this.analytics = new UserAnalytics()
    this.predictor = new ContentPredictor()
  }

  async optimizeCache() {
    // åˆ†æç”¨æˆ·è®¿é—®æ¨¡å¼
    const patterns = await this.analytics.getAccessPatterns()

    // é¢„æµ‹çƒ­ç‚¹å†…å®¹
    const hotContent = await this.predictor.predictHotContent(patterns)

    // ä¼˜åŒ–ç¼“å­˜åˆ†å¸ƒ
    return this.redistributeCache(hotContent)
  }

  async redistributeCache(hotContent) {
    const operations = []

    for (const content of hotContent) {
      const optimalNodes = await this.selectOptimalNodes(content)
      operations.push({
        action: 'replicate',
        content: content.id,
        nodes: optimalNodes
      })
    }

    return this.executeOperations(operations)
  }
}
```

---

## ğŸ“ å­¦ä¹ æ€»ç»“

### æ ¸å¿ƒè¦ç‚¹å›é¡¾

#### 1. å¾®å‰ç«¯çš„æ ¸å¿ƒä»·å€¼
- **æŠ€æœ¯æ ˆæ— å…³æ€§**ï¼šä¸åŒå›¢é˜Ÿå¯ä»¥é€‰æ‹©æœ€é€‚åˆçš„æŠ€æœ¯æ ˆ
- **ç‹¬ç«‹å¼€å‘éƒ¨ç½²**ï¼šé™ä½å›¢é˜Ÿé—´çš„åè°ƒæˆæœ¬ï¼Œæé«˜å¼€å‘æ•ˆç‡
- **å¢é‡å‡çº§**ï¼šå¯ä»¥é€æ­¥modernizeé—ç•™ç³»ç»Ÿï¼Œé™ä½é‡å†™é£é™©
- **å›¢é˜Ÿè‡ªæ²»**ï¼šæ¯ä¸ªå›¢é˜Ÿå¯ä»¥ç‹¬ç«‹å†³ç­–ï¼Œå¿«é€Ÿå“åº”ä¸šåŠ¡éœ€æ±‚

#### 2. å…³é”®æŠ€æœ¯å†³ç­–
```javascript
// é€‰å‹å†³ç­–çŸ©é˜µ
const decisionMatrix = {
  éš”ç¦»è¦æ±‚: {
    å®Œç¾éš”ç¦»: 'iframe',
    è‰¯å¥½éš”ç¦»: 'qiankun',
    åŸºç¡€éš”ç¦»: 'Single-SPA',
    æ— éš”ç¦»: 'Module Federation'
  },

  æŠ€æœ¯æ ˆ: {
    ç»Ÿä¸€æŠ€æœ¯æ ˆ: 'Module Federation',
    æ··åˆæŠ€æœ¯æ ˆ: 'qiankun',
    é—ç•™ç³»ç»Ÿé›†æˆ: 'iframe',
    æ ‡å‡†åŒ–: 'Web Components'
  },

  å›¢é˜Ÿè§„æ¨¡: {
    å¤§å‹å›¢é˜Ÿ: 'qiankun + ä¼ä¸šçº§æ²»ç†',
    ä¸­å‹å›¢é˜Ÿ: 'Single-SPA',
    å°å‹å›¢é˜Ÿ: 'Module Federation',
    å•äºº: 'Web Components'
  },

  æ€§èƒ½è¦æ±‚: {
    æè‡´æ€§èƒ½: 'Module Federation',
    è‰¯å¥½æ€§èƒ½: 'qiankun',
    å¯æ¥å—æ€§èƒ½: 'Single-SPA',
    æ€§èƒ½ä¸æ•æ„Ÿ: 'iframe'
  }
}
```

#### 3. å®æ–½å…³é”®æˆåŠŸå› ç´ 
1. **æ¶æ„è®¾è®¡**ï¼šåˆç†çš„åº”ç”¨æ‹†åˆ†å’Œè¾¹ç•Œåˆ’åˆ†
2. **æŠ€æœ¯è§„èŒƒ**ï¼šç»Ÿä¸€çš„å¼€å‘æ ‡å‡†å’Œæœ€ä½³å®è·µ
3. **æ²»ç†æœºåˆ¶**ï¼šç‰ˆæœ¬ç®¡ç†ã€ä¾èµ–æ§åˆ¶ã€è´¨é‡ä¿è¯
4. **å›¢é˜Ÿåä½œ**ï¼šæ¸…æ™°çš„èŒè´£åˆ†å·¥å’Œæ²Ÿé€šæœºåˆ¶
5. **æ¸è¿›è¿ç§»**ï¼šç¨³å¦¥çš„è¿ç§»ç­–ç•¥å’Œé£é™©æ§åˆ¶

### é€‰å‹å†³ç­–æ ‘

```
å¼€å§‹é€‰å‹
â”‚
â”œâ”€ æ˜¯å¦éœ€è¦å®Œç¾éš”ç¦»ï¼Ÿ
â”‚  â”œâ”€ æ˜¯ â†’ è€ƒè™‘ iframe æˆ– Web Components
â”‚  â”‚  â”œâ”€ åœ¨æ„ SEOï¼Ÿâ†’ æ˜¯ â†’ Web Components
â”‚  â”‚  â””â”€ ä¸åœ¨æ„ SEOï¼Ÿâ†’ iframe
â”‚  â”‚
â”‚  â””â”€ å¦ â†’ ç»§ç»­è¯„ä¼°
â”‚     â”‚
â”‚     â”œâ”€ æŠ€æœ¯æ ˆæ˜¯å¦ç»Ÿä¸€ï¼Ÿ
â”‚     â”‚  â”œâ”€ æ˜¯ â†’ Module Federationï¼ˆæ¨èï¼‰
â”‚     â”‚  â””â”€ å¦ â†’ ç»§ç»­è¯„ä¼°
â”‚     â”‚
â”‚     â”œâ”€ å›¢é˜Ÿè§„æ¨¡å¦‚ä½•ï¼Ÿ
â”‚     â”‚  â”œâ”€ å¤§å‹ï¼ˆ>10äººï¼‰â†’ qiankunï¼ˆä¼ä¸šçº§ç‰¹æ€§ï¼‰
â”‚     â”‚  â”œâ”€ ä¸­å‹ï¼ˆ5-10äººï¼‰â†’ Single-SPA
â”‚     â”‚  â””â”€ å°å‹ï¼ˆ<5äººï¼‰â†’ Module Federation
â”‚     â”‚
â”‚     â”œâ”€ æ€§èƒ½è¦æ±‚å¦‚ä½•ï¼Ÿ
â”‚     â”‚  â”œâ”€ æé«˜ â†’ Module Federation
â”‚     â”‚  â”œâ”€ è¾ƒé«˜ â†’ qiankun
â”‚     â”‚  â””â”€ ä¸€èˆ¬ â†’ Single-SPA
â”‚     â”‚
â”‚     â””â”€ å­¦ä¹ æˆæœ¬è€ƒè™‘ï¼Ÿ
â”‚        â”œâ”€ å¸Œæœ›ç®€å• â†’ qiankun
â”‚        â”œâ”€ å¯æ¥å—å¤æ‚ â†’ Single-SPA
â”‚        â””â”€ è¿½æ±‚çµæ´» â†’ è‡ªç ”æ–¹æ¡ˆ
```

### å­¦ä¹ è·¯å¾„å»ºè®®

#### åˆå­¦è€…è·¯å¾„ï¼ˆ0-3ä¸ªæœˆï¼‰
```
ç¬¬1å‘¨ï¼šç†è®ºåŸºç¡€
â”œâ”€ å¾®å‰ç«¯æ¦‚å¿µå’Œä»·å€¼
â”œâ”€ å•ä½“åº”ç”¨ vs å¾®å‰ç«¯å¯¹æ¯”
â””â”€ ä¸»æµæ–¹æ¡ˆæ¦‚è§ˆ

ç¬¬2-3å‘¨ï¼šå…¥é—¨å®è·µ
â”œâ”€ iframe åŸºç¡€å®ç°
â”œâ”€ Web Components å…¥é—¨
â””â”€ ç®€å•çš„äº‹ä»¶é€šä¿¡

ç¬¬4-6å‘¨ï¼šæ¡†æ¶å­¦ä¹ 
â”œâ”€ qiankun å¿«é€Ÿä¸Šæ‰‹
â”œâ”€ åŸºç¡€é…ç½®å’Œç”Ÿå‘½å‘¨æœŸ
â””â”€ ç®€å•çš„å¤šåº”ç”¨é¡¹ç›®

ç¬¬7-12å‘¨ï¼šæ·±å…¥å®è·µ
â”œâ”€ Single-SPA è¿›é˜¶
â”œâ”€ Module Federation åŸºç¡€
â”œâ”€ æ ·å¼éš”ç¦»å’ŒçŠ¶æ€ç®¡ç†
â””â”€ å®é™…é¡¹ç›®é‡æ„ç»ƒä¹ 
```

#### è¿›é˜¶è·¯å¾„ï¼ˆ3-12ä¸ªæœˆï¼‰
```
ç¬¬1-3æœˆï¼šæŠ€æœ¯æ·±åŒ–
â”œâ”€ æºç é˜…è¯»å’ŒåŸç†ç†è§£
â”œâ”€ æ€§èƒ½ä¼˜åŒ–å’Œæœ€ä½³å®è·µ
â”œâ”€ è‡ªå®šä¹‰æ²™ç®±å’Œé€šä¿¡æœºåˆ¶
â””â”€ é”™è¯¯å¤„ç†å’Œç›‘æ§

ç¬¬4-6æœˆï¼šå·¥ç¨‹å®è·µ
â”œâ”€ CI/CD æµæ°´çº¿è®¾è®¡
â”œâ”€ ç‰ˆæœ¬ç®¡ç†å’Œä¾èµ–æ²»ç†
â”œâ”€ æµ‹è¯•ç­–ç•¥å’Œè´¨é‡ä¿è¯
â””â”€ ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²å’Œè¿ç»´

ç¬¬7-9æœˆï¼šæ¶æ„è®¾è®¡
â”œâ”€ å¤§å‹é¡¹ç›®æ¶æ„è®¾è®¡
â”œâ”€ è·¨å›¢é˜Ÿåä½œæµç¨‹
â”œâ”€ æŠ€æœ¯é€‰å‹å’Œè¿ç§»è§„åˆ’
â””â”€ ä¼ä¸šçº§æ²»ç†ä½“ç³»

ç¬¬10-12æœˆï¼šåˆ›æ–°æ¢ç´¢
â”œâ”€ æ–°æŠ€æœ¯è·Ÿè¿›å’Œè¯„ä¼°
â”œâ”€ è‡ªç ”æ¡†æ¶æˆ–å·¥å…·å¼€å‘
â”œâ”€ ç¤¾åŒºè´¡çŒ®å’ŒæŠ€æœ¯åˆ†äº«
â””â”€ è¡Œä¸šæœ€ä½³å®è·µæ€»ç»“
```

#### ä¸“å®¶è·¯å¾„ï¼ˆ1å¹´ä»¥ä¸Šï¼‰
```
æŠ€æœ¯æ·±åº¦ï¼š
â”œâ”€ å¾®å‰ç«¯æ¡†æ¶æºç è´¡çŒ®
â”œâ”€ æ–°çš„å¾®å‰ç«¯æ¨¡å¼æ¢ç´¢
â”œâ”€ æ€§èƒ½ä¼˜åŒ–ç®—æ³•ç ”ç©¶
â””â”€ å®‰å…¨æ€§å’Œå¯é æ€§ç ”ç©¶

å·¥ç¨‹å¹¿åº¦ï¼š
â”œâ”€ ä¼ä¸šçº§å¾®å‰ç«¯å¹³å°æ­å»º
â”œâ”€ å¼€å‘è€…å·¥å…·å’Œç”Ÿæ€å»ºè®¾
â”œâ”€ è·¨æŠ€æœ¯æ ˆé›†æˆè§£å†³æ–¹æ¡ˆ
â””â”€ äº‘åŸç”Ÿå¾®å‰ç«¯æ¶æ„

ç¤¾åŒºå½±å“ï¼š
â”œâ”€ æŠ€æœ¯åšå®¢å’Œå¼€æºé¡¹ç›®
â”œâ”€ ä¼šè®®æ¼”è®²å’ŒæŠ€æœ¯åˆ†äº«
â”œâ”€ æ ‡å‡†åˆ¶å®šå’Œè§„èŒƒæ¨åŠ¨
â””â”€ å›¢é˜ŸåŸ¹å…»å’ŒçŸ¥è¯†ä¼ æ‰¿
```

### å¸¸è§è¯¯åŒºå’Œé¿å‘æŒ‡å—

#### âŒ æŠ€æœ¯è¯¯åŒº
1. **è¿‡åº¦æ‹†åˆ†**ï¼šä¸æ˜¯æ‹†å¾—è¶Šç»†è¶Šå¥½ï¼Œè¦è€ƒè™‘ç»´æŠ¤æˆæœ¬
2. **æŠ€æœ¯æ ˆæ··ä¹±**ï¼šè‡ªç”±åº¦é«˜ä¸ç­‰äºå¯ä»¥éšæ„é€‰æ‹©æŠ€æœ¯æ ˆ
3. **å¿½è§†æ€§èƒ½**ï¼šå¾®å‰ç«¯ä¼šå¸¦æ¥é¢å¤–å¼€é”€ï¼Œéœ€è¦åˆç†ä¼˜åŒ–
4. **ç¼ºä¹æ²»ç†**ï¼šæ²¡æœ‰ç»Ÿä¸€è§„èŒƒå¯¼è‡´é¡¹ç›®éš¾ä»¥ç»´æŠ¤

#### âœ… æœ€ä½³å®è·µ
1. **æ¸è¿›å¼è¿ç§»**ï¼šä»è¾¹ç¼˜æ¨¡å—å¼€å§‹ï¼Œé€æ­¥æ‰©å±•
2. **ç»Ÿä¸€æ ‡å‡†**ï¼šåˆ¶å®šå¹¶ä¸¥æ ¼æ‰§è¡Œå¼€å‘è§„èŒƒ
3. **æ€§èƒ½ç›‘æ§**ï¼šå»ºç«‹å®Œå–„çš„æ€§èƒ½ç›‘æ§ä½“ç³»
4. **æ–‡æ¡£å®Œå–„**ï¼šç»´æŠ¤è¯¦ç»†çš„æ¶æ„æ–‡æ¡£å’Œæ“ä½œæ‰‹å†Œ

#### ğŸ”§ å®ç”¨å·¥å…·æ¨è
```javascript
// å¼€å‘å·¥å…·
const developmentTools = {
  è„šæ‰‹æ¶: ['@qiankun/cli', 'single-spa-cli', '@module-federation/cli'],
  è°ƒè¯•å·¥å…·: ['qiankun-devtools', 'single-spa-inspector'],
  æ€§èƒ½åˆ†æ: ['webpack-bundle-analyzer', 'lighthouse'],
  æµ‹è¯•å·¥å…·: ['@testing-library/react', 'cypress', 'playwright'],
  ç›‘æ§å¹³å°: ['sentry', 'datadog', 'new-relic']
}

// ç”Ÿäº§ç¯å¢ƒ
const productionTools = {
  éƒ¨ç½²å¹³å°: ['kubernetes', 'docker', 'vercel'],
  CDN: ['cloudflare', 'aws-cloudfront', 'azure-cdn'],
  ç›‘æ§: ['prometheus', 'grafana', 'elk-stack'],
  é”™è¯¯è¿½è¸ª: ['sentry', 'bugsnag', 'rollbar']
}
```

---

## ğŸ”— å‚è€ƒèµ„æº

### å®˜æ–¹æ–‡æ¡£

#### æ¡†æ¶æ–‡æ¡£
- **qiankun**: [https://qiankun.umijs.org/](https://qiankun.umijs.org/)
- **Single-SPA**: [https://single-spa.js.org/](https://single-spa.js.org/)
- **Module Federation**: [https://module-federation.github.io/](https://module-federation.github.io/)
- **Micro App**: [https://micro-app.dev/](https://micro-app.dev/)

#### æµè§ˆå™¨æ ‡å‡†
- **Web Components**: [https://developer.mozilla.org/en-US/docs/Web/Web_Components](https://developer.mozilla.org/en-US/docs/Web/Web_Components)
- **Custom Elements**: [https://html.spec.whatwg.org/multipage/custom-elements.html](https://html.spec.whatwg.org/multipage/custom-elements.html)
- **Shadow DOM**: [https://dom.spec.whatwg.org/#shadow-trees](https://dom.spec.whatwg.org/#shadow-trees)

### æ·±åº¦å­¦ä¹ èµ„æº

#### ä¹¦ç±æ¨è
- ã€Šå¾®å‰ç«¯ï¼šé¢å‘æœªæ¥çš„å‰ç«¯æ¶æ„ã€‹- å¾®å‰ç«¯å…¨é¢æŒ‡å—
- ã€ŠBuilding Micro-Frontendsã€‹- Luca Mezzalira
- ã€ŠEnterprise Integration Patternsã€‹- ä¼ä¸šé›†æˆæ¨¡å¼

#### æŠ€æœ¯åšå®¢
- **é˜¿é‡Œäº‘å¼€å‘è€…ç¤¾åŒº** - qiankun ç³»åˆ—æ–‡ç« 
- **è…¾è®¯äº‘å¼€å‘è€…ç¤¾åŒº** - å¾®å‰ç«¯å®è·µåˆ†äº«
- **å­—èŠ‚è·³åŠ¨æŠ€æœ¯å›¢é˜Ÿ** - å¤§å‹åº”ç”¨å¾®å‰ç«¯æ”¹é€ 

#### è§†é¢‘æ•™ç¨‹
- **æ…•è¯¾ç½‘** - å¾®å‰ç«¯ä»å…¥é—¨åˆ°å®æˆ˜
- **æå®¢æ—¶é—´** - å‰ç«¯æ¶æ„è¿›é˜¶è¯¾ç¨‹
- **YouTube** - Micro Frontends Conference ç›¸å…³æ¼”è®²

### å¼€æºé¡¹ç›®

#### ç¤ºä¾‹é¡¹ç›®
```javascript
const examples = [
  {
    name: 'qiankun-example',
    url: 'https://github.com/umijs/qiankun/tree/master/examples',
    description: 'qiankun å®˜æ–¹ç¤ºä¾‹é¡¹ç›®'
  },
  {
    name: 'single-spa-examples',
    url: 'https://github.com/single-spa/single-spa-examples',
    description: 'Single-SPA å¤šæŠ€æœ¯æ ˆç¤ºä¾‹'
  },
  {
    name: 'module-federation-examples',
    url: 'https://github.com/module-federation/module-federation-examples',
    description: 'Module Federation å„ç§åœºæ™¯ç¤ºä¾‹'
  },
  {
    name: 'micro-frontends-demo',
    url: 'https://github.com/neuland/micro-frontends',
    description: 'å®Œæ•´çš„å¾®å‰ç«¯ç”µå•†æ¼”ç¤ºé¡¹ç›®'
  }
]
```

#### ç”Ÿäº§çº§é¡¹ç›®
```javascript
const productionProjects = [
  {
    name: 'icestark',
    url: 'https://github.com/ice-lab/icestark',
    company: 'é˜¿é‡Œå·´å·´',
    description: 'é¢å‘å¤§å‹åº”ç”¨çš„å¾®å‰ç«¯è§£å†³æ–¹æ¡ˆ'
  },
  {
    name: 'garfish',
    url: 'https://github.com/web-infra-dev/garfish',
    company: 'å­—èŠ‚è·³åŠ¨',
    description: 'åŒ…å«å®Œæ•´å¾®å‰ç«¯ç”Ÿæ€çš„è§£å†³æ–¹æ¡ˆ'
  },
  {
    name: 'wujie',
    url: 'https://github.com/Tencent/wujie',
    company: 'è…¾è®¯',
    description: 'åŸºäº Web Components çš„å¾®å‰ç«¯æ¡†æ¶'
  }
]
```

### ç¤¾åŒºèµ„æº

#### æŠ€æœ¯ç¤¾åŒº
- **å¾®å‰ç«¯ä¸­æ–‡ç¤¾åŒº**: [https://micro-frontends.org/](https://micro-frontends.org/)
- **å‰ç«¯æ—©è¯»è¯¾**: å¾®å‰ç«¯ç›¸å…³æ–‡ç« åˆé›†
- **æ˜é‡‘å‰ç«¯ç¤¾åŒº**: å¾®å‰ç«¯æ ‡ç­¾ä¸‹çš„ä¼˜è´¨æ–‡ç« 

#### ä¼šè®®å’Œæ´»åŠ¨
- **QCon**: å…¨çƒè½¯ä»¶å¼€å‘å¤§ä¼šå¾®å‰ç«¯ä¸“é¢˜
- **JSConf**: JavaScript å¤§ä¼šç›¸å…³è®®é¢˜
- **FEDay**: å‰ç«¯å¼€å‘è€…å¤§ä¼š

#### åœ¨çº¿å·¥å…·
```javascript
const onlineTools = [
  {
    name: 'Micro Frontend Decision Tree',
    url: 'https://micro-frontends-decision-tree.netlify.app/',
    description: 'å¾®å‰ç«¯æŠ€æœ¯é€‰å‹å†³ç­–å·¥å…·'
  },
  {
    name: 'Bundle Analyzer',
    url: 'https://bundle-analyzer.com/',
    description: 'åŒ…ä½“ç§¯åˆ†æå·¥å…·'
  },
  {
    name: 'Can I Use',
    url: 'https://caniuse.com/',
    description: 'æµè§ˆå™¨å…¼å®¹æ€§æŸ¥è¯¢'
  }
]
```

---

## ğŸ“š æ€»ç»“

å¾®å‰ç«¯ä½œä¸ºä¸€ç§æ¶æ„æ¨¡å¼ï¼Œä¸ºå¤§å‹å‰ç«¯åº”ç”¨çš„å¼€å‘å’Œç»´æŠ¤æä¾›äº†æ–°çš„æ€è·¯å’Œè§£å†³æ–¹æ¡ˆã€‚é€šè¿‡åˆç†çš„æŠ€æœ¯é€‰å‹ã€è§„èŒƒçš„å¼€å‘æµç¨‹å’Œå®Œå–„çš„æ²»ç†ä½“ç³»ï¼Œå¯ä»¥æ˜¾è‘—æå‡å¼€å‘æ•ˆç‡å’Œåº”ç”¨è´¨é‡ã€‚

**å…³é”®è¦ç‚¹**ï¼š
1. **ç†è§£ä¸šåŠ¡éœ€æ±‚**ï¼šé€‰æ‹©åˆé€‚çš„å¾®å‰ç«¯æ–¹æ¡ˆ
2. **æ¸è¿›å¼å®æ–½**ï¼šä»ç®€å•åœºæ™¯å¼€å§‹ï¼Œé€æ­¥æ‰©å±•
3. **æ³¨é‡å·¥ç¨‹åŒ–**ï¼šå»ºç«‹å®Œå–„çš„å¼€å‘å’Œéƒ¨ç½²æµç¨‹
4. **æŒç»­ä¼˜åŒ–**ï¼šå…³æ³¨æ€§èƒ½ã€å®‰å…¨æ€§å’Œç”¨æˆ·ä½“éªŒ
5. **å›¢é˜Ÿåä½œ**ï¼šåŸ¹å…»å¾®å‰ç«¯å¼€å‘æ–‡åŒ–å’Œæœ€ä½³å®è·µ

å¾®å‰ç«¯ä¸æ˜¯é“¶å¼¹ï¼Œä½†åœ¨åˆé€‚çš„åœºæ™¯ä¸‹ï¼Œå®ƒèƒ½å¤Ÿå¸®åŠ©å›¢é˜Ÿæ›´å¥½åœ°åº”å¯¹å¤æ‚æ€§æŒ‘æˆ˜ï¼Œå®ç°å¯æŒç»­çš„å‰ç«¯æ¶æ„æ¼”è¿›ã€‚éšç€æŠ€æœ¯çš„ä¸æ–­å‘å±•ï¼Œå¾®å‰ç«¯ç”Ÿæ€å°†æ›´åŠ æˆç†Ÿï¼Œä¸ºå‰ç«¯å¼€å‘å¸¦æ¥æ›´å¤šå¯èƒ½æ€§ã€‚

å¸Œæœ›è¿™ä»½æ¦‚è®ºèƒ½å¤Ÿå¸®åŠ©ä½ æ·±å…¥ç†è§£å¾®å‰ç«¯æŠ€æœ¯ï¼Œåœ¨å®é™…é¡¹ç›®ä¸­åšå‡ºæ˜æ™ºçš„æŠ€æœ¯å†³ç­–ã€‚è®°ä½ï¼Œæœ€å¥½çš„æ¶æ„æ˜¯æœ€é€‚åˆå½“å‰å›¢é˜Ÿå’Œä¸šåŠ¡åœºæ™¯çš„æ¶æ„ã€‚ç»§ç»­å­¦ä¹ ï¼Œä¿æŒå®è·µï¼Œåœ¨å¾®å‰ç«¯çš„é“è·¯ä¸Šä¸æ–­ç²¾è¿›ï¼ğŸš€

---