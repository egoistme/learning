# ç°ä»£æœåŠ¡ç«¯æ¶æ„æŠ€æœ¯åŸç†è¯¦è§£

## ğŸ¯ æ¦‚è¿°

ç°ä»£æœåŠ¡ç«¯æ¶æ„æ˜¯ä¸€ä¸ªå¤æ‚çš„åˆ†å¸ƒå¼ç³»ç»Ÿï¼ŒåŸºäºå¤šç§æ ¸å¿ƒæŠ€æœ¯åŸç†ååŒå·¥ä½œã€‚æœ¬æ–‡æ¡£ä»æŠ€æœ¯åŸç†å‡ºå‘ï¼Œè€Œéå…·ä½“äº§å“ï¼Œç³»ç»Ÿæ€§åœ°ä»‹ç»æ¯ç§æŠ€æœ¯è§£å†³çš„é—®é¢˜ã€å·¥ä½œåŸç†ä»¥åŠä¸»æµå®ç°æ–¹æ¡ˆï¼Œå¸®åŠ©ä½ å»ºç«‹å®Œæ•´çš„æ¶æ„æ€ç»´ä½“ç³»ã€‚

## ğŸ—ï¸ å®Œæ•´æ¶æ„æŠ€æœ¯åŸç†å›¾è°±

### æ¶æ„åˆ†å±‚è§†å›¾
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ç”¨æˆ·æ¥å…¥å±‚                            â”‚
â”‚        CDNåˆ†å‘ + DNSè§£æ + DDoSé˜²æŠ¤ + SSLåŠ é€Ÿ               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ç½‘å…³ä»£ç†å±‚                          â”‚
â”‚     åå‘ä»£ç† + è´Ÿè½½å‡è¡¡ + APIç½‘å…³ + è®¤è¯æˆæƒ + é™æµç†”æ–­       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      æœåŠ¡æ²»ç†ä¸ç¼–æ’å±‚                        â”‚
â”‚   å®¹å™¨ç¼–æ’ + æœåŠ¡å‘ç° + é…ç½®ä¸­å¿ƒ + é“¾è·¯è¿½è¸ª + æœåŠ¡ç½‘æ ¼        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ä¸šåŠ¡æœåŠ¡å±‚                            â”‚
â”‚        å¾®æœåŠ¡å®ä¾‹ + ä¸šåŠ¡é€»è¾‘ + äº‹ä»¶å¤„ç† + ä»»åŠ¡è°ƒåº¦           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      æ¶ˆæ¯é€šä¿¡ä¸ç¼“å­˜å±‚                        â”‚
â”‚      æ¶ˆæ¯é˜Ÿåˆ— + äº‹ä»¶æ€»çº¿ + å†…å­˜ç¼“å­˜ + åˆ†å¸ƒå¼ç¼“å­˜             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        æ•°æ®å­˜å‚¨å±‚                            â”‚
â”‚   å…³ç³»å‹DB + éå…³ç³»å‹DB + å¯¹è±¡å­˜å‚¨ + æ—¶åºDB + æœç´¢å¼•æ“        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ç›‘æ§è§‚æµ‹ä¸è¿ç»´å±‚                         â”‚
â”‚    æ—¥å¿—èšåˆ + æŒ‡æ ‡ç›‘æ§ + é“¾è·¯è¿½è¸ª + å‘Šè­¦é€šçŸ¥ + è‡ªåŠ¨åŒ–è¿ç»´     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ’¡ æ ¸å¿ƒæŠ€æœ¯åŸç†æ·±åº¦è§£æ

### 1. ç½‘ç»œé€šä¿¡å±‚ ğŸŒ

#### 1.1 åå‘ä»£ç†æŠ€æœ¯ ğŸ”„

**æŠ€æœ¯åŸç†**ï¼šåå‘ä»£ç†æ˜¯ä½äºæœåŠ¡å™¨ç«¯çš„ä»£ç†ï¼Œä»£ç†åç«¯æœåŠ¡å™¨å‘å®¢æˆ·ç«¯æä¾›æœåŠ¡

**è§£å†³é—®é¢˜**ï¼š
- **å•ç‚¹æ•…éšœ**ï¼šå•ä¸ªæœåŠ¡å™¨å´©æºƒå¯¼è‡´æ•´ä¸ªç³»ç»Ÿä¸å¯ç”¨
- **æ€§èƒ½ç“¶é¢ˆ**ï¼šå•å°æœåŠ¡å™¨å¤„ç†èƒ½åŠ›æœ‰é™
- **å®‰å…¨æš´éœ²**ï¼šç›´æ¥æš´éœ²åç«¯æœåŠ¡å™¨IPå’Œç«¯å£
- **é™æ€èµ„æºå¤„ç†**ï¼šåº”ç”¨æœåŠ¡å™¨å¤„ç†é™æ€æ–‡ä»¶æ•ˆç‡ä½

**å·¥ä½œåŸç†**ï¼š
```
å®¢æˆ·ç«¯ â†’ åå‘ä»£ç†æœåŠ¡å™¨ â†’ åç«¯æœåŠ¡å™¨é›†ç¾¤
       â†               â†
```

**ä¸»æµå®ç°äº§å“å¯¹æ¯”**ï¼š

| äº§å“ | ç±»å‹ | ä¼˜åŠ¿ | é€‚ç”¨åœºæ™¯ | æ€§èƒ½ |
|------|------|------|----------|------|
| **Nginx** | å¼€æº | é«˜æ€§èƒ½ã€ä½å†…å­˜å ç”¨ã€é…ç½®ç®€å• | ä¸­å°å‹é¡¹ç›®ã€é™æ€èµ„æº | â˜…â˜…â˜…â˜…â˜… |
| **Apache HTTP** | å¼€æº | åŠŸèƒ½ä¸°å¯Œã€æ¨¡å—åŒ–ã€ç¤¾åŒºæˆç†Ÿ | ä¼ ç»ŸWebåº”ç”¨ | â˜…â˜…â˜…â˜†â˜† |
| **HAProxy** | å¼€æº | ä¸“ä¸šè´Ÿè½½å‡è¡¡ã€å¥åº·æ£€æŸ¥å¼ºå¤§ | å¤§å‹åˆ†å¸ƒå¼ç³»ç»Ÿ | â˜…â˜…â˜…â˜…â˜† |
| **Traefik** | å¼€æº | äº‘åŸç”Ÿã€è‡ªåŠ¨å‘ç°ã€é…ç½®ç®€å• | å®¹å™¨åŒ–ç¯å¢ƒ | â˜…â˜…â˜…â˜…â˜† |
| **F5 BIG-IP** | å•†ä¸š | ä¼ä¸šçº§åŠŸèƒ½ã€ç¡¬ä»¶åŠ é€Ÿ | å¤§å‹ä¼ä¸š | â˜…â˜…â˜…â˜…â˜… |
| **AWS ALB** | äº‘æœåŠ¡ | æ‰˜ç®¡æœåŠ¡ã€è‡ªåŠ¨æ‰©å±• | AWSäº‘ç¯å¢ƒ | â˜…â˜…â˜…â˜…â˜† |
| **Cloudflare** | äº‘æœåŠ¡ | å…¨çƒCDNã€DDoSé˜²æŠ¤ | å…¨çƒåŒ–åº”ç”¨ | â˜…â˜…â˜…â˜…â˜… |

**é…ç½®ç¤ºä¾‹ï¼ˆNginxï¼‰**ï¼š
```nginx
upstream backend {
    # åŠ æƒè½®è¯¢
    server app1:8080 weight=3;
    server app2:8080 weight=2;
    # å¥åº·æ£€æŸ¥
    server app3:8080 backup;
}

server {
    listen 80;

    # APIè¯·æ±‚ä»£ç†
    location /api/ {
        proxy_pass http://backend;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        # è¿æ¥æ± ä¼˜åŒ–
        proxy_http_version 1.1;
        proxy_set_header Connection "";
    }

    # é™æ€èµ„æºç›´æ¥æœåŠ¡
    location /static/ {
        root /var/www;
        expires 30d;
        gzip on;
    }
}
```

#### 1.2 è´Ÿè½½å‡è¡¡æŠ€æœ¯ âš–ï¸

**æŠ€æœ¯åŸç†**ï¼šè´Ÿè½½å‡è¡¡æ˜¯å°†å·¥ä½œè´Ÿè½½åˆ†å¸ƒåˆ°å¤šä¸ªè®¡ç®—èµ„æºçš„æŠ€æœ¯

**è§£å†³é—®é¢˜**ï¼š
- **å•ç‚¹æ€§èƒ½ç“¶é¢ˆ**ï¼šå•å°æœåŠ¡å™¨å¤„ç†èƒ½åŠ›æœ‰é™
- **å¯ç”¨æ€§é—®é¢˜**ï¼šå•ç‚¹æ•…éšœå½±å“æ•´ä¸ªç³»ç»Ÿ
- **èµ„æºåˆ©ç”¨ä¸å‡**ï¼šéƒ¨åˆ†æœåŠ¡å™¨ç©ºé—²ï¼Œéƒ¨åˆ†è¿‡è½½
- **ç”¨æˆ·ä½“éªŒå·®å¼‚**ï¼šä¸åŒç”¨æˆ·è®¿é—®é€Ÿåº¦å·®å¼‚å¤§

**è´Ÿè½½å‡è¡¡å±‚æ¬¡**ï¼š

**Layer 4 è´Ÿè½½å‡è¡¡ï¼ˆä¼ è¾“å±‚ï¼‰**ï¼š
- åŸºäºIPå’Œç«¯å£è¿›è¡Œè½¬å‘
- æ€§èƒ½é«˜ï¼Œå»¶è¿Ÿä½
- æ— æ³•æ„ŸçŸ¥åº”ç”¨å±‚å†…å®¹

**Layer 7 è´Ÿè½½å‡è¡¡ï¼ˆåº”ç”¨å±‚ï¼‰**ï¼š
- åŸºäºHTTPå¤´ã€URLã€Cookieç­‰åº”ç”¨å±‚ä¿¡æ¯
- åŠŸèƒ½ä¸°å¯Œï¼Œå¯åšå†…å®¹è·¯ç”±
- æ€§èƒ½ç›¸å¯¹è¾ƒä½

**æ ¸å¿ƒç®—æ³•è¯¦è§£**ï¼š

```javascript
// 1. è½®è¯¢ç®—æ³•ï¼ˆRound Robinï¼‰
class RoundRobinBalancer {
  constructor(servers) {
    this.servers = servers;
    this.current = 0;
  }

  selectServer() {
    const server = this.servers[this.current];
    this.current = (this.current + 1) % this.servers.length;
    return server;
  }
}

// 2. åŠ æƒè½®è¯¢ç®—æ³•ï¼ˆWeighted Round Robinï¼‰
class WeightedRoundRobinBalancer {
  constructor(serversWeights) {
    this.serversWeights = serversWeights; // [{server: 'app1', weight: 3}, ...]
    this.currentWeights = new Array(serversWeights.length).fill(0);
  }

  selectServer() {
    const totalWeight = this.serversWeights.reduce((sum, item) => sum + item.weight, 0);

    // å¢åŠ å½“å‰æƒé‡
    this.serversWeights.forEach((item, index) => {
      this.currentWeights[index] += item.weight;
    });

    // é€‰æ‹©æƒé‡æœ€å¤§çš„æœåŠ¡å™¨
    const maxWeightIndex = this.currentWeights.indexOf(Math.max(...this.currentWeights));
    const selectedServer = this.serversWeights[maxWeightIndex].server;

    // å‡å°‘é€‰ä¸­æœåŠ¡å™¨çš„æƒé‡
    this.currentWeights[maxWeightIndex] -= totalWeight;

    return selectedServer;
  }
}

// 3. æœ€å°‘è¿æ¥ç®—æ³•ï¼ˆLeast Connectionsï¼‰
class LeastConnectionsBalancer {
  constructor(servers) {
    this.servers = servers;
    this.connections = new Map();
    servers.forEach(server => this.connections.set(server, 0));
  }

  selectServer() {
    let minConnections = Infinity;
    let selectedServer = null;

    for (const [server, connections] of this.connections) {
      if (connections < minConnections) {
        minConnections = connections;
        selectedServer = server;
      }
    }
    return selectedServer;
  }

  addConnection(server) {
    this.connections.set(server, this.connections.get(server) + 1);
  }

  removeConnection(server) {
    this.connections.set(server, Math.max(0, this.connections.get(server) - 1));
  }
}

// 4. ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•ï¼ˆConsistent Hashingï¼‰
const crypto = require('crypto');

class ConsistentHashBalancer {
  constructor(servers, replicas = 150) {
    this.replicas = replicas;
    this.ring = new Map();
    this.sortedKeys = [];

    servers.forEach(server => this.addServer(server));
  }

  addServer(server) {
    for (let i = 0; i < this.replicas; i++) {
      const key = this.hash(`${server}:${i}`);
      this.ring.set(key, server);
    }
    this.sortedKeys = Array.from(this.ring.keys()).sort((a, b) => a - b);
  }

  hash(key) {
    return parseInt(crypto.createHash('md5').update(key).digest('hex').slice(0, 8), 16);
  }

  selectServer(key) {
    if (this.ring.size === 0) return null;

    const hashKey = this.hash(key);

    // æ‰¾åˆ°ç¬¬ä¸€ä¸ªå¤§äºç­‰äºhashKeyçš„æœåŠ¡å™¨
    for (const ringKey of this.sortedKeys) {
      if (ringKey >= hashKey) {
        return this.ring.get(ringKey);
      }
    }

    // å¦‚æœæ²¡æ‰¾åˆ°ï¼Œè¿”å›ç¬¬ä¸€ä¸ªæœåŠ¡å™¨ï¼ˆç¯å½¢ï¼‰
    return this.ring.get(this.sortedKeys[0]);
  }
}

// ä½¿ç”¨ç¤ºä¾‹
const servers = ['app1:8080', 'app2:8080', 'app3:8080'];
const roundRobin = new RoundRobinBalancer(servers);
console.log('Round Robin:', roundRobin.selectServer()); // app1:8080

const weightedServers = [
  { server: 'app1:8080', weight: 3 },
  { server: 'app2:8080', weight: 2 },
  { server: 'app3:8080', weight: 1 }
];
const weighted = new WeightedRoundRobinBalancer(weightedServers);
console.log('Weighted Round Robin:', weighted.selectServer());
```

**äº§å“é€‰æ‹©å¯¹æ¯”**ï¼š

| äº§å“ç±»å‹ | ä»£è¡¨äº§å“ | æ€§èƒ½ | åŠŸèƒ½ | æˆæœ¬ | é€‚ç”¨åœºæ™¯ |
|----------|----------|------|------|------|----------|
| **ç¡¬ä»¶LB** | F5 BIG-IP, A10 Thunder | æé«˜ | ä¸°å¯Œ | å¾ˆé«˜ | å¤§å‹ä¼ä¸šï¼Œå…³é”®ä¸šåŠ¡ |
| **è½¯ä»¶LB** | Nginx, HAProxy, LVS | é«˜ | ä¸­ç­‰ | ä½ | ä¸­å°å‹é¡¹ç›® |
| **äº‘LB** | AWS ALB/NLB, Azure LB | é«˜ | ä¸°å¯Œ | ä¸­ç­‰ | äº‘åŸç”Ÿåº”ç”¨ |
| **Service Mesh** | Istio, Linkerd | ä¸­ç­‰ | å¾ˆä¸°å¯Œ | ä¸­ç­‰ | å¾®æœåŠ¡æ¶æ„ |

#### 1.3 APIç½‘å…³æŠ€æœ¯ ğŸšª

**æŠ€æœ¯åŸç†**ï¼šAPIç½‘å…³æ˜¯å¾®æœåŠ¡æ¶æ„ä¸­çš„ç»Ÿä¸€å…¥å£ï¼Œè´Ÿè´£è·¯ç”±ã€èšåˆã€åè®®è½¬æ¢ã€å®‰å…¨è®¤è¯ç­‰

**è§£å†³é—®é¢˜**ï¼š
- **æœåŠ¡çˆ†ç‚¸**ï¼šå®¢æˆ·ç«¯éœ€è¦è°ƒç”¨å¤šä¸ªæœåŠ¡ï¼Œå¤æ‚åº¦é«˜
- **åè®®å·®å¼‚**ï¼šä¸åŒæœåŠ¡ä½¿ç”¨ä¸åŒåè®®ï¼ˆHTTPã€gRPCã€TCPï¼‰
- **æ¨ªåˆ‡å…³åˆ‡**ï¼šè®¤è¯ã€æˆæƒã€é™æµã€ç›‘æ§ç­‰åœ¨æ¯ä¸ªæœåŠ¡ä¸­é‡å¤
- **ç‰ˆæœ¬ç®¡ç†**ï¼šå¤šä¸ªAPIç‰ˆæœ¬å¹¶å­˜çš„å¤æ‚åº¦

**æ ¸å¿ƒåŠŸèƒ½**ï¼š
```yaml
# APIç½‘å…³åŠŸèƒ½æ¶æ„
api_gateway:
  routing:         # è·¯ç”±è½¬å‘
    - path_based   # åŸºäºè·¯å¾„
    - host_based   # åŸºäºåŸŸå
    - header_based # åŸºäºè¯·æ±‚å¤´

  aggregation:     # æ•°æ®èšåˆ
    - response_merge  # å“åº”åˆå¹¶
    - batch_request   # æ‰¹é‡è¯·æ±‚
    - graph_query     # GraphQLèšåˆ

  transformation:  # åè®®è½¬æ¢
    - rest_to_grpc   # RESTâ†”gRPC
    - format_convert # JSONâ†”XML
    - field_mapping  # å­—æ®µæ˜ å°„

  security:        # å®‰å…¨æ§åˆ¶
    - authentication # èº«ä»½è®¤è¯
    - authorization  # æƒé™æ§åˆ¶
    - rate_limiting  # é™æµæ§åˆ¶
    - input_validation # è¾“å…¥æ ¡éªŒ

  monitoring:      # ç›‘æ§è§‚æµ‹
    - request_logging # è¯·æ±‚æ—¥å¿—
    - metrics_collection # æŒ‡æ ‡æ”¶é›†
    - distributed_tracing # åˆ†å¸ƒå¼è¿½è¸ª
```

**ä¸»æµäº§å“å¯¹æ¯”**ï¼š

| äº§å“ | ç±»å‹ | æ ¸å¿ƒä¼˜åŠ¿ | é€‚ç”¨åœºæ™¯ | æ€§èƒ½è¯„çº§ |
|------|------|----------|----------|----------|
| **Kong** | å¼€æº | æ’ä»¶ä¸°å¯Œã€Luaè„šæœ¬ã€ç”Ÿæ€æˆç†Ÿ | ä¼ä¸šçº§åº”ç”¨ | â˜…â˜…â˜…â˜…â˜† |
| **Zuul** | å¼€æº | Springç”Ÿæ€ã€Javaå¼€å‘å‹å¥½ | Spring Cloudé¡¹ç›® | â˜…â˜…â˜…â˜†â˜† |
| **Envoy** | å¼€æº | C++é«˜æ€§èƒ½ã€äº‘åŸç”Ÿè®¾è®¡ | Service Mesh | â˜…â˜…â˜…â˜…â˜… |
| **APISIX** | å¼€æº | äº‘åŸç”Ÿã€åŠ¨æ€é…ç½®ã€å¤šè¯­è¨€æ”¯æŒ | äº‘åº”ç”¨ | â˜…â˜…â˜…â˜…â˜† |
| **AWS API Gateway** | äº‘æœåŠ¡ | æ‰˜ç®¡æœåŠ¡ã€Serverlessé›†æˆ | AWSç”Ÿæ€ | â˜…â˜…â˜…â˜…â˜† |
| **Azure API Management** | äº‘æœåŠ¡ | ä¼ä¸šçº§åŠŸèƒ½ã€å¼€å‘è€…é—¨æˆ· | Azureç”Ÿæ€ | â˜…â˜…â˜…â˜…â˜† |
| **Google Cloud Endpoints** | äº‘æœåŠ¡ | gRPCåŸç”Ÿæ”¯æŒã€OpenAPI | GCPç”Ÿæ€ | â˜…â˜…â˜…â˜…â˜† |

### 2. è®¡ç®—ä¸ç¼–æ’å±‚ ğŸ› ï¸

#### 2.1 å®¹å™¨åŒ–æŠ€æœ¯ ğŸ“¦

**æŠ€æœ¯åŸç†**ï¼šå®¹å™¨æ˜¯æ“ä½œç³»ç»Ÿè™šæ‹ŸåŒ–æŠ€æœ¯ï¼Œå°†åº”ç”¨åŠå…¶ä¾èµ–æ‰“åŒ…æˆè½»é‡çº§ã€å¯ç§»æ¤çš„æ‰§è¡Œå•å…ƒ

**è§£å†³é—®é¢˜**ï¼š
- **ç¯å¢ƒä¸€è‡´æ€§**ï¼šâ€œåœ¨æˆ‘æœºå™¨ä¸Šèƒ½è¿è¡Œâ€é—®é¢˜
- **éƒ¨ç½²å¤æ‚åº¦**ï¼šä¾èµ–ç®¡ç†ã€ç¯å¢ƒé…ç½®å¤æ‚
- **èµ„æºåˆ©ç”¨ç‡**ï¼šè™šæ‹Ÿæœºèµ„æºå¼€é”€å¤§
- **æ‰©å±•é€Ÿåº¦**ï¼šä¼ ç»Ÿéƒ¨ç½²æ‰©å±•æ…¢

**æ ¸å¿ƒä¼˜åŠ¿**ï¼š
```yaml
# å®¹å™¨ vs è™šæ‹Ÿæœºå¯¹æ¯”
container_vs_vm:
  å¯åŠ¨æ—¶é—´:
    container: "100æ¯«ç§’ - 2ç§’"
    vm: "30ç§’ - 2åˆ†é’Ÿ"

  èµ„æºå¼€é”€:
    container: "MBçº§å†…å­˜å¼€é”€"
    vm: "GBçº§å†…å­˜å¼€é”€"

  å¯†åº¦:
    container: "å•æœºæ•°ååˆ°æ•°ç™¾ä¸ª"
    vm: "å•æœºæ•°ä¸ªåˆ°æ•°åä¸ª"

  ç§»æ¤æ€§:
    container: "ä¸€æ¬¡æ„å»ºï¼Œåœ¨ä»»ä½•åœ°æ–¹è¿è¡Œ"
    vm: "éœ€è¦é€‚é…åº•å±‚ç¡¬ä»¶"
```

**å·¥ä½œåŸç†**ï¼š
```
ä¼ ç»Ÿéƒ¨ç½²ï¼šåº”ç”¨ â†’ æ“ä½œç³»ç»Ÿ â†’ ç‰©ç†æœº
è™šæ‹ŸåŒ–ï¼š  åº”ç”¨ â†’ å®¢æˆ·æœºOS â†’ Hypervisor â†’ ä¸»æœºOS â†’ ç‰©ç†æœº
å®¹å™¨åŒ–ï¼š  åº”ç”¨ â†’ å®¹å™¨ â†’ å®¹å™¨å¼•æ“ â†’ ä¸»æœºOS â†’ ç‰©ç†æœº
```

**ä¸»æµå®¹å™¨æŠ€æœ¯å¯¹æ¯”**ï¼š

| æŠ€æœ¯ | ç±»å‹ | ä¼˜åŠ¿ | ç¼ºç‚¹ | é€‚ç”¨åœºæ™¯ |
|------|------|------|------|----------|
| **Docker** | å®¹å™¨å¼•æ“ | ç”Ÿæ€æˆç†Ÿã€æ˜“ç”¨æ€§å¥½ | å®‰å…¨æ€§ç›¸å¯¹è¾ƒå¼± | å¼€å‘ã€æµ‹è¯•ã€ä¸­å°å‹ç”Ÿäº§ |
| **Podman** | å®¹å™¨å¼•æ“ | æ— å®ˆæŠ¤è¿›ç¨‹ã€å®‰å…¨æ€§å¥½ | ç”Ÿæ€ç›¸å¯¹è¾ƒå° | ä¼ä¸šç¯å¢ƒã€å®‰å…¨æ•æ„Ÿ |
| **containerd** | å®¹å™¨è¿è¡Œæ—¶ | è½»é‡ã€é«˜æ€§èƒ½ | åŠŸèƒ½ç›¸å¯¹ç®€å• | Kubernetesåç«¯ |
| **CRI-O** | å®¹å™¨è¿è¡Œæ—¶ | ä¸“ä¸ºK8sè®¾è®¡ã€å®‰å…¨ | åŠŸèƒ½ç›¸å¯¹ç®€å• | Kubernetesç¯å¢ƒ |
| **rkt** | å®¹å™¨å¼•æ“ | å®‰å…¨æ€§é«˜ã€ç¬¦åˆæ ‡å‡† | å·²åœæ­¢ç»´æŠ¤ | å·²ä¸æ¨è |

#### 2.2 å®¹å™¨ç¼–æ’æŠ€æœ¯ ğŸ›ï¸

**æŠ€æœ¯åŸç†**ï¼šå®¹å™¨ç¼–æ’æ˜¯è‡ªåŠ¨åŒ–éƒ¨ç½²ã€ç®¡ç†ã€æ‰©å±•å’Œç½‘ç»œåŒ–å®¹å™¨åŒ–åº”ç”¨çš„æŠ€æœ¯

**è§£å†³é—®é¢˜**ï¼š
- **å®¹å™¨ç”Ÿå‘½å‘¨æœŸç®¡ç†**ï¼šæ‰‹åŠ¨ç®¡ç†æ•°ç™¾ä¸Šåƒå®¹å™¨ä¸ç°å®
- **æœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡**ï¼šå¾®æœåŠ¡é—´çš„é€šä¿¡å¤æ‚æ€§
- **èµ„æºè°ƒåº¦ä¸ä¼˜åŒ–**ï¼šé«˜æ•ˆåˆ©ç”¨é›†ç¾¤èµ„æº
- **æ•…éšœæ¢å¤å’Œè‡ªæ„ˆ**ï¼šè‡ªåŠ¨å¤„ç†åº”ç”¨å’ŒèŠ‚ç‚¹æ•…éšœ
- **é…ç½®ç®¡ç†**ï¼šå°†é…ç½®ä¸ä»£ç åˆ†ç¦»

**Kubernetesæ ¸å¿ƒæ¦‚å¿µæ·±åº¦è§£æ**ï¼š

```yaml
# 1. Pod - æœ€å°è°ƒåº¦å•å…ƒ
apiVersion: v1
kind: Pod
metadata:
  name: webapp-pod
  labels:
    app: webapp
spec:
  containers:
  - name: webapp
    image: webapp:v1.0
    ports:
    - containerPort: 8080
    resources:
      requests:     # èµ„æºè¯·æ±‚ï¼ˆç”¨äºè°ƒåº¦ï¼‰
        memory: "128Mi"
        cpu: "100m"
      limits:       # èµ„æºé™åˆ¶ï¼ˆç”¨äºé™åˆ¶ï¼‰
        memory: "256Mi"
        cpu: "200m"
  - name: sidecar   # Sidecaræ¨¡å¼
    image: logging-agent:v1.0

---
# 2. Deployment - ç®¡ç†Podå‰¯æœ¬
apiVersion: apps/v1
kind: Deployment
metadata:
  name: webapp-deployment
spec:
  replicas: 3       # æœŸæœ›å‰¯æœ¬æ•°
  strategy:
    type: RollingUpdate
    rollingUpdate:
      maxUnavailable: 1    # æ»šåŠ¨æ›´æ–°ç­–ç•¥
      maxSurge: 1
  selector:
    matchLabels:
      app: webapp
  template:
    metadata:
      labels:
        app: webapp
    spec:
      containers:
      - name: webapp
        image: webapp:v1.0

---
# 3. Service - æœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡
apiVersion: v1
kind: Service
metadata:
  name: webapp-service
spec:
  type: ClusterIP    # ClusterIP | NodePort | LoadBalancer
  selector:
    app: webapp
  ports:
  - port: 80
    targetPort: 8080
    protocol: TCP

---
# 4. ConfigMap - éæ•æ„Ÿé…ç½®
apiVersion: v1
kind: ConfigMap
metadata:
  name: webapp-config
data:
  database_url: "mysql://db:3306/app"
  log_level: "info"
  app.properties: |
    spring.datasource.url=jdbc:mysql://db:3306/app
    logging.level.com.example=INFO

---
# 5. Secret - æ•æ„Ÿä¿¡æ¯
apiVersion: v1
kind: Secret
metadata:
  name: webapp-secret
type: Opaque
data:
  username: YWRtaW4=      # base64ç¼–ç 
  password: cGFzc3dvcmQ=  # base64ç¼–ç 

---
# 6. Ingress - HTTP/HTTPSè·¯ç”±
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: webapp-ingress
  annotations:
    nginx.ingress.kubernetes.io/rewrite-target: /
spec:
  rules:
  - host: webapp.example.com
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: webapp-service
            port:
              number: 80
```

**å®¹å™¨ç¼–æ’å¹³å°å¯¹æ¯”**ï¼š

| å¹³å° | å­¦ä¹ æ›²çº¿ | ç”Ÿæ€æˆç†Ÿåº¦ | é€‚ç”¨è§„æ¨¡ | ç‰¹è‰²åŠŸèƒ½ |
|------|----------|----------|----------|----------|
| **Kubernetes** | é«˜ | æé«˜ | å¤§ä¸­å°å‹ | å…¨é¢çš„å®¹å™¨ç¼–æ’èƒ½åŠ› |
| **Docker Swarm** | ä½ | ä¸­ç­‰ | ä¸­å°å‹ | ç®€å•æ˜“ç”¨ï¼Œä¸DockeråŸç”Ÿé›†æˆ |
| **Nomad** | ä¸­ç­‰ | ä¸­ç­‰ | ä¸­å¤§å‹ | è·¨å¹³å°ï¼Œæ”¯æŒå¤šç§å·¥ä½œè´Ÿè½½ |
| **Apache Mesos** | é«˜ | ä¸­ç­‰ | å¤§å‹ | ä¸¤å±‚è°ƒåº¦ï¼Œæ”¯æŒå¤šæ¡†æ¶ |
| **Amazon ECS** | ä¸­ç­‰ | é«˜ | ä¸­å¤§å‹ | AWSåŸç”Ÿé›†æˆï¼Œæ‰˜ç®¡æœåŠ¡ |
| **Azure AKS** | ä¸­ç­‰ | é«˜ | ä¸­å¤§å‹ | AzureåŸç”Ÿé›†æˆï¼Œæ‰˜ç®¡K8s |
| **Google GKE** | ä¸­ç­‰ | é«˜ | ä¸­å¤§å‹ | GoogleåŸç”Ÿé›†æˆï¼Œæœ€æˆç†Ÿçš„K8sæœåŠ¡ |

**å…¸å‹YAMLé…ç½®**ï¼š
```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: web-app
spec:
  replicas: 3
  selector:
    matchLabels:
      app: web-app
  template:
    metadata:
      labels:
        app: web-app
    spec:
      containers:
      - name: app
        image: myapp:v1.0
        ports:
        - containerPort: 8080
        resources:
          requests:
            memory: "256Mi"
            cpu: "250m"
          limits:
            memory: "512Mi"
            cpu: "500m"
```

#### 2.3 æœåŠ¡å‘ç°æŠ€æœ¯ ğŸ”

**æŠ€æœ¯åŸç†**ï¼šæœåŠ¡å‘ç°æ˜¯å¾®æœåŠ¡æ¶æ„ä¸­çš„è‡ªåŠ¨åŒ–æœºåˆ¶ï¼Œç”¨äºæœåŠ¡æ³¨å†Œã€å‘ç°å’Œè´Ÿè½½å‡è¡¡

**è§£å†³é—®é¢˜**ï¼š
- **ç¡¬ç¼–ç åœ°å€**ï¼šæœåŠ¡é—´çš„IPå’Œç«¯å£ç¡¬ç¼–ç åœ¨é…ç½®ä¸­
- **åŠ¨æ€æ‰©ç¼©å®¹**ï¼šæ–°å¢æˆ–åˆ é™¤å®ä¾‹æ—¶éœ€è¦æ›´æ–°æ‰€æœ‰ç›¸å…³é…ç½®
- **å¥åº·æ£€æŸ¥**ï¼šè‡ªåŠ¨æ£€æµ‹å’Œå‰”é™¤ä¸å¥åº·çš„æœåŠ¡å®ä¾‹
- **è·¯ç”±é€‰æ‹©**ï¼šæ ¹æ®åœ°ç†ä½ç½®ã€è´Ÿè½½ã€ç‰ˆæœ¬é€‰æ‹©æœ€ä¼˜æœåŠ¡

**æ ¸å¿ƒæ¨¡å¼**ï¼š

**1. å®¢æˆ·ç«¯å‘ç°æ¨¡å¼**ï¼š
```
æœåŠ¡A â†’ æœåŠ¡æ³¨å†Œä¸­å¿ƒ â†’ è·å–æœåŠ¡Båˆ—è¡¨ â†’ ç›´æ¥è°ƒç”¨æœåŠ¡B
```

**2. æœåŠ¡ç«¯å‘ç°æ¨¡å¼**ï¼š
```
æœåŠ¡A â†’ è´Ÿè½½å‡è¡¡å™¨ â†’ æœåŠ¡Bï¼ˆè´Ÿè½½å‡è¡¡å™¨ä»æ³¨å†Œä¸­å¿ƒè·å–å®ä¾‹ï¼‰
```

**3. Service Meshæ¨¡å¼**ï¼š
```
æœåŠ¡A â†’ Sidecar Proxy â†’ Sidecar Proxy â†’ æœåŠ¡B
           â”‚                     â”‚
           â””â”€â”€â”€â”€æ§åˆ¶å¹³å°â”€â”€â”€â”€â”€â”˜
```

**ä¸»æµæœåŠ¡å‘ç°äº§å“å¯¹æ¯”**ï¼š

| äº§å“ | ç±»å‹ | æ ¸å¿ƒä¼˜åŠ¿ | ç¼ºç‚¹ | é€‚ç”¨åœºæ™¯ |
|------|------|----------|------|----------|
| **Consul** | CPæ¨¡å‹ | å¤šæ•°æ®ä¸­å¿ƒã€å¼ºä¸€è‡´æ€§ã€å¥åº·æ£€æŸ¥ | æ€§èƒ½ç›¸å¯¹è¾ƒä½ | ä¼ä¸šçº§åº”ç”¨ |
| **Eureka** | APæ¨¡å‹ | Springç”Ÿæ€ã€é«˜å¯ç”¨ã€æ˜“ç”¨ | å¼±ä¸€è‡´æ€§ã€å·²åœæ­¢å¼€å‘ | Spring Cloudé¡¹ç›® |
| **Etcd** | CPæ¨¡å‹ | å¼ºä¸€è‡´æ€§ã€é«˜æ€§èƒ½ã€K8såŸç”Ÿ | åŠŸèƒ½ç›¸å¯¹ç®€å• | Kubernetesã€CoreOS |
| **Zookeeper** | CPæ¨¡å‹ | æˆç†Ÿç¨³å®šã€å¼ºä¸€è‡´æ€§ | é…ç½®å¤æ‚ã€è€æ—§æ¶æ„ | Hadoopç”Ÿæ€ã€Kafka |
| **Nacos** | AP/CPå¯åˆ‡æ¢ | å›½äº§ã€åŠŸèƒ½å…¨é¢ã€ä¸­æ–‡æ–‡æ¡£ | ç¤¾åŒºç›¸å¯¹è¾ƒå° | å›½å†…ä¸­å°å‹é¡¹ç›® |
| **Istio** | Service Mesh | æ— ä¾µå…¥æ€§ã€åŠŸèƒ½ä¸°å¯Œ | å¤æ‚åº¦é«˜ã€æ€§èƒ½å¼€é”€ | äº‘åŸç”Ÿåº”ç”¨ |

**é…ç½®ä¸­å¿ƒæŠ€æœ¯ ğŸ› ï¸**

**æŠ€æœ¯åŸç†**ï¼šé…ç½®ä¸­å¿ƒæ˜¯é›†ä¸­ç®¡ç†åº”ç”¨é…ç½®ä¿¡æ¯çš„ç³»ç»Ÿï¼Œæ”¯æŒåŠ¨æ€æ›´æ–°å’Œç¯å¢ƒéš”ç¦»

**è§£å†³é—®é¢˜**ï¼š
- **é…ç½®æ•£è½**ï¼šé…ç½®ä¿¡æ¯åˆ†æ•£åœ¨å„ä¸ªæœåŠ¡ä¸­ï¼Œç®¡ç†å›°éš¾
- **ç¯å¢ƒä¸€è‡´æ€§**ï¼šå¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ç¯å¢ƒé…ç½®ä¸ä¸€è‡´
- **åŠ¨æ€æ›´æ–°**ï¼šä¿®æ”¹é…ç½®éœ€è¦é‡å¯åº”ç”¨
- **å®‰å…¨æ€§**ï¼šæ•æ„Ÿé…ç½®ï¼ˆå¯†ç ã€ç§˜é’¥ï¼‰çš„å®‰å…¨ç®¡ç†

**ä¸»æµé…ç½®ä¸­å¿ƒå¯¹æ¯”**ï¼š

| äº§å“ | ç‰¹è‰²åŠŸèƒ½ | é€‚ç”¨åœºæ™¯ | å­¦ä¹ æˆæœ¬ |
|------|----------|----------|----------|
| **Apollo** | ç‰ˆæœ¬ç®¡ç†ã€æƒé™æ§åˆ¶ã€ç‚é‡Šå‘å¸ƒ | å¤§å‹ä¼ä¸š | é«˜ |
| **Spring Cloud Config** | Springç”Ÿæ€ã€Gité›†æˆ | Spring Cloudé¡¹ç›® | ä¸­ |
| **Nacos Config** | å¤šæ•°æ®æ ¼å¼ã€å‘½åç©ºé—´ | é˜¿é‡Œäº‘ç”Ÿæ€ | ä½ |
| **Etcd** | å¼ºä¸€è‡´æ€§ã€watchæœºåˆ¶ | Kubernetesé¡¹ç›® | ä¸­ |
| **Consul KV** | å¤šæ•°æ®ä¸­å¿ƒã€äº‹åŠ¡æ”¯æŒ | å¤šäº‘éƒ¨ç½² | ä¸­ |

### 3. æ¶ˆæ¯é€šä¿¡å±‚ ğŸ“¨

#### 3.1 æ¶ˆæ¯é˜Ÿåˆ—æŠ€æœ¯ ğŸ“©

**æŠ€æœ¯åŸç†**ï¼šæ¶ˆæ¯é˜Ÿåˆ—æ˜¯åœ¨ç³»ç»Ÿé—´ä¼ é€’æ¶ˆæ¯çš„ä¸­é—´ä»¶ï¼Œå®ç°å¼‚æ­¥é€šä¿¡å’Œè§£è€¦

**è§£å†³é—®é¢˜**ï¼š
- **ç³»ç»Ÿè€¦åˆ**ï¼šæœåŠ¡é—´ç›´æ¥è°ƒç”¨å¯¼è‡´ç´§è€¦åˆ
- **æ€§èƒ½ç“¶é¢ˆ**ï¼šåŒæ­¥è°ƒç”¨å¯¼è‡´æ€§èƒ½ä½ä¸‹
- **å¯é æ€§é—®é¢˜**ï¼šç½‘ç»œæ•…éšœæˆ–æœåŠ¡ä¸å¯ç”¨æ—¶æ¶ˆæ¯ä¸¢å¤±
- **æµé‡å³°å€¼**ï¼šçªå‘æµé‡å†²å‡»åç«¯æœåŠ¡

**æ¶ˆæ¯æ¨¡å¼å¯¹æ¯”**ï¼š

**1. ç‚¹å¯¹ç‚¹æ¨¡å¼ï¼ˆPoint-to-Pointï¼‰**ï¼š
```
ç”Ÿäº§è€… â†’ é˜Ÿåˆ— â†’ æ¶ˆè´¹è€…ï¼ˆä¸€å¯¹ä¸€ï¼‰
```

**2. å‘å¸ƒè®¢é˜…æ¨¡å¼ï¼ˆPublish-Subscribeï¼‰**ï¼š
```
ç”Ÿäº§è€… â†’ ä¸»é¢˜/äº¤æ¢æœº â†’ å¤šä¸ªæ¶ˆè´¹è€…ï¼ˆä¸€å¯¹å¤šï¼‰
```

**3. è¯·æ±‚å“åº”æ¨¡å¼ï¼ˆRequest-Replyï¼‰**ï¼š
```
å®¢æˆ·ç«¯ â†’ è¯·æ±‚é˜Ÿåˆ— â†’ æœåŠ¡ç«¯ â†’ å“åº”é˜Ÿåˆ— â†’ å®¢æˆ·ç«¯
```

**ä¸»æµæ¶ˆæ¯é˜Ÿåˆ—å¯¹æ¯”**ï¼š

| äº§å“ | æ¨¡å¼ | æ€§èƒ½ | å¯é æ€§ | å¤æ‚åº¦ | é€‚ç”¨åœºæ™¯ |
|------|------|------|--------|--------|----------|
| **Redis** | Pub/Sub | æé«˜ | ä½ | ä½ | ç®€å•æ¶ˆæ¯é€šçŸ¥ |
| **RabbitMQ** | AMQP | é«˜ | é«˜ | ä¸­ | ä¼ä¸šåº”ç”¨é›†æˆ |
| **Apache Kafka** | æµå¤„ç† | æé«˜ | é«˜ | é«˜ | å¤§æ•°æ®ã€æ—¥å¿—æ”¶é›† |
| **Apache Pulsar** | ç»Ÿä¸€æ¶ˆæ¯ | é«˜ | é«˜ | é«˜ | äº‘åŸç”Ÿåº”ç”¨ |
| **RocketMQ** | å¯é æ¶ˆæ¯ | é«˜ | å¾ˆé«˜ | ä¸­ | é‡‘èã€ç”µå•† |
| **NATS** | è½»é‡çº§ | æé«˜ | ä¸­ | ä½ | å¾®æœåŠ¡é€šä¿¡ |
| **Amazon SQS** | æ‰˜ç®¡æœåŠ¡ | é«˜ | é«˜ | ä½ | AWSäº‘ç¯å¢ƒ |

**Node.jsæ¶ˆæ¯é˜Ÿåˆ—ä½¿ç”¨ç¤ºä¾‹**ï¼š

```javascript
// ä½¿ç”¨RabbitMQçš„æ¶ˆæ¯é˜Ÿåˆ—ç¤ºä¾‹
const amqp = require('amqplib');

class MessageQueue {
  constructor() {
    this.connection = null;
    this.channel = null;
  }

  async connect() {
    try {
      this.connection = await amqp.connect(process.env.RABBITMQ_URL || 'amqp://localhost');
      this.channel = await this.connection.createChannel();
      console.log('Connected to RabbitMQ');
    } catch (error) {
      console.error('Failed to connect to RabbitMQ:', error);
    }
  }

  // å‘å¸ƒ/è®¢é˜…æ¨¡å¼
  async publishToExchange(exchange, routingKey, message) {
    try {
      await this.channel.assertExchange(exchange, 'topic', { durable: true });
      const messageBuffer = Buffer.from(JSON.stringify(message));

      const published = this.channel.publish(exchange, routingKey, messageBuffer, {
        persistent: true, // æ¶ˆæ¯æŒä¹…åŒ–
        timestamp: Date.now(),
        messageId: require('crypto').randomUUID()
      });

      if (published) {
        console.log(`Message published to ${exchange}:${routingKey}`);
        return true;
      }
      return false;
    } catch (error) {
      console.error('Failed to publish message:', error);
      return false;
    }
  }

  // è®¢é˜…æ¶ˆæ¯
  async subscribeToExchange(exchange, queue, routingKey, handler) {
    try {
      await this.channel.assertExchange(exchange, 'topic', { durable: true });
      await this.channel.assertQueue(queue, { durable: true });
      await this.channel.bindQueue(queue, exchange, routingKey);

      // è®¾ç½®QoSï¼Œæ¯æ¬¡åªå¤„ç†ä¸€æ¡æ¶ˆæ¯
      await this.channel.prefetch(1);

      await this.channel.consume(queue, async (msg) => {
        if (msg) {
          try {
            const content = JSON.parse(msg.content.toString());
            console.log(`Received message from ${queue}:`, content);

            // å¤„ç†æ¶ˆæ¯
            await handler(content);

            // ç¡®è®¤æ¶ˆæ¯å¤„ç†å®Œæˆ
            this.channel.ack(msg);
          } catch (error) {
            console.error('Error processing message:', error);
            // æ‹’ç»æ¶ˆæ¯å¹¶é‡æ–°å…¥é˜Ÿ
            this.channel.nack(msg, false, true);
          }
        }
      });

      console.log(`Subscribed to ${exchange}:${routingKey}`);
    } catch (error) {
      console.error('Failed to subscribe:', error);
    }
  }

  // ç‚¹å¯¹ç‚¹é˜Ÿåˆ—æ¨¡å¼
  async sendToQueue(queue, message) {
    try {
      await this.channel.assertQueue(queue, { durable: true });
      const messageBuffer = Buffer.from(JSON.stringify(message));

      const sent = this.channel.sendToQueue(queue, messageBuffer, {
        persistent: true
      });

      if (sent) {
        console.log(`Message sent to queue ${queue}`);
        return true;
      }
      return false;
    } catch (error) {
      console.error('Failed to send to queue:', error);
      return false;
    }
  }

  // æ¶ˆè´¹é˜Ÿåˆ—æ¶ˆæ¯
  async consumeFromQueue(queue, handler) {
    try {
      await this.channel.assertQueue(queue, { durable: true });
      await this.channel.prefetch(1);

      await this.channel.consume(queue, async (msg) => {
        if (msg) {
          try {
            const content = JSON.parse(msg.content.toString());
            await handler(content);
            this.channel.ack(msg);
          } catch (error) {
            console.error('Error processing queue message:', error);
            this.channel.nack(msg, false, true);
          }
        }
      });

      console.log(`Consuming from queue ${queue}`);
    } catch (error) {
      console.error('Failed to consume from queue:', error);
    }
  }

  async close() {
    if (this.connection) {
      await this.connection.close();
    }
  }
}

// ä½¿ç”¨Redisä½œä¸ºç®€å•æ¶ˆæ¯é˜Ÿåˆ—
const redis = require('redis');

class RedisMessageQueue {
  constructor() {
    this.publisher = redis.createClient();
    this.subscriber = redis.createClient();
  }

  async connect() {
    await Promise.all([
      this.publisher.connect(),
      this.subscriber.connect()
    ]);
    console.log('Connected to Redis');
  }

  // å‘å¸ƒæ¶ˆæ¯
  async publish(channel, message) {
    try {
      const messageStr = JSON.stringify({
        data: message,
        timestamp: Date.now(),
        id: require('crypto').randomUUID()
      });

      const result = await this.publisher.publish(channel, messageStr);
      console.log(`Published to ${channel}, subscribers: ${result}`);
      return result;
    } catch (error) {
      console.error('Failed to publish:', error);
      return 0;
    }
  }

  // è®¢é˜…æ¶ˆæ¯
  async subscribe(channel, handler) {
    try {
      await this.subscriber.subscribe(channel, (message) => {
        try {
          const parsed = JSON.parse(message);
          console.log(`Received from ${channel}:`, parsed.data);
          handler(parsed.data);
        } catch (error) {
          console.error('Error handling message:', error);
        }
      });

      console.log(`Subscribed to channel ${channel}`);
    } catch (error) {
      console.error('Failed to subscribe:', error);
    }
  }

  // ä½¿ç”¨Listä½œä¸ºé˜Ÿåˆ—ï¼ˆFIFOï¼‰
  async pushToQueue(queue, message) {
    try {
      const messageStr = JSON.stringify({
        data: message,
        timestamp: Date.now(),
        id: require('crypto').randomUUID()
      });

      await this.publisher.lPush(queue, messageStr);
      console.log(`Pushed to queue ${queue}`);
    } catch (error) {
      console.error('Failed to push to queue:', error);
    }
  }

  // ä»é˜Ÿåˆ—æ¶ˆè´¹æ¶ˆæ¯ï¼ˆé˜»å¡å¼ï¼‰
  async consumeFromQueue(queue, handler, timeout = 0) {
    try {
      while (true) {
        const result = await this.subscriber.brPop(queue, timeout);
        if (result) {
          const message = JSON.parse(result.element);
          console.log(`Consumed from ${queue}:`, message.data);
          await handler(message.data);
        }
      }
    } catch (error) {
      console.error('Failed to consume from queue:', error);
    }
  }
}

// ä½¿ç”¨ç¤ºä¾‹
async function example() {
  // RabbitMQç¤ºä¾‹
  const mq = new MessageQueue();
  await mq.connect();

  // å‘å¸ƒè®¢é˜…æ¨¡å¼
  await mq.subscribeToExchange('user.events', 'user.created.queue', 'user.created', async (data) => {
    console.log('å¤„ç†ç”¨æˆ·åˆ›å»ºäº‹ä»¶:', data);
    // å‘é€æ¬¢è¿é‚®ä»¶ç­‰ä¸šåŠ¡é€»è¾‘
  });

  await mq.publishToExchange('user.events', 'user.created', {
    userId: 1001,
    email: 'user@example.com',
    name: 'å¼ ä¸‰'
  });

  // ç‚¹å¯¹ç‚¹æ¨¡å¼
  await mq.consumeFromQueue('email.queue', async (data) => {
    console.log('å‘é€é‚®ä»¶:', data);
    // å®é™…å‘é€é‚®ä»¶é€»è¾‘
  });

  await mq.sendToQueue('email.queue', {
    to: 'user@example.com',
    subject: 'æ¬¢è¿æ³¨å†Œ',
    body: 'æ„Ÿè°¢æ‚¨æ³¨å†Œæˆ‘ä»¬çš„æœåŠ¡'
  });

  // Redisç¤ºä¾‹
  const redisMQ = new RedisMessageQueue();
  await redisMQ.connect();

  // å‘å¸ƒè®¢é˜…
  await redisMQ.subscribe('notifications', (data) => {
    console.log('æ”¶åˆ°é€šçŸ¥:', data);
  });

  await redisMQ.publish('notifications', {
    type: 'system',
    message: 'ç³»ç»Ÿç»´æŠ¤é€šçŸ¥'
  });
}

module.exports = { MessageQueue, RedisMessageQueue };
```

### 4. Docker - åº”ç”¨æ‰“åŒ…ç›’ ğŸ“¦

### 4. æ•°æ®å­˜å‚¨å±‚ ğŸ—„ï¸

#### 4.1 å…³ç³»å‹æ•°æ®åº“æŠ€æœ¯ ğŸ—‡ï¸

**æŠ€æœ¯åŸç†**ï¼šå…³ç³»å‹æ•°æ®åº“åŸºäºACIDäº‹åŠ¡å’ŒSQLæŸ¥è¯¢ï¼Œä½¿ç”¨çš„ç³»ç»Ÿæ¥ç®¡ç†ç»“æ„åŒ–æ•°æ®

**è§£å†³é—®é¢˜**ï¼š
- **æ•°æ®ä¸€è‡´æ€§**ï¼šä¿è¯æ•°æ®çš„å‡†ç¡®æ€§å’Œå®Œæ•´æ€§
- **å¤æ‚æŸ¥è¯¢**ï¼šæ”¯æŒå¤æ‚çš„è”è¡¨æŸ¥è¯¢å’Œèšåˆæ“ä½œ
- **äº‹åŠ¡å¤„ç†**ï¼šæ”¯æŒACIDäº‹åŠ¡ï¼Œä¿è¯æ“ä½œçš„åŸå­æ€§
- **æ•°æ®å®‰å…¨**ï¼šæä¾›å®Œå–„çš„æƒé™æ§åˆ¶å’Œå®‰å…¨æœºåˆ¶

**ACIDç‰¹æ€§è¯¦è§£**ï¼š

```sql
-- åŸå­æ€§ï¼ˆAtomicityï¼‰ç¤ºä¾‹ï¼šè½¬è´¦æ“ä½œ
BEGIN TRANSACTION;
    UPDATE accounts SET balance = balance - 100 WHERE id = 1;  -- æ‰£æ¬¾
    UPDATE accounts SET balance = balance + 100 WHERE id = 2;  -- å…¥è´¦

    -- å¦‚æœä»»ä½•ä¸€æ­¥å¤±è´¥ï¼Œæ•´ä¸ªäº‹åŠ¡å›æ»š
    IF @@ERROR <> 0
        ROLLBACK TRANSACTION;
    ELSE
        COMMIT TRANSACTION;

-- ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰ï¼šæ•°æ®åº“çº¦æŸ
ALTER TABLE accounts ADD CONSTRAINT chk_balance CHECK (balance >= 0);

-- éš”ç¦»æ€§ï¼ˆIsolationï¼‰ï¼šäº‹åŠ¡éš”ç¦»çº§åˆ«
SET TRANSACTION ISOLATION LEVEL READ COMMITTED;
-- READ UNCOMMITTED | READ COMMITTED | REPEATABLE READ | SERIALIZABLE

-- æŒä¹…æ€§ï¼ˆDurabilityï¼‰ï¼šæ—¥å¿—å’Œæ£€æŸ¥ç‚¹æœºåˆ¶ä¿è¯æ•°æ®æ°¸ä¹…åŒ–
```

**ä¸»æµå…³ç³»å‹æ•°æ®åº“å¯¹æ¯”**ï¼š

| æ•°æ®åº“ | ç±»å‹ | æ€§èƒ½ | åŠŸèƒ½ | æˆæœ¬ | é€‚ç”¨åœºæ™¯ |
|--------|------|------|------|------|----------|
| **MySQL** | å¼€æº | é«˜ | å…¨é¢ | ä½ | Webåº”ç”¨ã€ä¸­å°å‹ç³»ç»Ÿ |
| **PostgreSQL** | å¼€æº | é«˜ | å¾ˆå…¨é¢ | ä½ | å¤æ‚åº”ç”¨ã€åœ°ç†ä¿¡æ¯ |
| **Oracle** | å•†ä¸š | æé«˜ | æœ€å…¨é¢ | æé«˜ | å¤§å‹ä¼ä¸šã€å…³é”®ä¸šåŠ¡ |
| **SQL Server** | å•†ä¸š | é«˜ | å…¨é¢ | é«˜ | Windowsç”Ÿæ€ã€ä¼ä¸šåº”ç”¨ |
| **MariaDB** | å¼€æº | é«˜ | å…¨é¢ | ä½ | MySQLæ›¿ä»£æ–¹æ¡ˆ |
| **Amazon RDS** | äº‘æœåŠ¡ | é«˜ | æ‰˜ç®¡ | ä¸­ | AWSäº‘åŸç”Ÿåº”ç”¨ |
| **Google Cloud SQL** | äº‘æœåŠ¡ | é«˜ | æ‰˜ç®¡ | ä¸­ | GCPäº‘åŸç”Ÿåº”ç”¨ |

#### 4.2 éå…³ç³»å‹æ•°æ®åº“æŠ€æœ¯ ğŸ—€ï¸

**æŠ€æœ¬åŸç†**ï¼šéå…³ç³»å‹æ•°æ®åº“æ˜¯ä¸ºäº†å¤„ç†å¤§è§„æ¨¡ã€é«˜å¹¶å‘ã€åˆ†å¸ƒå¼åœºæ™¯è€Œè®¾è®¡çš„æ•°æ®å­˜å‚¨ç³»ç»Ÿ

**è§£å†³é—®é¢˜**ï¼š
- **æ°´å¹³æ‰©å±•æ€§**ï¼šå…³ç³»å‹æ•°æ®åº“å‚ç›´æ‰©å±•æˆæœ¬é«˜
- **é«˜å¹¶å‘è¯»å†™**ï¼šä¼ ç»Ÿæ•°æ®åº“åœ¨é«˜å¹¶å‘ä¸‹æ€§èƒ½ä¸‹é™
- **å¤§æ•°æ®å­˜å‚¨**ï¼šPBçº§æ•°æ®å­˜å‚¨å’Œå¤„ç†
- **çµæ´»æ¨¡å¼**ï¼šåŠç»“æ„åŒ–å’Œéç»“æ„åŒ–æ•°æ®å­˜å‚¨

**NoSQLæ•°æ®åº“åˆ†ç±»**ï¼š

**1. æ–‡æ¡£å‹æ•°æ®åº“**ï¼š
```javascript
// MongoDB ç¤ºä¾‹
{
  "_id": "507f1f77bcf86cd799439011",
  "name": "å¼ ä¸‰",
  "age": 25,
  "address": {
    "city": "åŒ—äº¬",
    "district": "æœé˜³åŒº"
  },
  "hobbies": ["reading", "swimming"],
  "created_at": ISODate("2024-01-15T10:30:00Z")
}
```

**2. é”®å€¼å‹æ•°æ®åº“**ï¼š
```
# Redis ç¤ºä¾‹
user:1001 -> {"name": "å¼ ä¸‰", "age": 25}
session:abc123 -> {"user_id": 1001, "login_time": "2024-01-15"}
cache:products -> ["product1", "product2", "product3"]
```

**3. åˆ—æ—å‹æ•°æ®åº“**ï¼š
```
// Cassandra ç¤ºä¾‹
CREATE TABLE user_activity (
    user_id UUID,
    activity_time TIMESTAMP,
    activity_type TEXT,
    details MAP<TEXT, TEXT>,
    PRIMARY KEY (user_id, activity_time)
) WITH CLUSTERING ORDER BY (activity_time DESC);
```

**4. å›¾å‹æ•°æ®åº“**ï¼š
```cypher
// Neo4j ç¤ºä¾‹
CREATE (alice:Person {name: 'Alice', age: 25})
CREATE (bob:Person {name: 'Bob', age: 30})
CREATE (company:Company {name: 'TechCorp'})
CREATE (alice)-[:WORKS_FOR]->(company)
CREATE (alice)-[:KNOWS]->(bob)

// æŸ¥è¯¢æœ‹å‹çš„æœ‹å‹
MATCH (person:Person)-[:KNOWS]->(friend)-[:KNOWS]->(friendOfFriend)
WHERE person.name = 'Alice'
RETURN friendOfFriend.name
```

**NoSQLæ•°æ®åº“é€‰æ‹©å¯¹æ¯”**ï¼š

| ç±»å‹ | ä»£è¡¨äº§å“ | ä¼˜åŠ¿ | é™åˆ¶ | é€‚ç”¨åœºæ™¯ |
|------|----------|------|------|----------|
| **æ–‡æ¡£å‹** | MongoDB, CouchDB | çµæ´»æ¨¡å¼ã€å¿«é€Ÿå¼€å‘ | æŸ¥è¯¢æ€§èƒ½ç›¸å¯¹è¾ƒä½ | CMSã€åšå®¢ã€ç”¨æˆ·é…ç½® |
| **é”®å€¼å‹** | Redis, DynamoDB | æé«˜æ€§èƒ½ã€ç®€å•æ˜“ç”¨ | æ•°æ®ç»“æ„ç®€å• | ç¼“å­˜ã€ä¼šè¯å­˜å‚¨ã€è®¡æ•°å™¨ |
| **åˆ—æ—å‹** | Cassandra, HBase | é«˜å†™å…¥æ€§èƒ½ã€æ°´å¹³æ‰©å±• | æŸ¥è¯¢çµæ´»æ€§ä½ | æ—¥å¿—å­˜å‚¨ã€æ—¶åºæ•°æ®ã€IoT |
| **å›¾å‹** | Neo4j, ArangoDB | å…³ç³»æŸ¥è¯¢é«˜æ•ˆ | æ•°æ®é‡é™åˆ¶ | ç¤¾äº¤ç½‘ç»œã€æ¨èç³»ç»Ÿã€çŸ¥è¯†å›¾è°± |

#### 4.3 ç¼“å­˜æŠ€æœ¯ âš¡

**æŠ€æœ¯åŸç†**ï¼šç¼“å­˜æ˜¯å°†ç»å¸¸è®¿é—®çš„æ•°æ®å­˜å‚¨åœ¨é«˜é€Ÿå­˜å‚¨åª’ä»‹ä¸­ï¼Œå‡å°‘æ•°æ®è®¿é—®å»¶è¿Ÿ

**è§£å†³é—®é¢˜**ï¼š
- **æ•°æ®åº“å‹åŠ›**ï¼šå‡å°‘å¯¹åç«¯æ•°æ®åº“çš„è®¿é—®é¢‘ç‡
- **å“åº”å»¶è¿Ÿ**ï¼šå†…å­˜è®¿é—®æ¯”ç£ç›˜å¿«1000å€
- **ç½‘ç»œå¸¦å®½**ï¼šå‡å°‘è·¨ç½‘ç»œçš„æ•°æ®ä¼ è¾“
- **å¹¶å‘èƒ½åŠ›**ï¼šæé«˜ç³»ç»Ÿçš„å¹¶å‘å¤„ç†èƒ½åŠ›

**ç¼“å­˜æ¨¡å¼**ï¼š

```javascript
const redis = require('redis');
const client = redis.createClient();

// 1. Cache-Asideï¼ˆæ—è·¯ç¼“å­˜ï¼‰
async function getUser(userId) {
  try {
    // å…ˆæŸ¥ç¼“å­˜
    const cachedUser = await client.get(`user:${userId}`);
    if (cachedUser) {
      console.log('Cache hit');
      return JSON.parse(cachedUser);
    }

    // ç¼“å­˜æœªå‘½ä¸­ï¼ŒæŸ¥æ•°æ®åº“
    console.log('Cache miss, querying database');
    const user = await database.getUserById(userId);

    if (user) {
      // å†™å…¥ç¼“å­˜ï¼Œè®¾ç½®1å°æ—¶è¿‡æœŸ
      await client.setEx(`user:${userId}`, 3600, JSON.stringify(user));
    }

    return user;
  } catch (error) {
    console.error('Cache error:', error);
    // ç¼“å­˜é”™è¯¯æ—¶ç›´æ¥æŸ¥æ•°æ®åº“
    return await database.getUserById(userId);
  }
}

async function updateUser(userId, data) {
  try {
    // æ›´æ–°æ•°æ®åº“
    await database.updateUser(userId, data);

    // åˆ é™¤ç¼“å­˜ä»¥ä¿è¯ä¸€è‡´æ€§
    await client.del(`user:${userId}`);

    console.log(`User ${userId} updated and cache invalidated`);
  } catch (error) {
    console.error('Update user error:', error);
    throw error;
  }
}

// 2. Write-Throughï¼ˆå†™ç›´è¾¾ï¼‰
async function updateUserWriteThrough(userId, data) {
  try {
    // åŒæ—¶æ›´æ–°æ•°æ®åº“å’Œç¼“å­˜
    await Promise.all([
      database.updateUser(userId, data),
      client.setEx(`user:${userId}`, 3600, JSON.stringify(data))
    ]);

    console.log(`User ${userId} updated in both database and cache`);
  } catch (error) {
    console.error('Write-through error:', error);
    throw error;
  }
}

// 3. Write-Backï¼ˆå†™å›ï¼‰
class WriteBackCache {
  constructor() {
    this.dirtyData = new Map(); // è®°å½•è„æ•°æ®
    this.flushInterval = setInterval(() => this.flushToDB(), 30000); // æ¯30ç§’åˆ·æ–°ä¸€æ¬¡
  }

  async updateUserWriteBack(userId, data) {
    try {
      // åªæ›´æ–°ç¼“å­˜
      await client.setEx(`user:${userId}`, 3600, JSON.stringify(data));

      // æ ‡è®°ä¸ºè„æ•°æ®ï¼Œå»¶è¿Ÿå†™å…¥æ•°æ®åº“
      this.dirtyData.set(userId, data);

      console.log(`User ${userId} updated in cache, scheduled for DB write`);
    } catch (error) {
      console.error('Write-back error:', error);
      throw error;
    }
  }

  async flushToDB() {
    if (this.dirtyData.size === 0) return;

    console.log(`Flushing ${this.dirtyData.size} dirty records to database`);

    for (const [userId, data] of this.dirtyData) {
      try {
        await database.updateUser(userId, data);
        this.dirtyData.delete(userId);
      } catch (error) {
        console.error(`Failed to flush user ${userId}:`, error);
      }
    }
  }

  destroy() {
    clearInterval(this.flushInterval);
  }
}

// ä½¿ç”¨ç¤ºä¾‹
const writeBackCache = new WriteBackCache();

// æ¨¡æ‹Ÿæ•°æ®åº“æ“ä½œ
const database = {
  async getUserById(userId) {
    // æ¨¡æ‹Ÿæ•°æ®åº“æŸ¥è¯¢
    console.log(`Querying database for user ${userId}`);
    return { id: userId, name: `User ${userId}`, email: `user${userId}@example.com` };
  },

  async updateUser(userId, data) {
    // æ¨¡æ‹Ÿæ•°æ®åº“æ›´æ–°
    console.log(`Updating database for user ${userId}:`, data);
    return true;
  }
};
```

**ç¼“å­˜ç±»å‹å¯¹æ¯”**ï¼š

| ç±»å‹ | ä¼˜åŠ¿ | ç¼ºç‚¹ | é€‚ç”¨åœºæ™¯ |
|------|------|------|----------|
| **æœ¬åœ°ç¼“å­˜** | æ€§èƒ½æœ€é«˜ã€æ— ç½‘ç»œå¼€é”€ | æ•°æ®ä¸åŒæ­¥ã€å†…å­˜é™åˆ¶ | å•æœºåº”ç”¨ã€è®¡ç®—ç»“æœ |
| **åˆ†å¸ƒå¼ç¼“å­˜** | æ•°æ®å…±äº«ã€é«˜å¯ç”¨æ€§ | ç½‘ç»œå¼€é”€ã€ä¸€è‡´æ€§å¤æ‚ | å¾®æœåŠ¡æ¶æ„ã€é›†ç¾¤åº”ç”¨ |
| **CDNç¼“å­˜** | å…¨çƒåŠ é€Ÿã€å‡å°‘å¸¦å®½ | æ›´æ–°å»¶è¿Ÿã€æˆæœ¬è¾ƒé«˜ | é™æ€èµ„æºã€å†…å®¹åˆ†å‘ |

#### 4.4 å¯¹è±¡å­˜å‚¨æŠ€æœ¯ ğŸ“

**æŠ€æœ¯åŸç†**ï¼šå¯¹è±¡å­˜å‚¨æ˜¯ä¸€ç§æ•°æ®å­˜å‚¨æ¶æ„ï¼Œå°†æ•°æ®ä½œä¸ºå¯¹è±¡åœ¨å¹³å‡åœ°å€ç©ºé—´å†…ç®¡ç†

**è§£å†³é—®é¢˜**ï¼š
- **å¤§æ–‡ä»¶å­˜å‚¨**ï¼šå…³ç³»å‹æ•°æ®åº“ä¸é€‚åˆå­˜å‚¨å¤§æ–‡ä»¶
- **æ— é™æ‰©å±•**ï¼šç†è®ºä¸Šå¯ä»¥æ— é™æ‰©å±•å­˜å‚¨å®¹é‡
- **å…¨çƒåˆ†å‘**ï¼šç»“åˆCDNå®ç°å…¨çƒå¿«é€Ÿè®¿é—®
- **æˆæœ¬ä¼˜åŒ–**ï¼šæŒ‰ä½¿ç”¨é‡ä»˜è´¹ï¼Œæˆæœ¬ç›¸å¯¹è¾ƒä½

**å­˜å‚¨ç±»å‹åˆ†ç±»**ï¼š

**1. çƒ­å­˜å‚¨ï¼ˆHot Storageï¼‰**ï¼š
- é«˜é¢‘è®¿é—®æ•°æ®
- æ¯«ç§’çº§å“åº”
- æˆæœ¬ç›¸å¯¹è¾ƒé«˜
- é€‚ç”¨ï¼šç½‘ç«™å›¾ç‰‡ã€è§†é¢‘æµåª’ä½“

**2. å†·å­˜å‚¨ï¼ˆCold Storageï¼‰**ï¼š
- ä½é¢‘è®¿é—®æ•°æ®
- åˆ†é’Ÿçº§å“åº”
- æˆæœ¬æä½
- é€‚ç”¨ï¼šæ•°æ®å¤‡ä»½ã€å½’æ¡£æ•°æ®

**3. å½’æ¡£å­˜å‚¨ï¼ˆArchive Storageï¼‰**ï¼š
- æå°‘è®¿é—®æ•°æ®
- å°æ—¶çº§å“åº”
- æˆæœ¬æœ€ä½
- é€‚ç”¨ï¼šé•¿æœŸå½’æ¡£ã€æ³•å¾‹è¦æ±‚

**ä¸»æµå¯¹è±¡å­˜å‚¨æœåŠ¡å¯¹æ¯”**ï¼š

| æœåŠ¡ | å‚å•† | ç‰¹è‰²åŠŸèƒ½ | æˆæœ¬æ¨¡å¼ | ç”Ÿæ€é›†æˆ |
|------|------|----------|----------|----------|
| **S3** | AWS | åŠŸèƒ½æœ€å…¨ã€ç”Ÿæ€æœ€ä¸°å¯Œ | åˆ†å±‚å®šä»· | AWSåŸç”Ÿé›†æˆ |
| **Azure Blob** | Microsoft | ä¸.NETæ·±åº¦é›†æˆ | åˆ†å±‚å®šä»· | AzureåŸç”Ÿé›†æˆ |
| **Google Cloud Storage** | Google | AI/MLé›†æˆå¥½ | ç»Ÿä¸€å®šä»· | GCPåŸç”Ÿé›†æˆ |
| **é˜¿é‡Œäº‘OSS** | é˜¿é‡Œå·´å·´ | å›½å†…ç½‘ç»œä¼˜åŒ– | åˆ†å±‚å®šä»· | é˜¿é‡Œäº‘ç”Ÿæ€ |
| **è…¾è®¯äº‘COS** | è…¾è®¯ | ç¤¾äº¤åª’ä½“ä¼˜åŒ– | åˆ†å±‚å®šä»· | è…¾è®¯äº‘ç”Ÿæ€ |
| **MinIO** | å¼€æº | ç§æœ‰éƒ¨ç½²ã€S3å…¼å®¹ | è‡ªå»ºæˆæœ¬ | KubernetesåŸç”Ÿ |
| **Ceph** | å¼€æº | ç»Ÿä¸€å­˜å‚¨ã€é«˜å¯ç”¨ | è‡ªå»ºæˆæœ¬ | OpenStacké›†æˆ |

**ä½¿ç”¨ç¤ºä¾‹**ï¼š

```javascript
// AWS S3 SDK v3 ç¤ºä¾‹
const { S3Client, PutObjectCommand, GetObjectCommand, CreateMultipartUploadCommand,
        UploadPartCommand, CompleteMultipartUploadCommand } = require('@aws-sdk/client-s3');
const { getSignedUrl } = require('@aws-sdk/s3-request-presigner');
const fs = require('fs');
const path = require('path');

// åˆå§‹åŒ–S3å®¢æˆ·ç«¯
const s3Client = new S3Client({
  region: process.env.AWS_REGION || 'us-east-1',
  credentials: {
    accessKeyId: process.env.AWS_ACCESS_KEY_ID,
    secretAccessKey: process.env.AWS_SECRET_ACCESS_KEY
  }
});

// ä¸Šä¼ æ–‡ä»¶
async function uploadFile(filePath, bucket, key) {
  try {
    const fileStream = fs.createReadStream(filePath);
    const uploadParams = {
      Bucket: bucket,
      Key: key,
      Body: fileStream,
      ContentType: getContentType(filePath)
    };

    const command = new PutObjectCommand(uploadParams);
    const result = await s3Client.send(command);

    // ç”Ÿæˆå…¬å¼€URL
    const url = `https://${bucket}.s3.amazonaws.com/${key}`;
    console.log(`æ–‡ä»¶ä¸Šä¼ æˆåŠŸ: ${url}`);
    return { url, etag: result.ETag };
  } catch (error) {
    console.error(`ä¸Šä¼ å¤±è´¥:`, error);
    return null;
  }
}

// ç”Ÿæˆç­¾åURLï¼ˆä¸´æ—¶è®¿é—®ï¼‰
async function generatePresignedUrl(bucket, key, expiration = 3600) {
  try {
    const command = new GetObjectCommand({
      Bucket: bucket,
      Key: key
    });

    const signedUrl = await getSignedUrl(s3Client, command, {
      expiresIn: expiration
    });

    return signedUrl;
  } catch (error) {
    console.error('ç”Ÿæˆç­¾åURLå¤±è´¥:', error);
    return null;
  }
}

// åˆ†å—ä¸Šä¼ ï¼ˆå¤§æ–‡ä»¶ï¼‰
async function multipartUpload(filePath, bucket, key, chunkSize = 5 * 1024 * 1024) {
  try {
    const fileSize = fs.statSync(filePath).size;
    console.log(`å¼€å§‹åˆ†å—ä¸Šä¼ : ${filePath} (å¤§å°: ${fileSize} å­—èŠ‚)`);

    // 1. åˆå§‹åŒ–åˆ†å—ä¸Šä¼ 
    const createCommand = new CreateMultipartUploadCommand({
      Bucket: bucket,
      Key: key,
      ContentType: getContentType(filePath)
    });
    const createResult = await s3Client.send(createCommand);
    const uploadId = createResult.UploadId;

    // 2. ä¸Šä¼ å„ä¸ªåˆ†å—
    const parts = [];
    const totalParts = Math.ceil(fileSize / chunkSize);

    for (let partNumber = 1; partNumber <= totalParts; partNumber++) {
      const start = (partNumber - 1) * chunkSize;
      const end = Math.min(start + chunkSize, fileSize);

      const partStream = fs.createReadStream(filePath, { start, end: end - 1 });

      const uploadPartCommand = new UploadPartCommand({
        Bucket: bucket,
        Key: key,
        PartNumber: partNumber,
        UploadId: uploadId,
        Body: partStream
      });

      const partResult = await s3Client.send(uploadPartCommand);
      parts.push({
        ETag: partResult.ETag,
        PartNumber: partNumber
      });

      console.log(`åˆ†å— ${partNumber}/${totalParts} ä¸Šä¼ å®Œæˆ`);
    }

    // 3. å®Œæˆåˆ†å—ä¸Šä¼ 
    const completeCommand = new CompleteMultipartUploadCommand({
      Bucket: bucket,
      Key: key,
      UploadId: uploadId,
      MultipartUpload: { Parts: parts }
    });

    const result = await s3Client.send(completeCommand);
    console.log(`åˆ†å—ä¸Šä¼ å®Œæˆ: ${result.Location}`);

    return result.Location;
  } catch (error) {
    console.error('åˆ†å—ä¸Šä¼ å¤±è´¥:', error);
    return null;
  }
}

// è·å–æ–‡ä»¶MIMEç±»å‹
function getContentType(filePath) {
  const ext = path.extname(filePath).toLowerCase();
  const mimeTypes = {
    '.jpg': 'image/jpeg',
    '.jpeg': 'image/jpeg',
    '.png': 'image/png',
    '.gif': 'image/gif',
    '.pdf': 'application/pdf',
    '.txt': 'text/plain',
    '.json': 'application/json',
    '.mp4': 'video/mp4',
    '.mp3': 'audio/mpeg'
  };
  return mimeTypes[ext] || 'application/octet-stream';
}

// ä½¿ç”¨ç¤ºä¾‹
async function example() {
  const bucket = 'my-test-bucket';
  const filePath = './example.jpg';
  const key = `uploads/${Date.now()}_example.jpg`;

  // å°æ–‡ä»¶ç›´æ¥ä¸Šä¼ 
  const result = await uploadFile(filePath, bucket, key);
  if (result) {
    console.log('ä¸Šä¼ æˆåŠŸ:', result.url);

    // ç”Ÿæˆä¸´æ—¶è®¿é—®é“¾æ¥
    const signedUrl = await generatePresignedUrl(bucket, key, 3600);
    console.log('ä¸´æ—¶è®¿é—®é“¾æ¥:', signedUrl);
  }

  // å¤§æ–‡ä»¶åˆ†å—ä¸Šä¼ 
  const largeFileKey = `uploads/${Date.now()}_large_file.zip`;
  await multipartUpload('./large_file.zip', bucket, largeFileKey);
}

module.exports = {
  uploadFile,
  generatePresignedUrl,
  multipartUpload
};
```

### 5. ç›‘æ§è§‚æµ‹å±‚ ğŸ”

#### 5.1 æ—¥å¿—èšåˆæŠ€æœ¯ ğŸ“„

**æŠ€æœ¯åŸç†**ï¼šæ—¥å¿—èšåˆæ˜¯å°†åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„æ—¥å¿—æ•°æ®é›†ä¸­æ”¶é›†ã€å­˜å‚¨ã€åˆ†æçš„æŠ€æœ¯

**è§£å†³é—®é¢˜**ï¼š
- **æ—¥å¿—åˆ†æ•£**ï¼šå¾®æœåŠ¡æ¶æ„ä¸­æ—¥å¿—åˆ†å¸ƒåœ¨å¤šä¸ªèŠ‚ç‚¹
- **æ•…éšœæ’æŸ¥**ï¼šéš¾ä»¥å¿«é€Ÿå®šä½é—®é¢˜æ‰€åœ¨
- **æ€§èƒ½åˆ†æ**ï¼šéœ€è¦åˆ†æç³»ç»Ÿæ€§èƒ½ç“¶é¢ˆ
- **å®‰å…¨å®¡è®¡**ï¼šéœ€è¦é›†ä¸­å­˜å‚¨å’Œåˆ†æå®‰å…¨æ—¥å¿—

**æ—¥å¿—å¤„ç†æµç¨‹**ï¼š
```
åº”ç”¨æœåŠ¡ â†’ æ—¥å¿—æ”¶é›†å™¨ â†’ æ¶ˆæ¯é˜Ÿåˆ— â†’ æ—¥å¿—å¤„ç† â†’ å­˜å‚¨ â†’ å¯è§†åŒ–/å‘Šè­¦
    â”‚           â”‚            â”‚             â”‚         â”‚
   Logs      Filebeat/     Kafka/      Logstash/   ES/    Kibana/
            Fluentd      RabbitMQ     Fluentd    ClickHouse Grafana
```

**ä¸»æµæ—¥å¿—æŠ€æœ¯æ ˆå¯¹æ¯”**ï¼š

| æŠ€æœ¯æ ˆ | æ”¶é›† | å¤„ç† | å­˜å‚¨ | å¯è§†åŒ– | ä¼˜åŠ¿ | é€‚ç”¨åœºæ™¯ |
|--------|------|------|------|--------|------|----------|
| **ELK Stack** | Filebeat | Logstash | Elasticsearch | Kibana | åŠŸèƒ½å…¨é¢ã€ç”Ÿæ€æˆç†Ÿ | ä¼ä¸šçº§åº”ç”¨ |
| **EFK Stack** | Filebeat | Fluentd | Elasticsearch | Kibana | è½»é‡çº§ã€çµæ´»é…ç½® | äº‘åŸç”Ÿåº”ç”¨ |
| **Loki Stack** | Promtail | Loki | Loki | Grafana | é«˜æ€§èƒ½ã€ä½æˆæœ¬ | äº‘åŸç”Ÿç›‘æ§ |
| **Splunk** | Forwarder | Splunk | Splunk | Splunk | ä¼ä¸šçº§åŠŸèƒ½ | å¤§å‹ä¼ä¸š |
| **é˜¿é‡Œäº‘SLS** | Logtail | SLS | SLS | SLS | æ‰˜ç®¡æœåŠ¡ | é˜¿é‡Œäº‘ç¯å¢ƒ |

#### 5.2 æŒ‡æ ‡ç›‘æ§æŠ€æœ¯ ğŸ“ˆ

**æŠ€æœ¯åŸç†**ï¼šæŒ‡æ ‡ç›‘æ§æ˜¯æ”¶é›†ã€å­˜å‚¨å’Œåˆ†æç³»ç»Ÿè¿è¡ŒæŒ‡æ ‡çš„æŠ€æœ¯ï¼Œç”¨äºç›‘æ§ç³»ç»Ÿå¥åº·çŠ¶æ€

**æ ¸å¿ƒæŒ‡æ ‡ç±»å‹**ï¼š

**1. ç³»ç»ŸæŒ‡æ ‡**ï¼š
```
CPUä½¿ç”¨ç‡ã€å†…å­˜ä½¿ç”¨ç‡ã€ç£ç›˜I/Oã€ç½‘ç»œå¸¦å®½
è¿›ç¨‹æ•°é‡ã€æ–‡ä»¶å¥æŸ„æ•°ã€ç³»ç»Ÿè´Ÿè½½
```

**2. åº”ç”¨æŒ‡æ ‡**ï¼š
```
è¯·æ±‚é‡ï¼ˆQPSï¼‰ã€å“åº”æ—¶é—´ã€é”™è¯¯ç‡
å¹¶å‘ç”¨æˆ·æ•°ã€æ•°æ®åº“è¿æ¥æ•°ã€é˜Ÿåˆ—é•¿åº¦
```

**3. ä¸šåŠ¡æŒ‡æ ‡**ï¼š
```
ç”¨æˆ·æ³¨å†Œæ•°ã€è®¢å•é‡ã€æ”¯ä»˜æˆåŠŸç‡
ç”¨æˆ·ç•™å­˜ç‡ã€è½¬æ¢ç‡ã€å®¢æˆ·æ»¡æ„åº¦
```

**ç›‘æ§ç³»ç»Ÿå¯¹æ¯”**ï¼š

| ç³»ç»Ÿ | ç±»å‹ | ç‰¹è‰² | é€‚ç”¨åœºæ™¯ |
|------|------|------|----------|
| **Prometheus** | æ‹‰å–æ¨¡å¼ | äº‘åŸç”Ÿã€é«˜æ€§èƒ½ã€PromQL | Kubernetesã€å¾®æœåŠ¡ |
| **Zabbix** | æ¨é€æ¨¡å¼ | åŠŸèƒ½å…¨é¢ã€ä¼ ç»Ÿæ¶æ„ | ä¼ ç»ŸåŸºç¡€è®¾æ–½ |
| **Nagios** | ä¸»åŠ¨æ£€æŸ¥ | æˆç†Ÿç¨³å®šã€æ’ä»¶ä¸°å¯Œ | åŸºç¡€è®¾æ–½ç›‘æ¥ |
| **Datadog** | äº‘æœåŠ¡ | SaaSæœåŠ¡ã€é›†æˆåº¦é«˜ | äº‘åŸç”Ÿåº”ç”¨ |
| **New Relic** | äº‘æœåŠ¡ | APMä¸“ä¸šã€æ€§èƒ½åˆ†æ | åº”ç”¨æ€§èƒ½ç›‘æ§ |

#### 5.3 é“¾è·¯è¿½è¸ªæŠ€æœ¯ ğŸ”—

**æŠ€æœ¯åŸç†**ï¼šåˆ†å¸ƒå¼è¿½è¸ªæ˜¯è·Ÿè¸ªè¯·æ±‚åœ¨å¾®æœåŠ¡æ¶æ„ä¸­çš„å®Œæ•´è°ƒç”¨é“¾è·¯

**è§£å†³é—®é¢˜**ï¼š
- **è°ƒç”¨é“¾å¤æ‚**ï¼šå¾®æœåŠ¡é—´çš„è°ƒç”¨å…³ç³»å¤æ‚
- **æ€§èƒ½ç“¶é¢ˆå®šä½**ï¼šéš¾ä»¥å®šä½å“ªä¸ªæœåŠ¡å¯¼è‡´æ€§èƒ½é—®é¢˜
- **é”™è¯¯æ’æŸ¥**ï¼šéš¾ä»¥è¿½è¸ªé”™è¯¯åœ¨æ•´ä¸ªè°ƒç”¨é“¾ä¸­çš„ä¼ æ’­
- **ä¾èµ–åˆ†æ**ï¼šä¸äº†è§£æœåŠ¡é—´çš„ä¾èµ–å…³ç³»

**è¿½è¸ªæ¨¡å‹**ï¼š
```
TraceID: 550e8400-e29b-41d4-a716-446655440000
â”‚
â”œâ”€ SpanID: a2fb4a1d1a96d312 (API Gateway)
â”‚  â”œâ”€ SpanID: 0f9b8e7c3a21d584 (User Service)
â”‚  â”‚  â””â”€ SpanID: 3c4b5a9f8e7d2c1b (Database Query)
â”‚  â””â”€ SpanID: 7d8e9f0a1b2c3d4e (Order Service)
â”‚     â””â”€ SpanID: 1e2f3a4b5c6d7e8f (Payment Service)
```

**ä¸»æµè¿½è¸ªç³»ç»Ÿå¯¹æ¯”**ï¼š

| ç³»ç»Ÿ | æ¨¡å‹ | ç‰¹è‰² | é€‚ç”¨åœºæ™¯ |
|------|------|------|----------|
| **Jaeger** | OpenTracing | äº‘åŸç”Ÿã€å¼€æº | Kubernetesã€å¾®æœåŠ¡ |
| **Zipkin** | è‡ªå®šä¹‰ | è½»é‡çº§ã€ç®€å• | ä¸­å°å‹é¡¹ç›® |
| **SkyWalking** | è‡ªåŠ¨æ¢é’ˆ | ä¸­æ–‡å‹å¥½ã€åŠŸèƒ½å…¨é¢ | å›½å†…é¡¹ç›® |
| **AWS X-Ray** | äº‘åŸç”Ÿ | AWSé›†æˆ | AWSç¯å¢ƒ |
| **Datadog APM** | äº‘æœåŠ¡ | å•†ä¸šåŒ–ã€æ˜“ç”¨ | ä¼ä¸šçº§åº”ç”¨ |

### 6. å®‰å…¨ä¸æ²»ç†å±‚ ğŸ”’

#### 6.1 èº«ä»½è®¤è¯ä¸æˆæƒæŠ€æœ¯ ğŸ”‘

**æŠ€æœ¯åŸç†**ï¼šèº«ä»½è®¤è¯æ˜¯éªŒè¯ç”¨æˆ·èº«ä»½ï¼Œæˆæƒæ˜¯æ§åˆ¶ç”¨æˆ·è®¿é—®æƒé™çš„æŠ€æœ¯

**è®¤è¯æ¨¡å¼å¯¹æ¯”**ï¼š

**1. ä¼ ç»Ÿä¼šè¯è®¤è¯**ï¼š
```
ç”¨æˆ·ç™»å½• â†’ æœåŠ¡å™¨ç”ŸæˆSessionID â†’ å­˜å‚¨åœ¨Cookie/Session
ä¼˜ç‚¹ï¼šç®€å•ã€æœåŠ¡å™¨å¯æ§
ç¼ºç‚¹ï¼šä¸é€‚åˆåˆ†å¸ƒå¼ã€æ‰©å±•æ€§å·®
```

**2. JWT Tokenè®¤è¯**ï¼š
```
ç”¨æˆ·ç™»å½• â†’ æœåŠ¡å™¨ç”ŸæˆJWT â†’ å®¢æˆ·ç«¯å­˜å‚¨å¹¶åœ¨è¯·æ±‚å¤´ä¸­æºå¸¦
ä¼˜ç‚¹ï¼šæ— çŠ¶æ€ã€é€‚åˆå¾®æœåŠ¡
ç¼ºç‚¹ï¼šTokenæ— æ³•ä¸»åŠ¨å¤±æ•ˆã€å®‰å…¨é£é™©
```

**3. OAuth 2.0**ï¼š
```
ç¬¬ä¸‰æ–¹åº”ç”¨ â†’ æˆæƒæœåŠ¡å™¨ â†’ è·å–æˆæƒç  â†’ äº¤æ¢Access Token
ä¼˜ç‚¹ï¼šå®‰å…¨ã€æ ‡å‡†åŒ–ã€æ”¯æŒç¬¬ä¸‰æ–¹é›†æˆ
ç¼ºç‚¹ï¼šå¤æ‚åº¦è¾ƒé«˜
```

**æˆæƒæ¨¡å‹**ï¼š

**RBACï¼ˆåŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼‰**ï¼š
```sql
-- ç”¨æˆ·ã€è§’è‰²ã€æƒé™å…³ç³»
CREATE TABLE users (id, username, email);
CREATE TABLE roles (id, role_name, description);
CREATE TABLE permissions (id, permission_name, resource);

CREATE TABLE user_roles (user_id, role_id);
CREATE TABLE role_permissions (role_id, permission_id);

-- æŸ¥è¯¢ç”¨æˆ·æƒé™
SELECT DISTINCT p.permission_name, p.resource
FROM users u
JOIN user_roles ur ON u.id = ur.user_id
JOIN roles r ON ur.role_id = r.id
JOIN role_permissions rp ON r.id = rp.role_id
JOIN permissions p ON rp.permission_id = p.id
WHERE u.id = ?;
```

**ä¸»æµè®¤è¯æˆæƒäº§å“å¯¹æ¯”**ï¼š

| äº§å“ | ç±»å‹ | ç‰¹è‰² | é€‚ç”¨åœºæ™¯ |
|------|------|------|----------|
| **Keycloak** | å¼€æº | åŠŸèƒ½å…¨é¢ã€åè®®æ”¯æŒå¹¿ | ä¼ä¸šåº”ç”¨ |
| **Auth0** | äº‘æœåŠ¡ | æ˜“é›†æˆã€å¤šèº«ä»½æä¾›è€… | SaaSåº”ç”¨ |
| **AWS Cognito** | äº‘æœåŠ¡ | AWSé›†æˆã€ç§»åŠ¨ä¼˜åŒ– | AWSç”Ÿæ€ |
| **Okta** | äº‘æœåŠ¡ | ä¼ä¸šçº§ã€å®‰å…¨æ€§é«˜ | å¤§å‹ä¼ä¸š |
| **Firebase Auth** | äº‘æœåŠ¡ | ç§»åŠ¨ä¼˜å…ˆã€ç®€å•é›†æˆ | ç§»åŠ¨åº”ç”¨ |

### 7. æ•°æ®å¤„ç†ä¸åˆ†æå±‚ ğŸ“Š

#### 7.1 æœç´¢å¼•æ“æŠ€æœ¯ ğŸ”

**æŠ€æœ¯åŸç†**ï¼šæœç´¢å¼•æ“æ˜¯ä¸“é—¨ç”¨äºå…¨æ–‡æœç´¢å’Œå¤æ‚æŸ¥è¯¢çš„æ•°æ®å­˜å‚¨å’Œæ£€ç´¢ç³»ç»Ÿ

**è§£å†³é—®é¢˜**ï¼š
- **å…¨æ–‡æœç´¢**ï¼šå…³ç³»å‹æ•°æ®åº“çš„LIKEæŸ¥è¯¢æ€§èƒ½ä½ä¸‹
- **å¤æ‚èšåˆ**ï¼šæ”¯æŒå¤æ‚çš„æ•°æ®èšåˆå’Œåˆ†æ
- **å®æ—¶æŸ¥è¯¢**ï¼šæä¾›è¿‘å®æ—¶çš„æœç´¢ç»“æœ
- **å¤šç»´åº¦æœç´¢**ï¼šæ”¯æŒåœ°ç†ä½ç½®ã€æ—¶é—´èŒƒå›´ç­‰å¤æ‚æ¡ä»¶

**æœç´¢å¼•æ“äº§å“å¯¹æ¯”**ï¼š

| äº§å“ | ç±»å‹ | ç‰¹è‰² | é€‚ç”¨åœºæ™¯ |
|------|------|------|----------|
| **Elasticsearch** | åˆ†å¸ƒå¼ | åŠŸèƒ½å…¨é¢ã€ç”Ÿæ€æˆç†Ÿ | æ—¥å¿—åˆ†æã€ä¼ä¸šæœç´¢ |
| **Apache Solr** | åˆ†å¸ƒå¼ | æˆç†Ÿç¨³å®šã€ä¼ä¸šçº§ | ä¼ ç»Ÿä¼ä¸šæœç´¢ |
| **Amazon OpenSearch** | äº‘æœåŠ¡ | æ‰˜ç®¡æœåŠ¡ã€AWSé›†æˆ | AWSäº‘ç¯å¢ƒ |
| **Azure Cognitive Search** | äº‘æœåŠ¡ | AIå¢å¼ºã€è¯­ä¹‰æœç´¢ | Azureç”Ÿæ€ |
| **Algolia** | äº‘æœåŠ¡ | é€Ÿåº¦æå¿«ã€æ˜“ç”¨ | ç½‘ç«™æœç´¢ã€ç§»åŠ¨åº”ç”¨ |
| **MeiliSearch** | å¼€æº | è½»é‡çº§ã€æ˜“éƒ¨ç½² | ä¸­å°å‹é¡¹ç›® |

### 8. æŠ€æœ¯é€‰æ‹©æ¡†æ¶ ğŸ¯

#### 8.1 åŸºäºåœºæ™¯çš„é€‰æ‹©çŸ©é˜µ

**åˆåˆ›å…¬å¸ï¼ˆ0-10äººï¼‰**ï¼š
```yaml
æŠ€æœ¯é€‰æ‹©åŸåˆ™: ç®€å•ã€æˆæœ¬ä½ã€å¿«é€Ÿä¸Šçº¿
æ¨èæŠ€æœ¯æ ˆ:
  è´Ÿè½½å‡è¡¡: Nginx
  åº”ç”¨æœåŠ¡: Node.js/Python + Docker
  æ•°æ®åº“: PostgreSQL/MySQL
  ç¼“å­˜: Redis
  æ¶ˆæ¯é˜Ÿåˆ—: Redis Pub/Sub
  ç›‘æ§: äº‘æœåŠ¡ç›‘æ§ï¼ˆAWS CloudWatchï¼‰
  éƒ¨ç½²: Docker + äº‘æœåŠ¡å™¨ï¼ˆVPSï¼‰
```

**æˆé•¿æœŸå…¬å¸ï¼ˆ10-100äººï¼‰**ï¼š
```yaml
æŠ€æœ¯é€‰æ‹©åŸåˆ™: å¯æ‰©å±•ã€ç¨³å®šã€å›¢é˜Ÿå¯ç»´æŠ¤
æ¨èæŠ€æœ¯æ ˆ:
  APIç½‘å…³: Kong/APISIX
  å®¹å™¨ç¼–æ’: Kubernetes
  æœåŠ¡å‘ç°: Consul/Nacos
  æ•°æ®åº“: MySQLä¸»ä» + Redisé›†ç¾¤
  æ¶ˆæ¯é˜Ÿåˆ—: RabbitMQ/RocketMQ
  ç›‘æ§: Prometheus + Grafana
  CI/CD: GitLab CI/GitHub Actions
```

**ä¼ä¸šçº§ï¼ˆ100+äººï¼‰**ï¼š
```yaml
æŠ€æœ¯é€‰æ‹©åŸåˆ™: ä¼ä¸šçº§åŠŸèƒ½ã€å®‰å…¨ã€æ²»ç†èƒ½åŠ›
æ¨èæŠ€æœ¯æ ˆ:
  Service Mesh: Istio
  å®¹å™¨ç¼–æ’: Kubernetes + Helm
  æœåŠ¡æ²»ç†: é…ç½®ä¸­å¿ƒ + æœåŠ¡ç½‘æ ¼
  æ•°æ®åº“: å¤šæ•°æ®æºï¼ˆRDBMS + NoSQLï¼‰
  æ¶ˆæ¯ä¸­é—´ä»¶: Kafka + RabbitMQ
  å®Œå–„çš„è§‚æµ‹æ€§: æ—¥å¿—+æŒ‡æ ‡+è¿½è¸ª
  å®‰å…¨: ç»Ÿä¸€è®¤è¯æˆæƒã€ç½‘ç»œå®‰å…¨
```

#### 8.2 æŠ€æœ¯è¯„ä¼°ç»´åº¦

**æ€§èƒ½ç»´åº¦**ï¼š
- **ååé‡**ï¼šæ¯ç§’è¯·æ±‚æ•°ï¼ˆQPS/TPSï¼‰
- **å»¶è¿Ÿ**ï¼šå“åº”æ—¶é—´ï¼ˆP95/P99ï¼‰
- **å¹¶å‘æ€§**ï¼šåŒæ—¶åœ¨çº¿ç”¨æˆ·æ•°
- **èµ„æºæ•ˆç‡**ï¼šCPU/å†…å­˜åˆ©ç”¨ç‡

**å¯é æ€§ç»´åº¦**ï¼š
- **å¯ç”¨æ€§**ï¼š99.9%/99.99%/99.999%
- **å®¹é”™æ€§**ï¼šç³»ç»Ÿé”™è¯¯å®¹å¿èƒ½åŠ›
- **æ¢å¤èƒ½åŠ›**ï¼šæ•…éšœæ¢å¤æ—¶é—´ï¼ˆRTO/RPOï¼‰

**å¯ç»´æŠ¤æ€§ç»´åº¦**ï¼š
- **å­¦ä¹ æˆæœ¬**ï¼šå›¢é˜ŸæŠ€èƒ½è¦æ±‚
- **æ–‡æ¡£å®Œå–„æ€§**ï¼šå®˜æ–¹æ–‡æ¡£è´¨é‡
- **ç¤¾åŒºæ”¯æŒ**ï¼šé—®é¢˜è§£å†³èƒ½åŠ›
- **å¯ç›‘æ§æ€§**ï¼šç³»ç»Ÿå¯è§‚æµ‹æ€§

**æˆæœ¬ç»´åº¦**ï¼š
- **å¼€å‘æˆæœ¬**ï¼šåˆå§‹å¼€å‘æŠ•å…¥
- **è¿ç»´æˆæœ¬**ï¼šæ—¥å¸¸ç»´æŠ¤æˆæœ¬
- **æ‰©å±•æˆæœ¬**ï¼šä¸šåŠ¡å¢é•¿çš„æŠ€æœ¯æˆæœ¬
- **äººåŠ›æˆæœ¬**ï¼šä¸“ä¸šäººå‘˜è–ªèµ„

### 9. æ¶æ„æ¼”è¿›è·¯å¾„ ğŸ›¤ï¸

#### 9.1 æ¸è¿›å¼ç°ä»£åŒ–è·¯å¾„

**ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€è®¾æ–½ä¼˜åŒ–**ï¼ˆé€‚åˆç°æœ‰å•ä½“åº”ç”¨ï¼‰
```
å½“å‰çŠ¶æ€: å•ä½“åº”ç”¨ + ç‰©ç†æœåŠ¡å™¨
ä¼˜åŒ–ç›®æ ‡: æé«˜å¯ç”¨æ€§å’Œæ€§èƒ½
æŠ€æœ¯æ”¹é€ :
  1. å¼•å…¥Nginxåšè´Ÿè½½å‡è¡¡
  2. æ•°æ®åº“ä¸»ä»å¤åˆ¶ã€è¯»å†™åˆ†ç¦»
  3. æ·»åŠ Redisç¼“å­˜å±‚
  4. å¼•å…¥åŸºç¡€ç›‘æ§ï¼ˆPrometheus + Grafanaï¼‰
  5. ä¼˜åŒ–æ•°æ®åº“æŸ¥è¯¢å’Œç´¢å¼•
```

**ç¬¬äºŒé˜¶æ®µï¼šå®¹å™¨åŒ–æ”¹é€ **ï¼ˆæé«˜éƒ¨ç½²æ•ˆç‡ï¼‰
```
æ”¹é€ ç›®æ ‡: æ ‡å‡†åŒ–éƒ¨ç½²æµç¨‹
æŠ€æœ¯æ”¹é€ :
  1. åº”ç”¨DockeråŒ–
  2. å»ºè®¾ CI/CD æµæ°´çº¿
  3. ç¯å¢ƒæ ‡å‡†åŒ–ï¼ˆå¼€å‘/æµ‹è¯•/ç”Ÿäº§ï¼‰
  4. é…ç½®å¤–éƒ¨åŒ–ï¼ˆConfigMap/Environmentï¼‰
  5. å¥åº·æ£€æŸ¥å’Œæ»šåŠ¨éƒ¨ç½²
```

**ç¬¬ä¸‰é˜¶æ®µï¼šå¾®æœåŠ¡æ‹†åˆ†**ï¼ˆæé«˜ç ”å‘æ•ˆç‡ï¼‰
```
æ‹†åˆ†ç›®æ ‡: ä¸šåŠ¡ç‹¬ç«‹æ€§å’Œå¼€å‘æ•ˆç‡
æŠ€æœ¯æ”¹é€ :
  1. è¯†åˆ«ä¸šåŠ¡è¾¹ç•Œï¼Œæ‹†åˆ†ä¸ºå¾®æœåŠ¡
  2. å¼•å…¥APIç½‘å…³ï¼ˆKong/Zuulï¼‰
  3. æœåŠ¡å‘ç°ï¼ˆConsul/Eurekaï¼‰
  4. å¼•å…¥æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆRabbitMQ/Kafkaï¼‰
  5. å®ç°åˆ†å¸ƒå¼è¿½è¸ªï¼ˆJaeger/Zipkinï¼‰
```

**ç¬¬å››é˜¶æ®µï¼šäº‘åŸç”ŸåŒ–**ï¼ˆæé«˜è¿ç»´æ•ˆç‡ï¼‰
```
äº‘åŸç”Ÿç›®æ ‡: è‡ªåŠ¨åŒ–è¿ç»´å’Œå¼¹æ€§æ‰©å±•
æŠ€æœ¯æ”¹é€ :
  1. Kuberneteså®¹å™¨ç¼–æ’
  2. Service Meshï¼ˆIstioï¼‰
  3. è‡ªåŠ¨ä¼¸ç¼©å®¹ï¼ˆHPA/VPAï¼‰
  4. å®Œå–„çš„å¯è§‚æµ‹æ€§
  5. æ··æ²Œå·¥ç¨‹å’Œå¯é æ€§æµ‹è¯•
```

#### 9.2 æŠ€æœ¯å†³ç­–æ£€æŸ¥æ¸…å•

**é€‰å‹å‰æ£€æŸ¥**ï¼š
- [ ] æ˜ç¡®ä¸šåŠ¡éœ€æ±‚å’ŒæŠ€æœ¯çº¦æŸ
- [ ] è¯„ä¼°å›¢é˜ŸæŠ€èƒ½å’Œå­¦ä¹ èƒ½åŠ›
- [ ] è€ƒè™‘é•¿æœŸç»´æŠ¤æˆæœ¬
- [ ] åˆ†æç›®æ ‡ç”¨æˆ·è§„æ¨¡å’Œå¢é•¿é¢„æœŸ
- [ ] è€ƒè™‘æ³•å¾‹æ³•è§„å’Œå®‰å…¨è¦æ±‚

**é€‰å‹æ—¶æ¯”è¾ƒ**ï¼š
- [ ] æ€§èƒ½å¯¹æ¯”æµ‹è¯•
- [ ] æˆæœ¬åˆ†æï¼ˆåˆå§‹ + è¿ç»´ï¼‰
- [ ] ç”Ÿæ€æˆç†Ÿåº¦è°ƒç ”
- [ ] æŠ€æœ¯æ”¯æŒå’Œç¤¾åŒºæ´»è·ƒåº¦
- [ ] å®‰å…¨æ€§å’Œé€‚èŒƒæ€§è¯„ä¼°

**å®æ–½åéªŒè¯**ï¼š
- [ ] æ€§èƒ½æŒ‡æ ‡éªŒè¯
- [ ] å¯ç”¨æ€§æŒ‡æ ‡éªŒè¯
- [ ] ç›‘æ§å’Œå‘Šè­¦å®Œå–„
- [ ] å®‰å…¨æ¼æ´æ‰«æ
- [ ] ç¾å¤‡æ¢å¤æµ‹è¯•

---

## ğŸ“Š æ€»ç»“ä¸å±•æœ›

ç°ä»£æœåŠ¡ç«¯æ¶æ„æ˜¯ä¸€ä¸ªå¤æ‚çš„æŠ€æœ¯ç”Ÿæ€ç³»ç»Ÿï¼Œæ¶‰åŠå¤šä¸ªæŠ€æœ¯é¢†åŸŸçš„æ·±åº¦é›†æˆã€‚æˆåŠŸçš„æ¶æ„è®¾è®¡éœ€è¦ï¼š

1. **æ·±å…¥ç†è§£æ¯ä¸ªæŠ€æœ¬åŸç†**ï¼Œè€Œä¸ä»…ä»…æ˜¯ä¼šä½¿ç”¨å…·ä½“äº§å“
2. **åŸºäºå®é™…ä¸šåŠ¡éœ€æ±‚é€‰æ‹©æŠ€æœ¯**ï¼Œé¿å…è¿‡åº¦è®¾è®¡
3. **å»ºç«‹æ¸è¿›å¼æ¼”è¿›è·¯å¾„**ï¼Œé¿å…çªç„¶çš„æŠ€æœ¯å˜é©
4. **æŒç»­å…³æ³¨æŠ€æœ¯å‘å±•è¶‹åŠ¿**ï¼Œé€‚æ—¶å¼•å…¥æ–°æŠ€æœ¯

æŠ€æœ¯æ¶æ„ä¸æ˜¯ä¸€ä¸ªé™æ€çš„ç»“æœï¼Œè€Œæ˜¯ä¸€ä¸ªæŒç»­æ¼”è¿›çš„è¿‡ç¨‹ã€‚éšç€ä¸šåŠ¡çš„å‘å±•å’ŒæŠ€æœ¯çš„è¿›æ­¥ï¼Œæ¶æ„ä¹Ÿéœ€è¦ä¸æ–­ä¼˜åŒ–å’Œè°ƒæ•´ã€‚å…³é”®æ˜¯å»ºç«‹ç§‘å­¦çš„å†³ç­–æ¡†æ¶å’Œè¯„ä¼°ä½“ç³»ï¼Œç¡®ä¿æ¯ä¸€æ¬¡æŠ€æœ¯é€‰æ‹©éƒ½èƒ½ä¸ºä¸šåŠ¡å¸¦æ¥å®é™…ä»·å€¼ã€‚

å¸Œæœ›è¿™ä»½æ–‡æ¡£èƒ½å¸®åŠ©ä½ å»ºç«‹å®Œæ•´çš„ç°ä»£æœåŠ¡ç«¯æ¶æ„çŸ¥è¯†ä½“ç³»ï¼Œåœ¨å®é™…é¡¹ç›®ä¸­åšå‡ºæ˜æ™ºçš„æŠ€æœ¯é€‰æ‹©ï¼ğŸš€

## ğŸ“„ å­¦ä¹ èµ„æºæ¨è

### æ·±å…¥å­¦ä¹ æŒ‡å—

#### ğŸ“ åˆ†å±‚å­¦ä¹ è·¯å¾„

**ç¬¬ä¸€å±‚ï¼šæŠ€æœ¯åŸç†ç†è§£**ï¼ˆ3-6ä¸ªæœˆï¼‰
- å­¦ä¹ ç›®æ ‡ï¼šç†è§£æ¯ç§æŠ€æœ¯çš„å·¥ä½œåŸç†å’Œé€‚ç”¨åœºæ™¯
- å­¦ä¹ æ–¹æ³•ï¼šå®˜æ–¹æ–‡æ¡£ + åŠ¨æ‰‹å®è·µ + å°å‹é¡¹ç›®éªŒè¯
- é‡ç‚¹æŠ€æœ¯ï¼šåå‘ä»£ç†ã€è´Ÿè½½å‡è¡¡ã€å®¹å™¨åŒ–ã€æ•°æ®åº“åŸç†

**ç¬¬äºŒå±‚ï¼šæ¶æ„è®¾è®¡èƒ½åŠ›**ï¼ˆ6-12ä¸ªæœˆï¼‰
- å­¦ä¹ ç›®æ ‡ï¼šèƒ½å¤Ÿè®¾è®¡ä¸­ç­‰å¤æ‚åº¦çš„åˆ†å¸ƒå¼ç³»ç»Ÿ
- å­¦ä¹ æ–¹æ³•ï¼šæ¶æ„æ¡ˆä¾‹åˆ†æ + å®é™…é¡¹ç›®è®¾è®¡ + æŠ€æœ¯è°ƒç ”
- é‡ç‚¹èƒ½åŠ›ï¼šç³»ç»Ÿè®¾è®¡ã€æŠ€æœ¯é€‰å‹ã€æ€§èƒ½ä¼˜åŒ–ã€å¯ç”¨æ€§è®¾è®¡

**ç¬¬ä¸‰å±‚ï¼šæ¶æ„æ²»ç†ä¸æ¼”è¿›**ï¼ˆ12-24ä¸ªæœˆï¼‰
- å­¦ä¹ ç›®æ ‡ï¼šå…·å¤‡å¤§è§„æ¨¡ç³»ç»Ÿçš„æ¶æ„æ²»ç†èƒ½åŠ›
- å­¦ä¹ æ–¹æ³•ï¼šå¤§å‹å¼€æºé¡¹ç›®ç ”ç©¶ + ä¸šç•Œå®è·µåˆ†äº« + æŠ€æœ¯åˆ›æ–°
- é‡ç‚¹é¢†åŸŸï¼šäº‘åŸç”Ÿã€å¾®æœåŠ¡æ²»ç†ã€æ€§èƒ½è°ƒä¼˜ã€å®‰å…¨åˆè§„

#### ğŸ“š æ¨èå­¦ä¹ èµ„æº

**ç»å…¸ä¹¦ç±**
- ã€Šè®¾è®¡æ•°æ®å¯†é›†å‹åº”ç”¨ã€‹- æ•°æ®ç³»ç»Ÿè®¾è®¡çš„æƒå¨æŒ‡å—
- ã€Šå¾®æœåŠ¡æ¶æ„è®¾è®¡æ¨¡å¼ã€‹- å¾®æœåŠ¡å®è·µçš„æœ€ä½³å‚è€ƒ
- ã€Šå‡¤å‡°é¡¹ç›®ã€‹- DevOpsç†å¿µçš„ç”ŸåŠ¨è¯ é‡Š
- ã€ŠSite Reliability Engineeringã€‹- Google SREå®è·µ

**æŠ€æœ¯æ–‡æ¡£ä¸è§„èŒƒ**
- [12-Factor App](https://12factor.net/zh_cn/) - äº‘åŸç”Ÿåº”ç”¨è®¾è®¡åŸåˆ™
- [Microservices Patterns](https://microservices.io/) - å¾®æœåŠ¡æ¨¡å¼è¯¦è§£
- [CNCF Landscape](https://landscape.cncf.io/) - äº‘åŸç”ŸæŠ€æœ¯å…¨æ™¯å›¾
- [AWS Architecture Center](https://aws.amazon.com/architecture/) - äº‘æ¶æ„æœ€ä½³å®è·µ

**å®è·µé¡¹ç›®å»ºè®®**
1. **ä¸ªäººåšå®¢ç³»ç»Ÿ**ï¼šDocker + Nginx + Node.js + PostgreSQL
2. **å¾®æœåŠ¡ç”µå•†**ï¼šSpring Cloud/Dubbo + MySQL + Redis + RabbitMQ
3. **å®æ—¶èŠå¤©åº”ç”¨**ï¼šWebSocket + Redis + MongoDB
4. **ç›‘æ§å¹³å°**ï¼šPrometheus + Grafana + Elasticsearch + Kibana

#### ğŸ› ï¸ æŠ€èƒ½å‘å±•å»ºè®®

**æŠ€æœ¯å¹¿åº¦ vs æ·±åº¦å¹³è¡¡**
- å¹¿åº¦ï¼šäº†è§£å„ä¸ªæŠ€æœ¯é¢†åŸŸçš„åŸºæœ¬æ¦‚å¿µå’Œé€‚ç”¨åœºæ™¯
- æ·±åº¦ï¼šåœ¨1-2ä¸ªé¢†åŸŸæ·±å…¥é’»ç ”ï¼Œæˆä¸ºä¸“å®¶
- å»ºè®®æ·±å…¥é¢†åŸŸï¼šæ•°æ®åº“ä¼˜åŒ–ã€åˆ†å¸ƒå¼ç³»ç»Ÿã€äº‘åŸç”Ÿã€å®‰å…¨

**æŒç»­å­¦ä¹ ç­–ç•¥**
- è·Ÿè¸ªæŠ€æœ¯è¶‹åŠ¿ï¼šå…³æ³¨CNCFã€ApacheåŸºé‡‘ä¼šé¡¹ç›®
- å‚ä¸å¼€æºé¡¹ç›®ï¼šè´¡çŒ®ä»£ç ï¼Œäº†è§£å®é™…å·¥ç¨‹å®è·µ
- æŠ€æœ¯åˆ†äº«äº¤æµï¼šå†™æŠ€æœ¯åšå®¢ï¼Œå‚åŠ æŠ€æœ¯ä¼šè®®
- å®æˆ˜é¡¹ç›®éªŒè¯ï¼šåœ¨å®é™…é¡¹ç›®ä¸­åº”ç”¨æ–°å­¦åˆ°çš„æŠ€æœ¯

**èŒä¸šå‘å±•è·¯å¾„**
- åˆçº§æ¶æ„å¸ˆï¼šæŒæ¡åŸºç¡€æŠ€æœ¯åŸç†ï¼Œèƒ½è®¾è®¡ç®€å•ç³»ç»Ÿ
- ä¸­çº§æ¶æ„å¸ˆï¼šå…·å¤‡å®Œæ•´çš„æŠ€æœ¯æ ˆçŸ¥è¯†ï¼Œèƒ½è§£å†³å¤æ‚æŠ€æœ¯é—®é¢˜
- é«˜çº§æ¶æ„å¸ˆï¼šå…·å¤‡ä¸šåŠ¡ç†è§£èƒ½åŠ›ï¼Œèƒ½æƒè¡¡æŠ€æœ¯ä¸ä¸šåŠ¡éœ€æ±‚
- æŠ€æœ¯ä¸“å®¶/CTOï¼šå…·å¤‡æŠ€æœ¯æˆ˜ç•¥æ€ç»´ï¼Œèƒ½æŒ‡å¯¼å›¢é˜Ÿå’ŒæŠ€æœ¯æ–¹å‘

---

## âš¡ é™æµå’Œç†”æ–­æœºåˆ¶ Node.js å®ç°

```javascript
// é™æµå™¨å®ç°ï¼ˆä»¤ç‰Œæ¡¶ç®—æ³•ï¼‰
class TokenBucketRateLimiter {
  constructor(capacity, refillRate, refillInterval = 1000) {
    this.capacity = capacity;        // æ¡¶å®¹é‡
    this.tokens = capacity;         // å½“å‰ä»¤ç‰Œæ•°
    this.refillRate = refillRate;   // æ¯æ¬¡è¡¥å……çš„ä»¤ç‰Œæ•°
    this.refillInterval = refillInterval; // è¡¥å……é—´éš”ï¼ˆæ¯«ç§’ï¼‰
    this.lastRefill = Date.now();

    // å®šæ—¶è¡¥å……ä»¤ç‰Œ
    this.intervalId = setInterval(() => {
      this.refillTokens();
    }, refillInterval);
  }

  refillTokens() {
    const now = Date.now();
    const elapsed = now - this.lastRefill;
    const tokensToAdd = Math.floor(elapsed / this.refillInterval) * this.refillRate;

    this.tokens = Math.min(this.capacity, this.tokens + tokensToAdd);
    this.lastRefill = now;
  }

  // å°è¯•è·å–ä»¤ç‰Œ
  tryAcquire(tokensNeeded = 1) {
    this.refillTokens();

    if (this.tokens >= tokensNeeded) {
      this.tokens -= tokensNeeded;
      return true;
    }
    return false;
  }

  // è·å–å½“å‰çŠ¶æ€
  getStatus() {
    return {
      tokens: this.tokens,
      capacity: this.capacity,
      usage: ((this.capacity - this.tokens) / this.capacity * 100).toFixed(1) + '%'
    };
  }

  destroy() {
    if (this.intervalId) {
      clearInterval(this.intervalId);
    }
  }
}

// æ»‘åŠ¨çª—å£é™æµå™¨
class SlidingWindowRateLimiter {
  constructor(windowSize, maxRequests) {
    this.windowSize = windowSize; // çª—å£å¤§å°ï¼ˆæ¯«ç§’ï¼‰
    this.maxRequests = maxRequests; // æœ€å¤§è¯·æ±‚æ•°
    this.requests = []; // è¯·æ±‚æ—¶é—´æˆ³æ•°ç»„
  }

  tryAcquire() {
    const now = Date.now();
    const windowStart = now - this.windowSize;

    // æ¸…é™¤çª—å£å¤–çš„è¯·æ±‚
    this.requests = this.requests.filter(timestamp => timestamp > windowStart);

    if (this.requests.length < this.maxRequests) {
      this.requests.push(now);
      return true;
    }
    return false;
  }

  getStatus() {
    const now = Date.now();
    const windowStart = now - this.windowSize;
    const activeRequests = this.requests.filter(timestamp => timestamp > windowStart);

    return {
      currentRequests: activeRequests.length,
      maxRequests: this.maxRequests,
      usage: (activeRequests.length / this.maxRequests * 100).toFixed(1) + '%'
    };
  }
}

// ç†”æ–­å™¨å®ç°
class CircuitBreaker {
  constructor(options = {}) {
    this.failureThreshold = options.failureThreshold || 5;  // å¤±è´¥é˜ˆå€¼
    this.timeout = options.timeout || 60000;               // è¶…æ—¶æ—¶é—´
    this.resetTimeout = options.resetTimeout || 30000;     // é‡ç½®è¶…æ—¶

    this.state = 'CLOSED';     // CLOSED, OPEN, HALF_OPEN
    this.failureCount = 0;     // å¤±è´¥æ¬¡æ•°
    this.lastFailureTime = null;
    this.successCount = 0;     // åŠå¼€çŠ¶æ€ä¸‹çš„æˆåŠŸæ¬¡æ•°

    // ç»Ÿè®¡ä¿¡æ¯
    this.stats = {
      totalRequests: 0,
      successfulRequests: 0,
      failedRequests: 0,
      rejectedRequests: 0
    };
  }

  async call(fn) {
    this.stats.totalRequests++;

    if (this.state === 'OPEN') {
      if (this.shouldAttemptReset()) {
        this.state = 'HALF_OPEN';
        this.successCount = 0;
        console.log('Circuit breaker transitioning to HALF_OPEN');
      } else {
        this.stats.rejectedRequests++;
        throw new Error('Circuit breaker is OPEN');
      }
    }

    try {
      const result = await Promise.race([
        fn(),
        this.createTimeoutPromise()
      ]);

      this.onSuccess();
      return result;
    } catch (error) {
      this.onFailure();
      throw error;
    }
  }

  createTimeoutPromise() {
    return new Promise((_, reject) => {
      setTimeout(() => {
        reject(new Error('Circuit breaker timeout'));
      }, this.timeout);
    });
  }

  onSuccess() {
    this.stats.successfulRequests++;
    this.failureCount = 0;

    if (this.state === 'HALF_OPEN') {
      this.successCount++;
      if (this.successCount >= 3) { // è¿ç»­3æ¬¡æˆåŠŸåå…³é—­ç†”æ–­å™¨
        this.state = 'CLOSED';
        console.log('Circuit breaker CLOSED');
      }
    }
  }

  onFailure() {
    this.stats.failedRequests++;
    this.failureCount++;
    this.lastFailureTime = Date.now();

    if (this.state === 'HALF_OPEN') {
      this.state = 'OPEN';
      console.log('Circuit breaker OPEN (failed during half-open)');
    } else if (this.failureCount >= this.failureThreshold) {
      this.state = 'OPEN';
      console.log('Circuit breaker OPEN (threshold reached)');
    }
  }

  shouldAttemptReset() {
    return this.lastFailureTime &&
           (Date.now() - this.lastFailureTime) >= this.resetTimeout;
  }

  getStatus() {
    return {
      state: this.state,
      failureCount: this.failureCount,
      stats: this.stats,
      successRate: this.stats.totalRequests > 0
        ? ((this.stats.successfulRequests / this.stats.totalRequests) * 100).toFixed(2) + '%'
        : '0%'
    };
  }

  reset() {
    this.state = 'CLOSED';
    this.failureCount = 0;
    this.successCount = 0;
    this.lastFailureTime = null;
    console.log('Circuit breaker manually reset');
  }
}

// Expressä¸­é—´ä»¶ç¤ºä¾‹
function createRateLimitMiddleware(limiter) {
  return (req, res, next) => {
    const clientId = req.ip || req.connection.remoteAddress;

    if (limiter.tryAcquire()) {
      next();
    } else {
      res.status(429).json({
        error: 'Too Many Requests',
        message: 'è¯·æ±‚è¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åå†è¯•',
        retryAfter: Math.ceil(limiter.refillInterval / 1000)
      });
    }
  };
}

function createCircuitBreakerMiddleware(breaker, serviceCall) {
  return async (req, res, next) => {
    try {
      const result = await breaker.call(serviceCall);
      req.serviceResult = result;
      next();
    } catch (error) {
      if (error.message === 'Circuit breaker is OPEN') {
        res.status(503).json({
          error: 'Service Unavailable',
          message: 'æœåŠ¡æš‚æ—¶ä¸å¯ç”¨ï¼Œè¯·ç¨åå†è¯•'
        });
      } else {
        res.status(500).json({
          error: 'Internal Server Error',
          message: 'æœåŠ¡è°ƒç”¨å¤±è´¥'
        });
      }
    }
  };
}

// ä½¿ç”¨ç¤ºä¾‹
const express = require('express');
const app = express();

// åˆ›å»ºé™æµå™¨ - æ¯ç§’æœ€å¤š10ä¸ªè¯·æ±‚
const rateLimiter = new TokenBucketRateLimiter(10, 10, 1000);

// åˆ›å»ºç†”æ–­å™¨ - 5æ¬¡å¤±è´¥åç†”æ–­ï¼Œ30ç§’åå°è¯•æ¢å¤
const circuitBreaker = new CircuitBreaker({
  failureThreshold: 5,
  timeout: 3000,
  resetTimeout: 30000
});

// åº”ç”¨é™æµä¸­é—´ä»¶
app.use('/api', createRateLimitMiddleware(rateLimiter));

// æ¨¡æ‹Ÿä¸ç¨³å®šçš„æœåŠ¡è°ƒç”¨
async function unstableServiceCall() {
  // 30%çš„æ¦‚ç‡å¤±è´¥
  if (Math.random() < 0.3) {
    throw new Error('Service temporarily unavailable');
  }
  return { data: 'æœåŠ¡è°ƒç”¨æˆåŠŸ', timestamp: new Date() };
}

// åº”ç”¨ç†”æ–­å™¨ä¸­é—´ä»¶
app.get('/api/service', createCircuitBreakerMiddleware(circuitBreaker, unstableServiceCall), (req, res) => {
  res.json({
    success: true,
    data: req.serviceResult
  });
});

// çŠ¶æ€ç›‘æ§æ¥å£
app.get('/api/status', (req, res) => {
  res.json({
    rateLimiter: rateLimiter.getStatus(),
    circuitBreaker: circuitBreaker.getStatus()
  });
});

// ç®¡ç†æ¥å£
app.post('/api/circuit-breaker/reset', (req, res) => {
  circuitBreaker.reset();
  res.json({ message: 'Circuit breaker reset successfully' });
});

// ä¼˜é›…å…³é—­
process.on('SIGTERM', () => {
  rateLimiter.destroy();
  console.log('Rate limiter destroyed');
});

module.exports = {
  TokenBucketRateLimiter,
  SlidingWindowRateLimiter,
  CircuitBreaker
};
```

## ğŸ“Š æ€§èƒ½ç›‘æ§é›†æˆç¤ºä¾‹

```javascript
// ç»“åˆç›‘æ§çš„å®Œæ•´ç¤ºä¾‹
const prometheus = require('prom-client');

// åˆ›å»ºç›‘æ§æŒ‡æ ‡
const rateLimitCounter = new prometheus.Counter({
  name: 'rate_limit_requests_total',
  help: 'Total rate limit requests',
  labelNames: ['status'] // allowed, rejected
});

const circuitBreakerGauge = new prometheus.Gauge({
  name: 'circuit_breaker_state',
  help: 'Circuit breaker state (0=CLOSED, 1=HALF_OPEN, 2=OPEN)',
  labelNames: ['service']
});

// å¢å¼ºçš„é™æµå™¨ï¼ˆå¸¦ç›‘æ§ï¼‰
class MonitoredRateLimiter extends TokenBucketRateLimiter {
  tryAcquire(tokensNeeded = 1) {
    const result = super.tryAcquire(tokensNeeded);

    rateLimitCounter
      .labels(result ? 'allowed' : 'rejected')
      .inc();

    return result;
  }
}

// å¢å¼ºçš„ç†”æ–­å™¨ï¼ˆå¸¦ç›‘æ§ï¼‰
class MonitoredCircuitBreaker extends CircuitBreaker {
  constructor(serviceName, options) {
    super(options);
    this.serviceName = serviceName;
    this.updateMetrics();
  }

  onSuccess() {
    super.onSuccess();
    this.updateMetrics();
  }

  onFailure() {
    super.onFailure();
    this.updateMetrics();
  }

  updateMetrics() {
    const stateMap = { 'CLOSED': 0, 'HALF_OPEN': 1, 'OPEN': 2 };
    circuitBreakerGauge
      .labels(this.serviceName)
      .set(stateMap[this.state] || 0);
  }
}
```

å¸Œæœ›è¿™ä»½åŸºäºæŠ€æœ¯åŸç†çš„ç°ä»£æœåŠ¡ç«¯æ¶æ„æ–‡æ¡£èƒ½å¸®åŠ©ä½ å»ºç«‹ç³»ç»Ÿæ€§çš„æ¶æ„æ€ç»´ï¼è®°ä½ï¼Œ**ç†è§£åŸç†æ¯”æŒæ¡å·¥å…·æ›´é‡è¦ï¼Œè§£å†³é—®é¢˜æ¯”è¿½æ±‚æ–°æŠ€æœ¯æ›´æœ‰ä»·å€¼**ã€‚ğŸ’ª